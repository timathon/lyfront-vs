(self.webpackChunklyfront_vs=self.webpackChunklyfront_vs||[]).push([[918],{2918:(t,e,i)=>{"use strict";i.r(e),i.d(e,{VehicleSteelModule:()=>Ge});var n={};i.r(n),i.d(n,{JsonPatchError:()=>J,_areEquals:()=>Q,applyOperation:()=>Y,applyPatch:()=>M,applyReducer:()=>B,deepClone:()=>R,getValueByPointer:()=>E,validate:()=>L,validator:()=>F});var s={};i.r(s),i.d(s,{compare:()=>tt,generate:()=>X,observe:()=>V,unobserve:()=>H});var o=i(1267),a=i(3464),r=i(2935),u=i(5366);let l=(()=>{class t{constructor(t){this.data=t,this.message=this.data&&this.data.message?this.data.message:"\u6b63\u5728\u8f7d\u5165..."}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(r.WI))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-loading"]],decls:2,vars:1,consts:[["mat-dialog-title",""]],template:function(t,e){1&t&&(u.TgZ(0,"h2",0),u._uU(1),u.qZA()),2&t&&(u.xp6(1),u.Oqu(e.message))},directives:[r.uh],styles:[""]}),t})();var c=i(3148),d=i(9996);class g{constructor(t=!1){this._id=null,this.createdAt=null,this.createdBy=null,this.modifiedAt=null,this.modifiedBy=null,this.isDeleted=!1,this.deletedAt=null,this.deletedBy=null,this.deletedNotes=null,this.weighing={truckPlateNo:"",customerId:"",notes:"",inWeightKG:0,inWeighedBy:"",inWeighedAt:new Date,outWeightKG:0,outWeighedBy:""},this.survey={surveyedBy:"",materials:[]},this.changeLogs=[],this.isOutbound=t}}class h{constructor(t,e,i){this.http=t,this.setHeaders=e,this.appConfig=i,this.apiURL=this.appConfig.backendUrl+"/api/vehicle-steel"}getRecent(t=!1){const e=new Date;e.setDate(e.getDate()-29);const i=new Date(e.toISOString().substr(0,10));i.setHours(0);const n={createdAt:{$gte:new Date(i)},isOutbound:!!t||{$ne:!0}},s={createdAt:{$lt:new Date(i)},"survey.surveyedBy":""};return t?this.search(n):(0,c.D)({within7days:this.search(n),over7daysNotSurveyed:this.search(s)}).pipe((0,d.U)(t=>[...t.within7days,...t.over7daysNotSurveyed]))}insert(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}update(t){return console.log(t),this.http.patch(this.apiURL+"/one",t,{headers:this.setHeaders(!0)})}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}class m{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/customers"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}save(t){if(t.oldCustomer._id){const e=this.calculatePatches.calculatePatches({oldObject:t.oldCustomer,newObject:t.newCustomer,keysToIgnore:["_id","createdAt","createdBy","modifiedAt","modifiedBy"]});return console.log(e),this.patch(t.oldCustomer._id,e)}return this.create(t.newCustomer)}create(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}patch(t,e){return this.http.patch(this.apiURL,{_id:t,patches:e},{headers:this.setHeaders(!0)})}}class p{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/users"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}var f=i(8598),v=i(878),Z=i(4689),w=i(4019),b=i(3530);class A{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/pws-v2"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}getPws(){return(0,v.of)(localStorage.getItem("pws")).pipe((0,Z.w)(t=>t?(0,v.of)(JSON.parse(t)):this.refreshPws()))}refreshPws(){return this.search({}).pipe((0,w.b)(t=>{localStorage.setItem("pws",JSON.stringify(t))}),(0,b.P)())}}class _{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/prices-v3"}getPrices3(t,e=!1){const i={};return Object.keys(t).forEach(e=>{t[e]&&(i[e]=t[e])}),this.http.post(this.apiURL+`/search?exact=${e}`,i,{headers:this.setHeaders(!0)})}}var T,y=i(2693),q=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),U=Object.prototype.hasOwnProperty;function O(t,e){return U.call(t,e)}function C(t){if(Array.isArray(t)){for(var e=new Array(t.length),i=0;i<e.length;i++)e[i]=""+i;return e}if(Object.keys)return Object.keys(t);for(var n in e=[],t)O(t,n)&&e.push(n);return e}function x(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function N(t){for(var e,i=0,n=t.length;i<n;){if(!((e=t.charCodeAt(i))>=48&&e<=57))return!1;i++}return!0}function I(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function P(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function W(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)if(W(t[e]))return!0}else if("object"==typeof t){var n=C(t),s=n.length;for(e=0;e<s;e++)if(W(t[n[e]]))return!0}return!1}function k(t,e){var i=[t];for(var n in e){var s="object"==typeof e[n]?JSON.stringify(e[n],null,2):e[n];void 0!==s&&i.push(n+": "+s)}return i.join("\n")}var D=function(t){function e(e,i,n,s,o){var a=this.constructor,r=t.call(this,k(e,{name:i,index:n,operation:s,tree:o}))||this;return r.name=i,r.index=n,r.operation=s,r.tree=o,Object.setPrototypeOf(r,a.prototype),r.message=k(e,{name:i,index:n,operation:s,tree:o}),r}return q(e,t),e}(Error),J=D,R=x,S={add:function(t,e,i){return t[e]=this.value,{newDocument:i}},remove:function(t,e,i){var n=t[e];return delete t[e],{newDocument:i,removed:n}},replace:function(t,e,i){var n=t[e];return t[e]=this.value,{newDocument:i,removed:n}},move:function(t,e,i){var n=E(i,this.path);n&&(n=x(n));var s=Y(i,{op:"remove",path:this.from}).removed;return Y(i,{op:"add",path:this.path,value:s}),{newDocument:i,removed:n}},copy:function(t,e,i){var n=E(i,this.from);return Y(i,{op:"add",path:this.path,value:x(n)}),{newDocument:i}},test:function(t,e,i){return{newDocument:i,test:Q(t[e],this.value)}},_get:function(t,e,i){return this.value=t[e],{newDocument:i}}},j={add:function(t,e,i){return N(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:i,index:e}},remove:function(t,e,i){return{newDocument:i,removed:t.splice(e,1)[0]}},replace:function(t,e,i){var n=t[e];return t[e]=this.value,{newDocument:i,removed:n}},move:S.move,copy:S.copy,test:S.test,_get:S._get};function E(t,e){if(""==e)return t;var i={op:"_get",path:e};return Y(t,i),i.value}function Y(t,e,i,n,s,o){if(void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===s&&(s=!0),void 0===o&&(o=0),i&&("function"==typeof i?i(e,0,t,e.path):F(e,0)),""===e.path){var a={newDocument:t};if("add"===e.op)return a.newDocument=e.value,a;if("replace"===e.op)return a.newDocument=e.value,a.removed=t,a;if("move"===e.op||"copy"===e.op)return a.newDocument=E(t,e.from),"move"===e.op&&(a.removed=t),a;if("test"===e.op){if(a.test=Q(t,e.value),!1===a.test)throw new J("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a.newDocument=t,a}if("remove"===e.op)return a.removed=t,a.newDocument=null,a;if("_get"===e.op)return e.value=t,a;if(i)throw new J("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return a}n||(t=x(t));var r=(e.path||"").split("/"),u=t,l=1,c=r.length,d=void 0,g=void 0,h=void 0;for(h="function"==typeof i?i:F;;){if(g=r[l],s&&"__proto__"==g)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(i&&void 0===d&&(void 0===u[g]?d=r.slice(0,l).join("/"):l==c-1&&(d=e.path),void 0!==d&&h(e,0,t,d)),l++,Array.isArray(u)){if("-"===g)g=u.length;else{if(i&&!N(g))throw new J("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);N(g)&&(g=~~g)}if(l>=c){if(i&&"add"===e.op&&g>u.length)throw new J("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);if(!1===(a=j[e.op].call(e,u,g,t)).test)throw new J("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}}else if(g&&-1!=g.indexOf("~")&&(g=P(g)),l>=c){if(!1===(a=S[e.op].call(e,u,g,t)).test)throw new J("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}u=u[g]}}function M(t,e,i,n,s){if(void 0===n&&(n=!0),void 0===s&&(s=!0),i&&!Array.isArray(e))throw new J("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=x(t));for(var o=new Array(e.length),a=0,r=e.length;a<r;a++)o[a]=Y(t,e[a],i,!0,s,a),t=o[a].newDocument;return o.newDocument=t,o}function B(t,e,i){var n=Y(t,e);if(!1===n.test)throw new J("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return n.newDocument}function F(t,e,i,n){if("object"!=typeof t||null===t||Array.isArray(t))throw new J("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,i);if(!S[t.op])throw new J("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,i);if("string"!=typeof t.path)throw new J("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,i);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new J('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,i);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new J("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new J("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&W(t.value))throw new J("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,i);if(i)if("add"==t.op){var s=t.path.split("/").length,o=n.split("/").length;if(s!==o+1&&s!==o)throw new J("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,i)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==n)throw new J("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,i)}else if("move"===t.op||"copy"===t.op){var a=L([{op:"_get",path:t.from,value:void 0}],i);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new J("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,i)}}function L(t,e,i){try{if(!Array.isArray(t))throw new J("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)M(x(e),x(t),i||!0);else{i=i||F;for(var n=0;n<t.length;n++)i(t[n],n,e,void 0)}}catch(s){if(s instanceof J)return s;throw s}}function Q(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var i,n,s,o=Array.isArray(t),a=Array.isArray(e);if(o&&a){if((n=t.length)!=e.length)return!1;for(i=n;0!=i--;)if(!Q(t[i],e[i]))return!1;return!0}if(o!=a)return!1;var r=Object.keys(t);if((n=r.length)!==Object.keys(e).length)return!1;for(i=n;0!=i--;)if(!e.hasOwnProperty(r[i]))return!1;for(i=n;0!=i--;)if(!Q(t[s=r[i]],e[s]))return!1;return!0}return t!=t&&e!=e}var G=new WeakMap,K=function(){return function(t){this.observers=new Map,this.obj=t}}(),$=function(){return function(t,e){this.callback=t,this.observer=e}}();function H(t,e){e.unobserve()}function V(t,e){var i,n=function(t){return G.get(t)}(t);if(n){var s=function(t,e){return t.observers.get(e)}(n,e);i=s&&s.observer}else n=new K(t),G.set(t,n);if(i)return i;if(i={},n.value=x(t),e){i.callback=e,i.next=null;var o=function(){X(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=[],i.object=t,i.unobserve=function(){X(i),clearTimeout(i.next),function(t,e){t.observers.delete(e.callback)}(n,i),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},n.observers.set(e,new $(e,i)),i}function X(t,e){void 0===e&&(e=!1);var i=G.get(t.object);z(i.value,t.object,t.patches,"",e),t.patches.length&&M(i.value,t.patches);var n=t.patches;return n.length>0&&(t.patches=[],t.callback&&t.callback(n)),n}function z(t,e,i,n,s){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var o=C(e),a=C(t),r=!1,u=a.length-1;u>=0;u--){var l=t[d=a[u]];if(!O(e,d)||void 0===e[d]&&void 0!==l&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(s&&i.push({op:"test",path:n+"/"+I(d),value:x(l)}),i.push({op:"remove",path:n+"/"+I(d)}),r=!0):(s&&i.push({op:"test",path:n,value:t}),i.push({op:"replace",path:n,value:e}));else{var c=e[d];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c?z(l,c,i,n+"/"+I(d),s):l!==c&&(s&&i.push({op:"test",path:n+"/"+I(d),value:x(l)}),i.push({op:"replace",path:n+"/"+I(d),value:x(c)}))}}if(r||o.length!=a.length)for(u=0;u<o.length;u++){var d;O(t,d=o[u])||void 0===e[d]||i.push({op:"add",path:n+"/"+I(d),value:x(e[d])})}}}function tt(t,e,i){void 0===i&&(i=!1);var n=[];return z(t,e,n,"",i),n}const et=Object.assign({},n,s,{JsonPatchError:D,deepClone:x,escapePathComponent:I,unescapePathComponent:P});let it=(()=>{class t{constructor(){}trimObject(t,e){const i={},n=(t,e,i)=>(Object.keys(e).forEach(s=>{e[s]&&"object"!=typeof e[s]?i[s]=t[s]:e[s]&&"object"==typeof e[s]&&(i[s]={},i[s]=n(t[s],e[s],i[s]))}),i);return n(t,e,i),i}calculatePatches(t){let e;if(t.keysToIgnore){const i=(t,e)=>{const i={};return Object.keys(t).filter(t=>-1===e.indexOf(t)).forEach(e=>{i[e]=t[e]}),i};e=et.compare(i(t.oldObject,t.keysToIgnore),i(t.newObject,t.keysToIgnore))}else{if(!t.objectTemplate)throw"bad option for calculate patches";e=et.compare(this.trimObject(t.oldObject,t.objectTemplate),this.trimObject(t.newObject,t.objectTemplate))}return e.map(t=>("add"===t.op&&(t.op="replace"),t))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),nt=(()=>{class t{constructor(t,e,i){this.http=t,this.appConfig=e,this.calculatePatches=i,this.cache={},this.dataVS=new h(this.http,this.setHeaders,this.appConfig),this.dataCustomers=new m(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataUsers=new p(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataPws=new A(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataPrices=new _(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.cacheInit()}cacheInit(){(0,c.D)({pws:this.dataPws.getPws()}).pipe((0,b.P)()).subscribe(t=>{this.cache=t})}setHeaders(t=!1){let e;return e=t?{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(localStorage.getItem("currentUser")).token}`}:{"Content-Type":"application/json"},e}}return t.\u0275fac=function(e){return new(e||t)(u.LFG(y.eN),u.LFG(f.q),u.LFG(it))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=i(7173),ot=i(8512),at=i(6238),rt=i(5959),ut=i(9342),lt=i(8470),ct=i(6673),dt=i(5686),gt=i(6882);class ht{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new mt(t,this.resultSelector))}}class mt extends ct.L{constructor(t,e,i=Object.create(null)){super(t),this.resultSelector=e,this.iterators=[],this.active=0,this.resultSelector="function"==typeof e?e:void 0}_next(t){const e=this.iterators;(0,lt.k)(t)?e.push(new ft(t)):e.push("function"==typeof t[dt.hZ]?new pt(t[dt.hZ]()):new vt(this.destination,this,t))}_complete(){const t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(let i=0;i<e;i++){let e=t[i];e.stillUnsubscribed?this.destination.add(e.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const t=this.iterators,e=t.length,i=this.destination;for(let o=0;o<e;o++){let e=t[o];if("function"==typeof e.hasValue&&!e.hasValue())return}let n=!1;const s=[];for(let o=0;o<e;o++){let e=t[o],a=e.next();if(e.hasCompleted()&&(n=!0),a.done)return void i.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):i.next(s),n&&i.complete()}_tryresultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class pt{constructor(t){this.iterator=t,this.nextResult=t.next()}hasValue(){return!0}next(){const t=this.nextResult;return this.nextResult=this.iterator.next(),t}hasCompleted(){const t=this.nextResult;return Boolean(t&&t.done)}}class ft{constructor(t){this.array=t,this.index=0,this.length=0,this.length=t.length}[dt.hZ](){return this}next(t){const e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class vt extends gt.Ds{constructor(t,e,i){super(t),this.parent=e,this.observable=i,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[dt.hZ](){return this}next(){const t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(t){this.buffer.push(t),this.parent.checkIterators()}subscribe(){return(0,gt.ft)(this.observable,new gt.IY(this))}}var Zt=i(1041),wt=i(104);let bt=(()=>{class t{constructor(){}compareObjects(t,e,i=[]){function n(t){return null!=t&&"object"==typeof t}let s={},o={};return i.length?i.forEach(i=>{s[i]=t[i],o[i]=e[i]}):(s=t,o=e),function t(e,i){const s=Object.keys(e),o=Object.keys(i);if(s.length!==o.length)return!1;for(const a of s){const s=e[a],o=i[a],r=n(s)&&n(o);if(r&&!t(s,o)||!r&&s!==o)return!1}return!0}(s,o)}toChineseNumber(t){if(!Number.isInteger(t)||t<0)throw Error("\u8bf7\u8f93\u5165\u81ea\u7136\u6570");const e=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"],i=["","\u5341","\u767e","\u5343","\u4e07","\u5341\u4e07","\u767e\u4e07","\u5343\u4e07","\u4ebf","\u5341\u4ebf","\u767e\u4ebf","\u5343\u4ebf"],n=String(t).split("");let s="",o=!1;for(let a=0;a<n.length;a++){const t=n[a];"0"===t||o?"0"===t?o=!0:"0"!==t&&o&&(s+="\u96f6"+e[parseInt(t)]+i[n.length-a-1],o=!1):(s+=e[parseInt(t)]+i[n.length-a-1],o=!1)}return t<100&&(s=s.replace("\u4e00\u5341","\u5341")),s}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var At=i(3070),_t=i(9550),Tt=i(4369),yt=i(7307),qt=i(1116);function Ut(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u5165\u5e93\u7ed3\u7b97\u5355"),u.qZA())}function Ot(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u3010\u51fa\u5e93\u3011\u7ed3\u7b97\u5355"),u.qZA())}function Ct(t,e){if(1&t&&(u.ynx(0),u.TgZ(1,"div",16),u._uU(2),u.TgZ(3,"span"),u._uU(4,"\xa0"),u.qZA(),u.qZA(),u.TgZ(5,"div",17),u._uU(6),u.qZA(),u.TgZ(7,"div",33),u._uU(8),u.ALo(9,"number"),u.qZA(),u.TgZ(10,"div",34),u._uU(11),u.ALo(12,"number"),u.qZA(),u.TgZ(13,"div",35),u._uU(14),u.ALo(15,"number"),u.qZA(),u.BQk()),2&t){const t=e.$implicit,i=u.oxw();u.xp6(2),u.Oqu(t?i.getPwCode(t):""),u.xp6(4),u.Oqu(t?i.getPwName(t):""),u.xp6(2),u.Oqu(t?u.xi3(9,5,i.getWeightTon(t),"1.2-2"):""),u.xp6(3),u.Oqu(t?u.xi3(12,8,1e3*i.getTaxExclPrice(t),"1.2-2"):""),u.xp6(3),u.Oqu(t?u.xi3(15,11,i.getAmount(t),"1.2-2"):"")}}const xt=function(t){return{padding:t}};let Nt=(()=>{class t{constructor(t,e,i,n,s){var o;this.auth=t,this.fb=e,this.data=i,this.utils=n,this.dialogRef=s,this.todayDate=new Date,this.valueLessPwId="60b046d142632c04fb202b57",this.taxRatioCtrl=new Zt.NI,this.userName=null===(o=this.auth.getCurrentUser())||void 0===o?void 0:o.displayName;const a=localStorage.getItem("surveyPrintPaddingCache")?JSON.parse(localStorage.getItem("surveyPrintPaddingCache")):{top:0,bottom:0,left:0,right:0};this.paddingForm=this.fb.group(a),this.materialsArr=this.prepareMaterialsArr(this.data.vsws.survey.materials),this.selectedPws=this.data.pws.filter(t=>t.name.indexOf("\u5e9f\u94a2")>-1&&t.name.indexOf("\u516c\u65a4")>-1)}prepareMaterialsArr(t){if(t.length>4)return t;{const e=Array(5).fill(null).map((e,i)=>t[i]?t[i]:null);return console.log(e),e}}getPwCode(t){const e=this.getPwName(t);switch(!0){case e.indexOf("\u8f7b\u8584\u6599")>-1:return 23;case e.indexOf("\u4e2d\u578b")>-1:case e.indexOf("\u6c7d\u6cb9")>-1:case e.indexOf("\u67f4\u6cb9")>-1:return"\u5f85\u67e5";case e.indexOf("\u6742\u8d28")>-1:return 27;default:return"\u5f85\u67e5"}}getWeightTon(t){return t.weightKG/1e3}getTotalWeightTon(t){return t.reduce((t,e)=>e.pwId!==this.valueLessPwId&&e.weightKG?e.weightKG/1e3+t:t,0)}getTaxExclPrice(t){return(t.price||0)*(1-(this.data.vsws.taxRatio||0)/100)}getTotalAmount(t){return t.reduce((t,e)=>e.price?e.price*e.weightKG+t:t,0)}getAveragePrice(t){return Math.round(this.getTotalAmount(t)/this.getTotalWeightTon(t)*100)/100}getAmount(t){return this.getTaxExclPrice(t)*(t.weightKG||0)}getDefaultPrice(t,e){const i=t.pwId,[n]=e.filter(t=>t.pwId===i);return n?1e3*n.numbers.default:""}ngOnInit(){console.log(this.data)}getPwName(t){if(t){const[e]=this.selectedPws.filter(e=>e._id===t.pwId);return e.name.replace("\uff08\u516c\u65a4\uff09","")}return""}ngOnDestroy(){this.paddingForm.dirty&&(console.log("changed"),localStorage.setItem("surveyPrintPaddingCache",JSON.stringify(this.paddingForm.getRawValue())))}closeDialog(){this.dialogRef.close()}get padding(){const t=this.paddingForm.getRawValue();return`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`}onBtnPrintClick(){window.print()}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(wt.e),u.Y36(Zt.qu),u.Y36(r.WI),u.Y36(bt),u.Y36(r.so))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-survey-print"]],decls:95,vars:32,consts:[[1,"noprint",3,"formGroup"],[2,"width","5em"],["type","number","matInput","","formControlName","top"],["type","number","matInput","","formControlName","left"],["type","number","matInput","","formControlName","right"],["mat-button","",3,"click"],["mat-button","",2,"float","right",3,"click"],["id","dataToPrint",1,"t3",3,"ngStyle"],[1,"header"],[1,"header2"],[4,"ngIf"],[1,"meta11"],[1,"meta12"],[1,"meta13"],[1,"meta14"],[1,"meta15"],[1,"item","content1"],[1,"item","content2"],[1,"item","content3"],[1,"item","content4"],[1,"item","lastcolumn","content5"],[4,"ngFor","ngForOf"],[1,"item","lastrow","content1"],[1,"item","lastrow","content2","text-right"],[1,"item","lastrow","content3","number"],[1,"item","lastrow","content4","number"],[1,"item","lastrow","lastcolumn","content5","number"],[1,"footer1"],[1,"footer2"],[1,"footer22"],[1,"footer3"],[1,"footer4"],[1,"footer5"],[1,"item","content3","number"],[1,"item","content4","number"],[1,"item","lastcolumn","content5","number"]],template:function(t,e){1&t&&(u.TgZ(0,"form",0),u.TgZ(1,"mat-form-field",1),u.TgZ(2,"mat-label"),u._uU(3," \u4e0a\u90e8\u7f29\u8fdb "),u.qZA(),u._UZ(4,"input",2),u.qZA(),u.TgZ(5,"span"),u._uU(6,"\xa0"),u.qZA(),u.TgZ(7,"mat-form-field",1),u.TgZ(8,"mat-label"),u._uU(9," \u5de6\u4fa7\u7f29\u8fdb "),u.qZA(),u._UZ(10,"input",3),u.qZA(),u.TgZ(11,"span"),u._uU(12,"\xa0"),u.qZA(),u.TgZ(13,"mat-form-field",1),u.TgZ(14,"mat-label"),u._uU(15," \u53f3\u4fa7\u7f29\u8fdb "),u.qZA(),u._UZ(16,"input",4),u.qZA(),u.TgZ(17,"span"),u._uU(18,"\xa0"),u.qZA(),u.TgZ(19,"button",5),u.NdJ("click",function(){return e.onBtnPrintClick()}),u.TgZ(20,"mat-icon"),u._uU(21,"print"),u.qZA(),u.qZA(),u.TgZ(22,"button",6),u.NdJ("click",function(){return e.closeDialog()}),u.TgZ(23,"mat-icon"),u._uU(24,"close"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(25,"div",7),u.TgZ(26,"div",8),u._uU(27,"\u8fbd\u5b81\u9686\u8fd0\u73af\u4fdd\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8"),u.qZA(),u.TgZ(28,"div",9),u.YNc(29,Ut,2,0,"span",10),u.YNc(30,Ot,2,0,"span",10),u.qZA(),u.TgZ(31,"div",11),u._uU(32,"\u7ed3\u7b97\u5355\u4f4d\uff1a"),u.qZA(),u.TgZ(33,"div",12),u._uU(34),u.qZA(),u._UZ(35,"div",13),u.TgZ(36,"div",14),u._uU(37,"\u7ed3\u7b97\u5355\u53f7\uff1a"),u.qZA(),u.TgZ(38,"div",15),u._uU(39),u.ALo(40,"date"),u.qZA(),u.TgZ(41,"div",11),u._uU(42,"\u53d1\u7968\u5355\u4f4d\uff1a"),u.qZA(),u.TgZ(43,"div",12),u._uU(44),u.qZA(),u._UZ(45,"div",13),u.TgZ(46,"div",14),u._uU(47,"\u8f66\u53f7\uff1a"),u.qZA(),u.TgZ(48,"div",15),u._uU(49),u.qZA(),u.TgZ(50,"div",11),u._uU(51,"\u4ef7\u683c\u8868\uff1a"),u.qZA(),u.TgZ(52,"div",12),u._uU(53,"\u91c7\u8d2d"),u.qZA(),u._UZ(54,"div",13),u.TgZ(55,"div",14),u._uU(56,"\u4ee3\u57ab\u8fd0\u8d39\uff1a"),u.qZA(),u.TgZ(57,"div",15),u._uU(58,"0"),u.qZA(),u.TgZ(59,"div",16),u._uU(60,"\u4ea7\u54c1\u4ee3\u7801"),u.qZA(),u.TgZ(61,"div",17),u._uU(62,"\u4ea7\u54c1\u540d\u79f0"),u.qZA(),u.TgZ(63,"div",18),u._uU(64,"\u7ed3\u7b97\u6570\u91cf(\u5428)"),u.qZA(),u.TgZ(65,"div",19),u._uU(66,"\u7ed3\u7b97\u4ef7\u683c(\u5143/\u5428)"),u.qZA(),u.TgZ(67,"div",20),u._uU(68,"\u7ed3\u7b97\u91d1\u989d(\u5143)"),u.qZA(),u.YNc(69,Ct,16,14,"ng-container",21),u._UZ(70,"div",22),u.TgZ(71,"div",23),u._uU(72),u.qZA(),u.TgZ(73,"div",24),u._uU(74),u.ALo(75,"number"),u.qZA(),u.TgZ(76,"div",25),u._uU(77),u.ALo(78,"number"),u.qZA(),u.TgZ(79,"div",26),u._uU(80),u.ALo(81,"number"),u.qZA(),u.TgZ(82,"div",27),u._uU(83,"\u6253\u5370\u65e5\u671f\uff1a"),u.qZA(),u.TgZ(84,"div",28),u.TgZ(85,"span"),u._uU(86),u.ALo(87,"date"),u.qZA(),u.TgZ(88,"span",29),u._uU(89,"\u7ed3\u7b97\u4eba\u5458\uff1a"),u.qZA(),u.qZA(),u.TgZ(90,"div",30),u._uU(91),u.qZA(),u.TgZ(92,"div",31),u._uU(93,"\u8d1f\u8d23\u4eba\uff1a"),u.qZA(),u._UZ(94,"div",32),u.qZA()),2&t&&(u.Q6J("formGroup",e.paddingForm),u.xp6(25),u.Q6J("ngStyle",u.VKq(30,xt,e.padding)),u.xp6(4),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(4),u.Oqu(e.data.vsws.weighing.customerName),u.xp6(5),u.Oqu(u.xi3(40,15,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"yMMddHHmm")),u.xp6(5),u.Oqu(e.data.vsws.weighing.customerName),u.xp6(5),u.Oqu(e.data.vsws.weighing.truckPlateNo),u.xp6(20),u.Q6J("ngForOf",e.materialsArr),u.xp6(3),u.Oqu("\u5408\u8ba1\uff08\u542b\u7a0e\uff0c\u7a0e\u70b9"+e.data.vsws.taxRatio+"\uff09\uff1a"),u.xp6(2),u.Oqu(u.xi3(75,18,e.getTotalWeightTon(e.data.vsws.survey.materials),"1.2-2")),u.xp6(3),u.Oqu(u.xi3(78,21,e.getAveragePrice(e.data.vsws.survey.materials),"1.2-2")),u.xp6(3),u.Oqu(u.xi3(81,24,e.getTotalAmount(e.data.vsws.survey.materials),"1.2-2")),u.xp6(6),u.Oqu(u.xi3(87,27,e.todayDate,"y-MM-dd HH:mm")),u.xp6(5),u.Oqu(e.userName))},directives:[Zt._Y,Zt.JL,Zt.sg,At.KE,At.hX,Zt.wV,_t.Nt,Zt.Fj,Zt.JJ,Zt.u,Tt.lW,yt.Hw,qt.PC,qt.O5,qt.sg],pipes:[qt.uU,qt.JJ],styles:['.t3[_ngcontent-%COMP%]{display:grid;grid-template-areas:"h1 h1 h1 h1 h1" "h2 h2 h2 h2 h2" "m11 m12 m13 m14 m15" "m11 m12 m13 m14 m15" "m11 m12 m13 m14 m15" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "F1 F2 F3 F4 F5";grid-template-columns:2fr 7fr 3fr 3fr 3fr}.item.number[_ngcontent-%COMP%]{padding-right:1em}.footer1[_ngcontent-%COMP%], .item.number[_ngcontent-%COMP%], .meta11[_ngcontent-%COMP%], .meta14[_ngcontent-%COMP%]{text-align:right}.footer22[_ngcontent-%COMP%]{float:right}.footer4[_ngcontent-%COMP%]{text-align:right}.title[_ngcontent-%COMP%]{font-style:italic}.content[_ngcontent-%COMP%]{font-size:1.1em}.meta1[_ngcontent-%COMP%]{grid-area:m1}.meta2[_ngcontent-%COMP%]{grid-area:m2}.meta3[_ngcontent-%COMP%]{grid-area:m3}.netweightbc[_ngcontent-%COMP%]{grid-area:nwbc}.item[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;text-align:center}.lastrow[_ngcontent-%COMP%]{border-bottom:1px solid #000}.lastcolumn[_ngcontent-%COMP%]{border-right:1px solid #000}.header[_ngcontent-%COMP%]{grid-area:h1;font-size:1.3em}.header[_ngcontent-%COMP%], .header2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.3em}.header2[_ngcontent-%COMP%]{grid-area:h2;font-size:1.5em}.meta[_ngcontent-%COMP%]{margin-bottom:.3em}.meta3[_ngcontent-%COMP%], .text-right[_ngcontent-%COMP%]{text-align:right}']}),t})();function It(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\uff08\u7269\u8d44\u8fdb\u573a\uff09"),u.qZA())}function Pt(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\uff08\u7269\u8d44\u51fa\u573a\uff09"),u.qZA())}function Wt(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u6bdb\u91cd"),u.qZA())}function kt(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u76ae\u91cd"),u.qZA())}function Dt(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u76ae\u91cd"),u.qZA())}function Jt(t,e){1&t&&(u.TgZ(0,"span"),u._uU(1,"\u6bdb\u91cd"),u.qZA())}const Rt=function(t){return{padding:t}};let St=(()=>{class t{constructor(t,e,i,n){this.fb=t,this.data=e,this.utils=i,this.dialogRef=n;const s=localStorage.getItem("paddingCache")?JSON.parse(localStorage.getItem("paddingCache")):{top:0,bottom:0,left:0,right:0};this.paddingForm=this.fb.group(s)}ngOnInit(){console.log(this.data)}ngOnDestroy(){this.paddingForm.dirty&&(console.log("changed"),localStorage.setItem("paddingCache",JSON.stringify(this.paddingForm.getRawValue())))}closeDialog(){this.dialogRef.close()}onBtnPrintClick(){window.print()}get padding(){const t=this.paddingForm.getRawValue();return`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(Zt.qu),u.Y36(r.WI),u.Y36(bt),u.Y36(r.so))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-print"]],decls:87,vars:34,consts:[[1,"noprint",3,"formGroup"],[2,"width","5em"],["type","number","matInput","","formControlName","top"],["type","number","matInput","","formControlName","left"],["type","number","matInput","","formControlName","right"],["mat-button","",3,"click"],["mat-button","",2,"float","right",3,"click"],["id","dataToPrint",1,"t3",3,"ngStyle"],[1,"header"],[4,"ngIf"],[1,"meta","meta1"],[1,"meta","meta2"],[1,"meta","meta3"],[1,"item","title"],[1,"item","content"],[1,"item","lastcolumn","content"],[1,"item","lastrow","title","netweightat"],[1,"item","lastrow","content","netweightac"],[1,"item","lastrow","title","netweightbt"],[1,"item","lastrow","lastcolumn","content","netweightbc"]],template:function(t,e){1&t&&(u.TgZ(0,"form",0),u.TgZ(1,"mat-form-field",1),u.TgZ(2,"mat-label"),u._uU(3," \u4e0a\u90e8\u7f29\u8fdb "),u.qZA(),u._UZ(4,"input",2),u.qZA(),u.TgZ(5,"span"),u._uU(6,"\xa0"),u.qZA(),u.TgZ(7,"mat-form-field",1),u.TgZ(8,"mat-label"),u._uU(9," \u5de6\u4fa7\u7f29\u8fdb "),u.qZA(),u._UZ(10,"input",3),u.qZA(),u.TgZ(11,"span"),u._uU(12,"\xa0"),u.qZA(),u.TgZ(13,"mat-form-field",1),u.TgZ(14,"mat-label"),u._uU(15," \u53f3\u4fa7\u7f29\u8fdb "),u.qZA(),u._UZ(16,"input",4),u.qZA(),u.TgZ(17,"span"),u._uU(18,"\xa0"),u.qZA(),u.TgZ(19,"button",5),u.NdJ("click",function(){return e.onBtnPrintClick()}),u.TgZ(20,"mat-icon"),u._uU(21,"print"),u.qZA(),u.qZA(),u.TgZ(22,"button",6),u.NdJ("click",function(){return e.closeDialog()}),u.TgZ(23,"mat-icon"),u._uU(24,"close"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(25,"div",7),u.TgZ(26,"div",8),u._uU(27,"\u8fbd\u5b81\u9686\u8fd0\u73af\u4fdd\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8 - \u8fc7\u78c5\u5355"),u.YNc(28,It,2,0,"span",9),u.YNc(29,Pt,2,0,"span",9),u.qZA(),u.TgZ(30,"div",10),u._uU(31),u.ALo(32,"date"),u.qZA(),u._UZ(33,"div",11),u.TgZ(34,"div",12),u._uU(35,"\u5355\u4f4d\uff1a\u516c\u65a4"),u.qZA(),u.TgZ(36,"div",13),u._uU(37,"\u8f66\u53f7"),u.qZA(),u.TgZ(38,"div",14),u._uU(39),u.qZA(),u.TgZ(40,"div",13),u._uU(41,"\u7269\u8d44"),u.qZA(),u.TgZ(42,"div",14),u._uU(43,"\u8f66\u8f86\u5e9f\u94a2"),u.qZA(),u.TgZ(44,"div",13),u._uU(45,"\u5ba2\u6237"),u.qZA(),u.TgZ(46,"div",15),u._uU(47),u.qZA(),u.TgZ(48,"div",13),u.YNc(49,Wt,2,0,"span",9),u.YNc(50,kt,2,0,"span",9),u.qZA(),u.TgZ(51,"div",14),u._uU(52),u.ALo(53,"number"),u.qZA(),u.TgZ(54,"div",13),u._uU(55,"\u53f8\u78c5\u5458"),u.qZA(),u.TgZ(56,"div",14),u._uU(57,"\u8d85\u7ea7\u6743\u9650"),u.qZA(),u.TgZ(58,"div",13),u._uU(59,"\u65e5\u671f"),u.qZA(),u.TgZ(60,"div",15),u._uU(61),u.ALo(62,"date"),u.qZA(),u.TgZ(63,"div",13),u.YNc(64,Dt,2,0,"span",9),u.YNc(65,Jt,2,0,"span",9),u.qZA(),u.TgZ(66,"div",14),u._uU(67),u.ALo(68,"number"),u.qZA(),u.TgZ(69,"div",13),u._uU(70,"\u53f8\u78c5\u5458"),u.qZA(),u.TgZ(71,"div",14),u._uU(72,"\u8d85\u7ea7\u6743\u9650"),u.qZA(),u.TgZ(73,"div",13),u._uU(74,"\u65e5\u671f"),u.qZA(),u.TgZ(75,"div",15),u._uU(76),u.ALo(77,"date"),u.qZA(),u.TgZ(78,"div",16),u._uU(79,"\u51c0\u91cd"),u.qZA(),u.TgZ(80,"div",17),u._uU(81),u.ALo(82,"number"),u.qZA(),u.TgZ(83,"div",18),u._uU(84,"\u51c0\u91cd\u5927\u5199"),u.qZA(),u.TgZ(85,"div",19),u._uU(86),u.qZA(),u.qZA()),2&t&&(u.Q6J("formGroup",e.paddingForm),u.xp6(25),u.Q6J("ngStyle",u.VKq(32,Rt,e.padding)),u.xp6(3),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(2),u.hij("\u5e8f\u53f7\uff1a",u.xi3(32,17,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"yMMddHHmm"),""),u.xp6(8),u.Oqu(e.data.vsws.weighing.truckPlateNo),u.xp6(8),u.Oqu(e.data.vsws.weighing.customerName),u.xp6(2),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(2),u.Oqu(u.lcZ(53,20,e.data.vsws.weighing.inWeightKG)),u.xp6(9),u.Oqu(u.xi3(62,22,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"y-MM-dd HH:mm")),u.xp6(3),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(2),u.Oqu(u.lcZ(68,25,e.data.vsws.weighing.outWeightKG)),u.xp6(9),u.Oqu(u.xi3(77,27,null==e.data.vsws.weighing?null:e.data.vsws.weighing.outWeighedAt,"y-MM-dd HH:mm")),u.xp6(5),u.Oqu(u.lcZ(82,30,(e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)*(e.data.vsws.isOutbound?-1:1))),u.xp6(5),u.hij(" ",e.utils.toChineseNumber((e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)*(e.data.vsws.isOutbound?-1:1))," "))},directives:[Zt._Y,Zt.JL,Zt.sg,At.KE,At.hX,Zt.wV,_t.Nt,Zt.Fj,Zt.JJ,Zt.u,Tt.lW,yt.Hw,qt.PC,qt.O5],pipes:[qt.uU,qt.JJ],styles:['.t3[_ngcontent-%COMP%]{display:grid;grid-template-areas:"h1 h1 h1 h1 h1 h1" "m1 m1 m2 m2 m2 m3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "nwat nwac nwbt nwbc nwbc nwbc";grid-template-columns:1.5fr 3.5fr 2fr 3.5fr 2fr 7.5fr}.header[_ngcontent-%COMP%]{grid-area:h1}.title[_ngcontent-%COMP%]{font-style:italic}.content[_ngcontent-%COMP%]{font-size:1.1em}.meta1[_ngcontent-%COMP%]{grid-area:m1}.meta2[_ngcontent-%COMP%]{grid-area:m2}.meta3[_ngcontent-%COMP%]{grid-area:m3}.netweightbc[_ngcontent-%COMP%]{grid-area:nwbc}.item[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;text-align:center}.lastrow[_ngcontent-%COMP%]{border-bottom:1px solid #000}.lastcolumn[_ngcontent-%COMP%]{border-right:1px solid #000}.header[_ngcontent-%COMP%]{font-size:1.5em;text-align:center}.header[_ngcontent-%COMP%], .meta[_ngcontent-%COMP%]{margin-bottom:.3em}.meta3[_ngcontent-%COMP%]{text-align:right}']}),t})();var jt=i(7727),Et=i(2797);function Yt(t,e){1&t&&(u.ynx(0),u.TgZ(1,"button",3),u._uU(2,"\u662f"),u.qZA(),u.TgZ(3,"button",4),u._uU(4," \u5426 "),u.qZA(),u.BQk()),2&t&&(u.xp6(1),u.Q6J("mat-dialog-close",!0),u.xp6(2),u.Q6J("mat-dialog-close",!1))}function Mt(t,e){1&t&&(u.ynx(0),u.TgZ(1,"button",3),u._uU(2,"\u786e\u5b9a"),u.qZA(),u.BQk()),2&t&&(u.xp6(1),u.Q6J("mat-dialog-close",!0))}let Bt=(()=>{class t{constructor(t,e){this.data=t,this.dialogRef=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(r.WI),u.Y36(r.so))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-alert"]],decls:9,vars:4,consts:[["mat-dialog-title",""],["align","end"],[4,"ngIf"],["mat-button","","color","primary",3,"mat-dialog-close"],["mat-raised-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(t,e){1&t&&(u.TgZ(0,"h2",0),u._uU(1),u.qZA(),u.TgZ(2,"mat-dialog-content"),u.TgZ(3,"mat-card"),u.TgZ(4,"mat-card-content"),u._uU(5),u.qZA(),u.qZA(),u.qZA(),u.TgZ(6,"mat-dialog-actions",1),u.YNc(7,Yt,5,2,"ng-container",2),u.YNc(8,Mt,3,1,"ng-container",2),u.qZA()),2&t&&(u.xp6(1),u.Oqu(e.data.alert.title),u.xp6(4),u.hij(" ",e.data.alert.message," "),u.xp6(2),u.Q6J("ngIf",!e.data.alert.okOnly),u.xp6(1),u.Q6J("ngIf",e.data.alert.okOnly))},directives:[r.uh,r.xY,Et.a8,Et.dn,r.H8,qt.O5,Tt.lW,r.ZT],styles:[""]}),t})(),Ft=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return this.dialog.open(Bt,{disableClose:!0,data:{alert:t}})}}return t.\u0275fac=function(e){return new(e||t)(u.LFG(r.uw))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Lt=(()=>{class t{constructor(t,e,i,n,s,o){this.fb=t,this.data=e,this.dialogRef=i,this.utils=n,this.backend=s,this.alert=o,this.status$=(0,v.of)(),this.status={changed:!1},this.dialogTitle=this.data.customer._id?"\u7f16\u8f91\u5ba2\u6237":"\u65b0\u5efa\u5ba2\u6237",this.formX=this.fb.group({_id:[this.data.customer._id],name:[{value:this.data.customer.name,disabled:!!this.data.customer._id},Zt.kI.required],mobile:[this.data.customer.mobile,[Zt.kI.required,Zt.kI.pattern(/^[0-9]*$/)]],notes:[this.data.customer.notes]})}ngOnInit(){this.status$=this.formX.valueChanges.pipe((0,w.b)(t=>{this.status.changed=!this.utils.compareObjects(this.formX.getRawValue(),this.data.customer,["name","mobile","notes"]),console.log("status",this.status)}))}onSubmit(){console.log("at onSubmit");const t=this.formX.getRawValue(),e=this.data.customer;this.backend.dataCustomers.save({newCustomer:t,oldCustomer:e}).pipe((0,b.P)(),(0,jt.K)(t=>(0,v.of)(t))).subscribe(i=>{console.log(i),i.collection_upsert||i._id?this.dialogRef.close(e._id?t:i):(console.log("got error"),console.log(i))})}onCancel(){console.log("at onCancel"),this.status.changed?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(Zt.qu),u.Y36(r.WI),u.Y36(r.so),u.Y36(bt),u.Y36(nt),u.Y36(Ft))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-customer-dialog"]],decls:31,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],["matInput","","formControlName","name"],["matInput","","formControlName","mobile"],["matInput","","formControlName","notes"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],["type","text",2,"display","none",3,"value"]],template:function(t,e){1&t&&(u.TgZ(0,"h2",0),u._uU(1),u.qZA(),u.TgZ(2,"form",1),u.TgZ(3,"mat-dialog-content"),u.TgZ(4,"mat-card"),u.TgZ(5,"mat-card-content"),u.TgZ(6,"mat-form-field"),u.TgZ(7,"mat-label"),u._uU(8," \u5ba2\u6237\u540d\u79f0 "),u.qZA(),u._UZ(9,"input",2),u.qZA(),u.TgZ(10,"span"),u._uU(11,"\xa0"),u.qZA(),u.TgZ(12,"mat-form-field"),u.TgZ(13,"mat-label"),u._uU(14," \u5ba2\u6237\u624b\u673a "),u.qZA(),u._UZ(15,"input",3),u.qZA(),u._UZ(16,"br"),u.TgZ(17,"mat-form-field"),u.TgZ(18,"mat-label"),u._uU(19," \u5907\u6ce8 "),u.qZA(),u._UZ(20,"textarea",4),u.qZA(),u.TgZ(21,"span"),u._uU(22,"\xa0"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(23,"mat-dialog-actions",5),u.TgZ(24,"button",6),u.NdJ("click",function(){return e.onCancel()}),u._uU(25,"\u53d6\u6d88"),u.qZA(),u.TgZ(26,"button",7),u.NdJ("click",function(){return e.onSubmit()}),u._uU(27," \u4fdd\u5b58 "),u.qZA(),u.qZA(),u.qZA(),u._UZ(28,"input",8),u.ALo(29,"json"),u.ALo(30,"async")),2&t&&(u.xp6(1),u.Oqu(e.dialogTitle),u.xp6(1),u.Q6J("formGroup",e.formX),u.xp6(24),u.Q6J("disabled",e.formX.invalid||!e.status.changed),u.xp6(2),u.Q6J("value",u.lcZ(29,4,u.lcZ(30,6,e.status$))))},directives:[r.uh,Zt._Y,Zt.JL,Zt.sg,r.xY,Et.a8,Et.dn,At.KE,At.hX,_t.Nt,Zt.Fj,Zt.JJ,Zt.u,r.H8,Tt.lW],pipes:[qt.Ts,qt.Ov],styles:[""]}),t})(),Qt=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return console.log("opening cutomerDialog with data:"),console.log(t),this.dialog.open(Lt,{disableClose:!0,data:{customer:t}})}}return t.\u0275fac=function(e){return new(e||t)(u.LFG(r.uw))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac}),t})();var Gt=i(9961),Kt=i(7064),$t=i(3841);const Ht=["formRows"];function Vt(t,e){if(1&t&&(u.TgZ(0,"button",36),u._uU(1),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Oqu(t.dialogTitle)}}function Xt(t,e){if(1&t&&(u.TgZ(0,"button",37),u._uU(1),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Oqu(t.dialogTitle)}}function zt(t,e){if(1&t&&(u.TgZ(0,"mat-option",38),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.Q6J("value",t),u.xp6(1),u.hij(" ",t," ")}}function te(t,e){if(1&t&&(u.TgZ(0,"mat-option",38),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.Q6J("value",t.name),u.xp6(1),u.hij(" ",t.name," ")}}function ee(t,e){if(1&t&&(u.ynx(0),u._UZ(1,"input",39),u.TgZ(2,"mat-autocomplete",null,40),u.YNc(4,te,2,2,"mat-option",8),u.ALo(5,"async"),u.qZA(),u.BQk()),2&t){const t=u.MAs(3),e=u.oxw();u.xp6(1),u.Q6J("matAutocompleteDisabled",!!e.data.vsws.weighing.customerId)("matAutocomplete",t),u.xp6(3),u.Q6J("ngForOf",u.lcZ(5,3,e.possibleCustomers$))}}function ie(t,e){1&t&&(u.ynx(0),u._UZ(1,"input",41),u.BQk())}function ne(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",42),u.NdJ("click",function(){u.CHM(t);const e=u.oxw();return e.openCustomerDialog(e.customer)}),u._uU(1,"\u65b0\u5efa\u5ba2\u6237"),u.qZA()}if(2&t){const t=u.oxw();u.Q6J("disabled",t.loadingPossibleCustomers)}}function se(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",43),u.NdJ("click",function(){u.CHM(t);const e=u.oxw();return e.openCustomerDialog(e.customer)}),u._uU(1,"\u7f16\u8f91\u5ba2\u6237"),u.qZA()}if(2&t){const t=u.oxw();u.Q6J("disabled",t.disableEditCustomerButton)}}function oe(t,e){1&t&&(u.TgZ(0,"mat-form-field"),u.TgZ(1,"mat-label"),u._uU(2,"\u6bdb\u91cd\uff08\u516c\u65a4\uff09"),u.qZA(),u._UZ(3,"input",44),u.TgZ(4,"mat-icon",6),u._uU(5,"\u91cd"),u.qZA(),u.qZA())}function ae(t,e){1&t&&(u.TgZ(0,"mat-form-field"),u.TgZ(1,"mat-label"),u._uU(2,"\u76ae\u91cd\uff08\u516c\u65a4\uff09"),u.qZA(),u._UZ(3,"input",44),u.TgZ(4,"mat-icon",6),u._uU(5,"\u8f7b"),u.qZA(),u.qZA())}function re(t,e){1&t&&(u.TgZ(0,"mat-form-field"),u.TgZ(1,"mat-label"),u._uU(2,"\u76ae\u91cd\uff08\u516c\u65a4\uff09"),u.qZA(),u._UZ(3,"input",45),u.TgZ(4,"mat-icon",6),u._uU(5,"\u8f7b"),u.qZA(),u.qZA())}function ue(t,e){1&t&&(u.TgZ(0,"mat-form-field"),u.TgZ(1,"mat-label"),u._uU(2,"\u6bdb\u91cd\uff08\u516c\u65a4\uff09"),u.qZA(),u._UZ(3,"input",45),u.TgZ(4,"mat-icon",6),u._uU(5,"\u91cd"),u.qZA(),u.qZA())}function le(t,e){if(1&t&&(u.TgZ(0,"button",46),u._uU(1),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.hij(" ",null!=t.vswsForm.errors&&t.vswsForm.errors.weightError?"\u76ae\u91cd\u4e0d\u80fd\u5927\u4e8e\u6bdb\u91cd":""," ")}}function ce(t,e){1&t&&(u.TgZ(0,"button",46),u._uU(1," \u6ce8\u610f\uff1a\u7269\u8d44\u603b\u91cd\u5df2\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd "),u.qZA())}function de(t,e){if(1&t&&(u.TgZ(0,"button",23),u._uU(1),u.ALo(2,"number"),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.hij("\u3010",u.xi3(2,1,t.status.materialTotalWeight,"1.0-0"),"\u516c\u65a4\u3011")}}function ge(t,e){if(1&t&&(u.TgZ(0,"button",46),u._uU(1),u.ALo(2,"number"),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.hij("\u3010",u.xi3(2,1,t.status.materialTotalWeight,"1.0-0"),"\u516c\u65a4\u3011")}}function he(t,e){1&t&&(u.TgZ(0,"button",23),u._uU(1," \u6dfb\u52a0\u7269\u8d44\u524d\uff0c\u8bf7\u5f55\u5165\u6709\u6548\u8fc7\u78c5\u6570\u636e\u5e76\u4fdd\u5b58 "),u.qZA())}function me(t,e){1&t&&(u.TgZ(0,"button",46),u._uU(1," \u7269\u8d44\u603b\u91cd\u4e0d\u80fd\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd "),u.qZA())}function pe(t,e){if(1&t&&(u.TgZ(0,"mat-option",38),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.Q6J("value",t._id),u.xp6(1),u.hij(" ",t.name," ")}}function fe(t,e){if(1&t&&(u.TgZ(0,"mat-form-field",54),u.TgZ(1,"mat-label"),u._uU(2,"\u6570\u91cf"),u.qZA(),u._UZ(3,"input",26),u.qZA()),2&t){const t=u.oxw().$implicit;u.xp6(3),u.Q6J("formControl",t.get("count"))}}function ve(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",55),u.NdJ("click",function(){u.CHM(t);const e=u.oxw().index;return u.oxw().removeMaterial(e)}),u._uU(1,"\u5220\u9664"),u.qZA()}}function Ze(t,e){if(1&t&&(u.TgZ(0,"div",null,47),u.TgZ(2,"mat-card"),u.TgZ(3,"mat-card-content"),u.TgZ(4,"mat-form-field"),u.TgZ(5,"mat-label"),u._uU(6,"\u7269\u8d44\u540d\u79f0"),u.qZA(),u.TgZ(7,"mat-select",48,49),u.YNc(9,pe,2,2,"mat-option",8),u.qZA(),u.TgZ(10,"span",6),u._uU(11),u.qZA(),u.qZA(),u.TgZ(12,"span"),u._uU(13,"\xa0"),u.qZA(),u.TgZ(14,"mat-form-field",50),u.TgZ(15,"mat-label"),u._uU(16,"\u91cd\u91cf"),u.qZA(),u._UZ(17,"input",26),u.TgZ(18,"span",27),u._uU(19,"\u516c\u65a4"),u.qZA(),u.qZA(),u.TgZ(20,"span"),u._uU(21,"\xa0"),u.qZA(),u.TgZ(22,"mat-form-field",50),u.TgZ(23,"mat-label"),u._uU(24,"\u4ef7\u683c\uff08\u542b\u7a0e\uff09"),u.qZA(),u._UZ(25,"input",26),u.TgZ(26,"span",27),u._uU(27,"\u5143/\u516c\u65a4"),u.qZA(),u.qZA(),u.TgZ(28,"span"),u._uU(29,"\xa0"),u.qZA(),u.TgZ(30,"mat-form-field",50),u.TgZ(31,"mat-label"),u._uU(32,"\u91d1\u989d"),u.qZA(),u._UZ(33,"input",19),u.TgZ(34,"span",27),u._uU(35,"\u5143"),u.qZA(),u.qZA(),u.TgZ(36,"span"),u._uU(37,"\xa0"),u.qZA(),u.YNc(38,fe,4,1,"mat-form-field",51),u._UZ(39,"br"),u.TgZ(40,"mat-form-field",21),u.TgZ(41,"mat-label"),u._uU(42," \u5907\u6ce8 "),u.qZA(),u._UZ(43,"textarea",52),u.qZA(),u.TgZ(44,"span"),u._uU(45,"\xa0"),u.qZA(),u.YNc(46,ve,2,0,"button",53),u.qZA(),u.qZA(),u._UZ(47,"br"),u.qZA()),2&t){const t=e.$implicit,i=e.index,n=u.MAs(8),s=u.oxw();let o,a;u.xp6(7),u.Q6J("formControl",t.get("pwId")),u.xp6(2),u.Q6J("ngForOf",s.selectedPws),u.xp6(2),u.hij("",i+1,"\xa0\xa0"),u.xp6(6),u.Q6J("formControl",t.get("weightKG")),u.xp6(8),u.Q6J("formControl",t.get("price")),u.xp6(8),u.Q6J("value",t.get("weightKG").value*t.get("price").value),u.xp6(5),u.Q6J("ngIf",n.selected&&(null==(o=n.selected)?null:o.viewValue.indexOf("\u53d1\u52a8\u673a"))>-1),u.xp6(5),u.Q6J("formControl",t.get("notes")),u.xp6(3),u.Q6J("ngIf",!(null!=(a=t.get("inventoryId"))&&a.value))}}let we=(()=>{class t{constructor(t,e,i,n,s,o,a,r,u){var l;this.data=t,this.fb=e,this.backend=i,this.customerDialog=n,this.auth=s,this.alert=o,this.calculatePatches=a,this.dialog=r,this.dialogRef=u,this.truckPlateNoOptions=["\u8fbdN"],this.subscriptions_=[],this.possibleCustomers$=(0,v.of)([]),this.loadingPossibleCustomers=!1,this.disableEditCustomerButton=!0,this.customer={name:""},this.selectedPws=[],this.status={showNewCustomerButton:!1,observables:{valueChanges:(0,v.of)(null)},netWeightKG:0,materialTotalWeight:0,materialTotalCost:0,lastValue:{outWeightKG:0}},this.objectTemplate={_id:!0,isDeleted:!0,deletedAt:!0,taxRatio:!0,isOutbound:!0,weighing:{truckPlateNo:!0,customerId:!0,inWeightKG:!0,inWeighedAt:!0,inWeighedBy:!0,outWeightKG:!0,outWeighedAt:!0,outWeighedBy:!0,notes:!0},survey:{surveyedBy:!0,surveyedAt:!0,materials:!0}},this.totalMaterialWeightGreaterThanWeighingNetweight=!1;const c=this.auth.getCurrentUser();this.selectedPws=this.data.pws.filter(t=>t.name.indexOf("\u5e9f\u94a2")>-1&&t.name.indexOf("\u516c\u65a4")>-1),console.log(this.selectedPws),console.log(this.data.vsws),this.status.lastValue.outWeightKG=this.data.vsws.weighing.outWeightKG,this.status.netWeightKG=this.data.vsws.weighing.outWeightKG&&this.data.vsws.weighing.inWeightKG?this.data.vsws.weighing.outWeightKG-this.data.vsws.weighing.inWeightKG:0,this.data.vsws.survey.materials&&this.data.vsws.survey.materials.length?(console.log(this.data.vsws.survey.materials),this.materialsFormArray=this.fb.array(null===(l=this.data.vsws.survey.materials)||void 0===l?void 0:l.map(t=>this.fb.group({pwId:[{value:t.pwId,disabled:!0}],weightKG:t.weightKG,count:t.count,price:t.price,notes:t.notes,inventoryId:t.inventoryId})))):this.materialsFormArray=this.fb.array([]),this.vswsForm=this.fb.group({_id:this.data.vsws._id,isDeleted:this.data.vsws.isDeleted,deletedAt:this.data.vsws.deletedAt,deletedBy:this.data.vsws.deletedBy,deletedNotes:this.data.vsws.deletedNotes,isOutbound:this.data.vsws.isOutbound,taxRatio:this.data.vsws.taxRatio,weighing:this.fb.group({truckPlateNo:[{value:this.data.vsws.weighing.truckPlateNo,disabled:!!this.data.vsws.weighing.truckPlateNo},[Zt.kI.required,Zt.kI.minLength(7)]],customerId:this.data.vsws.weighing.customerId,customerName:[{value:this.data.vsws.weighing.customerName,disabled:!!this.data.vsws.weighing.customerName}],customerTel:[{value:this.data.vsws.weighing.customerTel,disabled:!0}],inWeightKG:[{value:this.data.vsws.weighing.inWeightKG,disabled:!1}],inWeighedDate:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toLocaleDateString().split("/").map(t=>t.padStart(2,"0")).join("-"):"",inWeighedTime:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toTimeString().substring(0,5):"",inWeighedBy:this.data.vsws.weighing.inWeighedBy?this.data.vsws.weighing.inWeighedBy:null==c?void 0:c._id,inWeighedByName:[{value:this.data.vsws.weighing.inWeighedByName?this.data.vsws.weighing.inWeighedByName:null==c?void 0:c.displayName,disabled:!0}],outWeightKG:[{value:this.data.vsws.weighing.outWeightKG,disabled:!1}],outWeighedDate:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toISOString().substring(0,10):"",outWeighedTime:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toTimeString().substring(0,5):"",outWeighedBy:this.data.vsws.weighing.outWeighedBy,outWeighedByName:[{value:this.data.vsws.weighing.outWeighedByName,disabled:!0}],notes:this.data.vsws.weighing.notes}),survey:this.fb.group({surveyedBy:this.data.vsws.survey.surveyedBy,surveyedByName:[{value:this.data.vsws.survey.surveyedByName,disabled:!0}],surveyedDate:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toISOString().substring(0,10):"",disabled:!!this.data.vsws.survey.surveyedAt}],surveyedTime:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toTimeString().substring(0,5):"",disabled:!!this.data.vsws.survey.surveyedAt}],materials:this.materialsFormArray})}),this.dialogTitle=this.data.vsws.isOutbound?this.data.vsws._id?"\u7f16\u8f91\u7269\u8d44\u51fa\u573a":"\u65b0\u5efa\u7269\u8d44\u51fa\u573a":this.data.vsws._id?"\u7f16\u8f91\u7269\u8d44\u8fdb\u573a":"\u65b0\u5efa\u7269\u8d44\u8fdb\u573a"}ngOnDestroy(){var t;null===(t=this.sub0_)||void 0===t||t.unsubscribe()}ngOnInit(){var t,e;this.status.observables.valueChanges=this.vswsForm.valueChanges.pipe((0,at.O)(this.vswsForm.getRawValue()),(0,w.b)(t=>{const e=t.survey.materials;console.log({value:t}),e.forEach((t,e)=>{}),setTimeout(()=>{var i,n;this.status.materialTotalCost=e.reduce((t,e)=>t+e.price*e.weightKG,0),this.status.materialTotalWeight=e.reduce((t,e)=>t+1*e.weightKG,0);const s=t.weighing.inWeightKG,o=t.weighing.outWeightKG;if(!this.status.lastValue.outWeightKG&&o){const t=new Date;this.vswsForm.patchValue({weighing:{outWeighedDate:t.toISOString().substring(0,10),outWeighedTime:t.toTimeString().substring(0,5),outWeighedBy:null===(i=this.auth.getCurrentUser())||void 0===i?void 0:i._id,outWeighedByName:null===(n=this.auth.getCurrentUser())||void 0===n?void 0:n.displayName}},{emitEvent:!1}),this.status.lastValue.outWeightKG=o}this.status.netWeightKG=this.data.vsws.isOutbound?s&&o?o-s:0:s&&o?s-o:0,this.status.netWeightKG<0&&this.vswsForm.setErrors({weightError:!0}),this.totalMaterialWeightGreaterThanWeighingNetweight=this.status.materialTotalWeight>this.status.netWeightKG},0)})),this.sub0_=this.status.observables.valueChanges.subscribe(),this.possibleCustomers$=null===(t=this.vswsForm.get("weighing.customerName"))||void 0===t?void 0:t.valueChanges.pipe((0,at.O)(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.value),(0,Z.w)(t=>(this.loadingPossibleCustomers=!0,t?this.backend.dataCustomers.search({name:{$regex:`.*${t}.*`}}).pipe((0,d.U)(e=>({customerNameX:t,possibleCustomers:e}))):(0,v.of)([]).pipe((0,d.U)(e=>({customerNameX:t,possibleCustomers:e}))))),(0,w.b)(t=>{var e,i,n,s,o;console.log(t);const a=t.possibleCustomers.find(e=>e.name===t.customerNameX);this.status.showNewCustomerButton=!(!(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.dirty)||t.customerNameX&&(!t.customerNameX||a)),this.disableEditCustomerButton=!t.customerNameX,a?(this.customer=a,this.vswsForm.patchValue({weighing:{customerTel:null==a?void 0:a.mobile,customerId:null==a?void 0:a._id}},{emitEvent:!1})):(null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i?void 0:i.value)&&(null===(n=this.vswsForm.get("weighing.customerName"))||void 0===n||n.setErrors({notFound:!0}),this.customer={name:t.customerNameX,mobile:""},null===(s=this.vswsForm.get("weighing.customerTel"))||void 0===s||s.setValue(""),null===(o=this.vswsForm.get("weighing.customerId"))||void 0===o||o.setValue("")),this.loadingPossibleCustomers=!1}),(0,d.U)(t=>t.possibleCustomers))}getMaterialControl(t,e){return this.materialsFormArray.at(t).get(e)}addMaterial(){var t,e;if(!this.materialsFormArray.controls.length){const i=new Date;this.vswsForm.patchValue({survey:{surveyedBy:null===(t=this.auth.getCurrentUser())||void 0===t?void 0:t._id,surveyedByName:null===(e=this.auth.getCurrentUser())||void 0===e?void 0:e.displayName,surveyedDate:i.toISOString().substring(0,10),surveyedTime:i.toTimeString().substring(0,5)}})}if(this.materialsFormArray.controls.length<5){const t=this.fb.group({pwId:["",Zt.kI.required],weightKG:[0,Zt.kI.min(.1)],count:[{value:0,disabled:!0}],price:0,notes:""});this.materialsFormArray.push(t),setTimeout(()=>{var t,e;null===(t=this.materialRows)||void 0===t||t.last.nativeElement.scrollIntoView(),null===(e=this.materialRows)||void 0===e||e.last.nativeElement.querySelector("mat-select").click()},0)}else this.alert.openDialog({title:"\u51fa\u9519\u4e86",message:"\u5355\u8f66\u6700\u591a5\u79cd\u7269\u8d44",okOnly:!0})}removeMaterial(t){this.materialsFormArray.removeAt(t),this.materialsFormArray.controls.length||this.vswsForm.patchValue({survey:{surveyedBy:"",surveyedByName:"",surveyedDate:"",surveyedTime:""}})}openCustomerDialog(t){this.customerDialog.openDialog(t).afterClosed().subscribe(t=>{var e,i,n;t&&t._id&&(null===(e=this.vswsForm.get("weighing.customerId"))||void 0===e||e.setValue(t._id),null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i||i.setValue(t.name),null===(n=this.vswsForm.get("weighing.customerTel"))||void 0===n||n.setValue(t.mobiel))})}preparePatches(){const t=this.vswsForm.getRawValue(),e=this.data.vsws;return t.weighing.inWeighedDate&&t.weighing.inWeighedTime&&(t.weighing.inWeighedAt=new Date(t.weighing.inWeighedDate+" "+t.weighing.inWeighedTime).toISOString()),t.weighing.outWeighedDate&&t.weighing.outWeighedTime&&(t.weighing.outWeighedAt=new Date(t.weighing.outWeighedDate+" "+t.weighing.outWeighedTime).toISOString()),t.survey.surveyedDate&&t.survey.surveyedTime&&(t.survey.surveyedAt=new Date(t.survey.surveyedDate+" "+t.survey.surveyedTime).toISOString()),{oldObject:e,newObject:t,vswsPatches:this.calculatePatches.calculatePatches({oldObject:e,newObject:t,objectTemplate:this.objectTemplate})}}onCancel(){const t=this.preparePatches().vswsPatches;console.log({patches:t}),t.length?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}onSubmit2(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();console.log({newObject:t,oldObject:e,vswsPatches:i})}onSubmit(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();if(console.log({newObject:t,oldObject:e,vswsPatches:i}),e._id)if(console.log(i),i.length){const t=this.dialog.open(l,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.update({_id:e._id,vswsPatches:i}).pipe((0,b.P)()).subscribe(e=>{console.log({vswsPatchResult:e}),t.close(),this.dialogRef.close(),this.data.changesSaved$$.next()})}else this.alert.openDialog({title:"\u65e0\u53d8\u52a8",message:"\u5185\u5bb9\u6ca1\u6709\u4efb\u4f55\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58",okOnly:!0});else{const e=this.dialog.open(l,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.insert(this.calculatePatches.trimObject(t,this.objectTemplate)).pipe((0,b.P)()).subscribe(t=>{console.log({res:t}),e.close(),this.data.changesSaved$$.next(),this.dialogRef.close()})}}objectKeys(t){console.log({obj:t})}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(r.WI),u.Y36(Zt.qu),u.Y36(nt),u.Y36(Qt),u.Y36(wt.e),u.Y36(Ft),u.Y36(it),u.Y36(r.uw),u.Y36(r.so))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-dialog"]],viewQuery:function(t,e){if(1&t&&u.Gf(Ht,5),2&t){let t;u.iGM(t=u.CRH())&&(e.materialRows=t)}},decls:156,vars:30,consts:[["mat-dialog-title",""],["mat-button","","color","accent",4,"ngIf"],["mat-button","","color","primary",4,"ngIf"],[3,"formGroup"],["formGroupName","weighing"],["matInput","","formControlName","truckPlateNo",3,"matAutocompleteDisabled","matAutocomplete"],["matPrefix",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","customerTel"],["mat-raised-button","","color","accent",3,"disabled","click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["matInput","","type","date","formControlName","inWeighedDate"],["matInput","","type","time","formControlName","inWeighedTime"],["matInput","","formControlName","inWeighedByName"],["matInput","","type","date","formControlName","outWeighedDate"],["matInput","","type","time","formControlName","outWeighedTime"],["matInput","","formControlName","outWeighedByName"],["matInput","","type","number","disabled","",3,"value"],["mat-button","","color","warn",4,"ngIf"],[1,"width-fifty"],["matInput","","formControlName","notes"],["mat-button",""],["mat-button","",4,"ngIf"],[1,"width-five-vm",2,"font-size","14px"],["matInput","","type","number",3,"formControl"],["matSuffix",""],["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],["formGroupName","survey"],["matInput","","formControlName","surveyedByName"],["matInput","","type","date","formControlName","surveyedDate"],["matInput","","type","time","formControlName","surveyedTime"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent"],["mat-button","","color","primary"],[3,"value"],["matInput","","formControlName","customerName",3,"matAutocompleteDisabled","matAutocomplete"],["autoCustomerName","matAutocomplete"],["matInput","","formControlName","customerName"],["mat-raised-button","","color","accent",3,"disabled","click"],["mat-button","","color","primary",3,"disabled","click"],["matInput","","type","number","formControlName","inWeightKG"],["matInput","","type","number","formControlName","outWeightKG"],["mat-button","","color","warn"],["formRows",""],[3,"formControl"],["select","matSelect"],[1,"width-fifteen-vm"],["class","width-ten-vm",4,"ngIf"],["matInput","",3,"formControl"],["mat-button","","color","accent",3,"click",4,"ngIf"],[1,"width-ten-vm"],["mat-button","","color","accent",3,"click"]],template:function(t,e){if(1&t&&(u.TgZ(0,"h2",0),u.YNc(1,Vt,2,1,"button",1),u.YNc(2,Xt,2,1,"button",2),u.qZA(),u.TgZ(3,"mat-dialog-content"),u.TgZ(4,"form",3),u.TgZ(5,"mat-card"),u.TgZ(6,"mat-card-header"),u.TgZ(7,"mat-card-title"),u.TgZ(8,"small"),u._uU(9,"\u8fc7\u78c5\u4fe1\u606f"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(10,"mat-card-content",4),u.TgZ(11,"span"),u._uU(12,"\xa0"),u.qZA(),u.TgZ(13,"mat-form-field"),u.TgZ(14,"mat-label"),u._uU(15," \u8d27\u8f66\u8f66\u724c\u53f7 "),u.qZA(),u._UZ(16,"input",5),u.TgZ(17,"mat-icon",6),u._uU(18,"local_shipping"),u.qZA(),u.TgZ(19,"mat-autocomplete",null,7),u.YNc(21,zt,2,2,"mat-option",8),u.qZA(),u.qZA(),u.TgZ(22,"span"),u._uU(23,"\xa0"),u.qZA(),u.TgZ(24,"mat-form-field"),u.TgZ(25,"mat-label"),u._uU(26," \u5ba2\u6237\u540d\u79f0 "),u.qZA(),u.YNc(27,ee,6,5,"ng-container",9),u.YNc(28,ie,2,0,"ng-container",9),u.qZA(),u.TgZ(29,"span"),u._uU(30,"\xa0"),u.qZA(),u.TgZ(31,"mat-form-field"),u.TgZ(32,"mat-label"),u._uU(33," \u5ba2\u6237\u7535\u8bdd "),u.qZA(),u._UZ(34,"input",10),u.qZA(),u.TgZ(35,"span"),u._uU(36,"\xa0"),u.qZA(),u.YNc(37,ne,2,1,"button",11),u.YNc(38,se,2,1,"button",12),u._UZ(39,"br"),u.YNc(40,oe,6,0,"mat-form-field",9),u.YNc(41,ae,6,0,"mat-form-field",9),u.TgZ(42,"span"),u._uU(43,"\xa0"),u.qZA(),u.TgZ(44,"mat-form-field"),u.TgZ(45,"mat-label"),u._uU(46,"\u8d27\u8f66\u8fdb\u573a\u65e5\u671f"),u.qZA(),u._UZ(47,"input",13),u.qZA(),u.TgZ(48,"span"),u._uU(49,"\xa0"),u.qZA(),u.TgZ(50,"mat-form-field"),u.TgZ(51,"mat-label"),u._uU(52,"\u8d27\u8f66\u8fdb\u573a\u65f6\u95f4"),u.qZA(),u._UZ(53,"input",14),u.qZA(),u.TgZ(54,"span"),u._uU(55,"\xa0"),u.qZA(),u.TgZ(56,"mat-form-field"),u.TgZ(57,"mat-label"),u._uU(58,"\u8fdb\u573a\u53f8\u78c5"),u.qZA(),u._UZ(59,"input",15),u.qZA(),u._UZ(60,"br"),u.YNc(61,re,6,0,"mat-form-field",9),u.YNc(62,ue,6,0,"mat-form-field",9),u.TgZ(63,"span"),u._uU(64,"\xa0"),u.qZA(),u.TgZ(65,"mat-form-field"),u.TgZ(66,"mat-label"),u._uU(67,"\u8d27\u8f66\u51fa\u573a\u65e5\u671f"),u.qZA(),u._UZ(68,"input",16),u.qZA(),u.TgZ(69,"span"),u._uU(70,"\xa0"),u.qZA(),u.TgZ(71,"mat-form-field"),u.TgZ(72,"mat-label"),u._uU(73,"\u8d27\u8f66\u51fa\u573a\u65f6\u95f4"),u.qZA(),u._UZ(74,"input",17),u.qZA(),u.TgZ(75,"span"),u._uU(76,"\xa0"),u.qZA(),u.TgZ(77,"mat-form-field"),u.TgZ(78,"mat-label"),u._uU(79,"\u51fa\u573a\u53f8\u78c5"),u.qZA(),u._UZ(80,"input",18),u.qZA(),u._UZ(81,"br"),u.TgZ(82,"mat-form-field"),u.TgZ(83,"mat-label"),u._uU(84,"\u51c0\u91cd\uff08\u516c\u65a4\uff09"),u.qZA(),u._UZ(85,"input",19),u.qZA(),u.TgZ(86,"span"),u._uU(87,"\xa0"),u.qZA(),u.YNc(88,le,2,1,"button",20),u.YNc(89,ce,2,0,"button",20),u._UZ(90,"br"),u.TgZ(91,"mat-form-field",21),u.TgZ(92,"mat-label"),u._uU(93," \u5907\u6ce8 "),u.qZA(),u._UZ(94,"textarea",22),u.qZA(),u.qZA(),u.qZA(),u._UZ(95,"br"),u.TgZ(96,"mat-card"),u.TgZ(97,"mat-card-header"),u.TgZ(98,"mat-card-title"),u.TgZ(99,"small"),u._uU(100,"\u7269\u8d44\u4fe1\u606f"),u.qZA(),u.TgZ(101,"span"),u._uU(102,"\xa0\xa0\xa0"),u.qZA(),u.TgZ(103,"small"),u.TgZ(104,"small"),u.TgZ(105,"button",23),u._uU(106),u.qZA(),u.YNc(107,de,3,4,"button",24),u.YNc(108,ge,3,4,"button",20),u.TgZ(109,"button",23),u._uU(110),u.ALo(111,"number"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(112,"span"),u._uU(113,"\xa0\xa0\xa0"),u.qZA(),u.TgZ(114,"mat-form-field",25),u.TgZ(115,"mat-label"),u._uU(116,"\u7a0e\u70b9"),u.qZA(),u._UZ(117,"input",26),u.TgZ(118,"span",27),u._uU(119,"%"),u.qZA(),u.qZA(),u.TgZ(120,"span"),u._uU(121,"\xa0\xa0\xa0"),u.qZA(),u.TgZ(122,"button",28),u.NdJ("click",function(){return e.addMaterial()}),u._uU(123,"\u6dfb\u52a0\u7269\u8d44"),u.qZA(),u.TgZ(124,"span"),u._uU(125,"\xa0\xa0\xa0"),u.qZA(),u.YNc(126,he,2,0,"button",24),u.YNc(127,me,2,0,"button",20),u.qZA(),u.qZA(),u.TgZ(128,"mat-card-content"),u.YNc(129,Ze,48,9,"div",29),u.TgZ(130,"div",30),u._UZ(131,"br"),u.TgZ(132,"mat-form-field"),u.TgZ(133,"mat-label"),u._uU(134,"\u9a8c\u8d28\u5458"),u.qZA(),u._UZ(135,"input",31),u.TgZ(136,"mat-icon",6),u._uU(137,"assignment_ind"),u.qZA(),u.qZA(),u.TgZ(138,"span"),u._uU(139,"\xa0"),u.qZA(),u.TgZ(140,"mat-form-field"),u.TgZ(141,"mat-label"),u._uU(142,"\u9a8c\u8d28\u65e5\u671f"),u.qZA(),u._UZ(143,"input",32),u.qZA(),u.TgZ(144,"span"),u._uU(145,"\xa0"),u.qZA(),u.TgZ(146,"mat-form-field"),u.TgZ(147,"mat-label"),u._uU(148,"\u9a8c\u8d28\u65f6\u95f4"),u.qZA(),u._UZ(149,"input",33),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u._UZ(150,"br"),u.qZA(),u.qZA(),u.TgZ(151,"mat-dialog-actions",34),u.TgZ(152,"button",35),u.NdJ("click",function(){return e.onCancel()}),u._uU(153,"\u53d6\u6d88"),u.qZA(),u.TgZ(154,"button",28),u.NdJ("click",function(){return e.onSubmit()}),u._uU(155,"\u4fdd\u5b58"),u.qZA(),u.qZA()),2&t){const t=u.MAs(20);let i;u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(2),u.Q6J("formGroup",e.vswsForm),u.xp6(12),u.Q6J("matAutocompleteDisabled",!(null==(i=e.vswsForm.get("truckPlateNo"))||!i.value))("matAutocomplete",t),u.xp6(5),u.Q6J("ngForOf",e.truckPlateNoOptions),u.xp6(6),u.Q6J("ngIf",!e.data.vsws.weighing.customerId),u.xp6(1),u.Q6J("ngIf",!!e.data.vsws.weighing.customerId),u.xp6(9),u.Q6J("ngIf",e.status.showNewCustomerButton),u.xp6(1),u.Q6J("ngIf",!e.status.showNewCustomerButton),u.xp6(2),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(20),u.Q6J("ngIf",!e.data.vsws.isOutbound),u.xp6(1),u.Q6J("ngIf",e.data.vsws.isOutbound),u.xp6(23),u.Q6J("value",e.status.netWeightKG),u.xp6(3),u.Q6J("ngIf",e.vswsForm.errors),u.xp6(1),u.Q6J("ngIf",e.totalMaterialWeightGreaterThanWeighingNetweight),u.xp6(17),u.hij("\u3010",e.materialsFormArray.controls.length,"\u9879\u3011"),u.xp6(1),u.Q6J("ngIf",e.status.materialTotalWeight<=e.status.netWeightKG),u.xp6(1),u.Q6J("ngIf",e.status.materialTotalWeight>e.status.netWeightKG),u.xp6(2),u.hij("\u3010",u.xi3(111,27,e.status.materialTotalCost,"1.2-2"),"\u5143\u3011"),u.xp6(7),u.Q6J("formControl",e.vswsForm.get("taxRatio")),u.xp6(5),u.Q6J("disabled",!e.status.netWeightKG),u.xp6(4),u.Q6J("ngIf",!e.status.netWeightKG),u.xp6(1),u.Q6J("ngIf",!1),u.xp6(2),u.Q6J("ngForOf",e.materialsFormArray.controls),u.xp6(25),u.Q6J("disabled",e.vswsForm.invalid)}},directives:[r.uh,qt.O5,r.xY,Zt._Y,Zt.JL,Zt.sg,Et.a8,Et.dk,Et.n5,Et.dn,Zt.x0,At.KE,At.hX,_t.Nt,Zt.Fj,Gt.ZL,Zt.JJ,Zt.u,yt.Hw,At.qo,Gt.XC,qt.sg,Tt.lW,Zt.wV,Zt.oH,At.R9,r.H8,Kt.ey,$t.gD],pipes:[qt.JJ,qt.Ov],styles:[".width-fifty[_ngcontent-%COMP%]{width:50%;min-width:50vw}@media only screen and (min-width:768px){.width-five-vm[_ngcontent-%COMP%]{max-width:4em}.width-ten-vm[_ngcontent-%COMP%]{max-width:10%}.width-fifteen-vm[_ngcontent-%COMP%]{max-width:15%}}"]}),t})(),be=(()=>{class t{constructor(t,e,i){this.dialog=t,this.backend=e,this.auth=i,this.changesSaved$$=new rt.xQ}openDialog(t,e,i=!1){console.log("opening vswsDialog with data:"),console.log({vsws:t});const n=t&&"printSurvey"===e?(()=>function(...t){const e=t[t.length-1];return"function"==typeof e&&t.pop(),(0,ut.n)(t,void 0).lift(new ht(e))}(...t.survey.materials.map(t=>t.pwId).map(t=>this.backend.dataPrices.getPrices3({pwId:t,spec:"."}).pipe((0,d.U)(t=>t[0])))))():(0,v.of)(null);return(0,c.D)({vsws:(t=>{if(t){const e=this.dialog.open(l,{disableClose:!0});return(0,c.D)({customer:t.weighing.customerId?this.backend.dataCustomers.search({_id:t.weighing.customerId}).pipe((0,d.U)(t=>t.length?t[0]:null)):(0,v.of)(null),inWeighedBy:t.weighing.inWeighedBy?this.backend.dataUsers.search({_id:t.weighing.inWeighedBy}).pipe((0,d.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),outWeighedBy:t.weighing.outWeighedBy?this.backend.dataUsers.search({_id:t.weighing.outWeighedBy}).pipe((0,d.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),surveyedBy:t.survey.surveyedBy?this.backend.dataUsers.search({_id:t.survey.surveyedBy}).pipe((0,d.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null)}).pipe((0,d.U)(i=>(i.customer&&(t.weighing.customerName=i.customer.name,t.weighing.customerTel=i.customer.mobile),i.inWeighedBy&&(t.weighing.inWeighedByName=i.inWeighedBy.displayName),i.outWeighedBy&&(t.weighing.outWeighedByName=i.outWeighedBy.displayName),i.surveyedBy&&(t.survey.surveyedByName=i.surveyedBy.displayName),e.close(),t)))}{const t=new g(i);return(0,v.of)(t)}})(t),pws:this.backend.dataPws.getPws(),prices:n}).pipe((0,b.P)(),(0,d.U)(t=>{let i;switch(e){case"printWeighing":i=this.dialog.open(St,{disableClose:!1,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",height:"100%",maxWidth:"100%"});break;case"printSurvey":i=this.dialog.open(Nt,{disableClose:!1,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",height:"100%",maxWidth:"100%"});break;default:i=this.dialog.open(we,{disableClose:!0,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",maxWidth:"100%"})}return i}))}}return t.\u0275fac=function(e){return new(e||t)(u.LFG(r.uw),u.LFG(nt),u.LFG(wt.e))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac}),t})();var Ae=i(9199);function _e(t,e){1&t&&(u.TgZ(0,"th",10),u._uU(1," \u8d27\u8f66\u8fdb\u573a\u65e5\u671f "),u.qZA())}function Te(t,e){if(1&t&&(u.TgZ(0,"td",11),u._uU(1),u.ALo(2,"date"),u.qZA()),2&t){const t=e.$implicit;u.xp6(1),u.hij(" ",u.xi3(2,1,null==t.weighing?null:t.weighing.inWeighedAt,"y-MM-dd HH:mm")," ")}}function ye(t,e){1&t&&(u.TgZ(0,"th",10),u._uU(1," \u8d27\u8f66\u8f66\u724c\u53f7 "),u.qZA())}function qe(t,e){if(1&t&&(u.TgZ(0,"td",11),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.xp6(1),u.hij(" ",t.weighing.truckPlateNo," ")}}function Ue(t,e){1&t&&(u.TgZ(0,"th",10),u._uU(1," \u51c0\u91cd "),u.qZA())}function Oe(t,e){if(1&t&&(u.TgZ(0,"td",11),u._uU(1),u.ALo(2,"number"),u.qZA()),2&t){const t=e.$implicit,i=u.oxw();u.xp6(1),u.hij(" ",u.lcZ(2,1,i.getNetWeight(t))," ")}}function Ce(t,e){1&t&&(u.TgZ(0,"th",10),u._uU(1,"\u64cd\u4f5c"),u.qZA())}function xe(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"td",11),u.TgZ(1,"button",12),u.NdJ("click",function(){const e=u.CHM(t).$implicit;return u.oxw().onEdit(e)}),u.TgZ(2,"mat-icon"),u._uU(3,"edit"),u.qZA(),u.qZA(),u.TgZ(4,"span"),u._uU(5,"\xa0"),u.qZA(),u.TgZ(6,"button",13),u.NdJ("click",function(){const e=u.CHM(t).$implicit;return u.oxw().onPrint(e)}),u.TgZ(7,"mat-icon"),u._uU(8,"print"),u.qZA(),u.qZA(),u.TgZ(9,"span"),u._uU(10,"\xa0"),u.qZA(),u.TgZ(11,"button",13),u.NdJ("click",function(){const e=u.CHM(t).$implicit;return u.oxw().onPrintB(e)}),u.TgZ(12,"mat-icon"),u._uU(13,"room_preferences"),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit,i=u.oxw();u.xp6(6),u.Q6J("disabled",i.getNetWeight(t)<=0),u.xp6(5),u.Q6J("disabled",!t.survey.surveyedAt)}}function Ne(t,e){1&t&&(u.TgZ(0,"th",10),u._uU(1," \u5df2\u9a8c\u8d28 "),u.qZA())}function Ie(t,e){if(1&t&&(u.TgZ(0,"td",11),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.xp6(1),u.hij(" ",t.survey.surveyedAt?"\u662f":"\u5426"," ")}}function Pe(t,e){1&t&&u._UZ(0,"tr",14)}function We(t,e){1&t&&u._UZ(0,"tr",15)}let ke=(()=>{class t{constructor(t,e){this.dialog=t,this.vswsDialog=e,this.vswsRecentList=[],this.isOutbound=!1,this.displayedColumns=[]}ngOnInit(){this.displayedColumns=this.isOutbound?["_id","truckPlateNo","netWeight","operations"]:["_id","truckPlateNo","netWeight","surveyDone","operations"]}onEdit(t){console.log("on edit"),this.vswsDialog.openDialog(t).pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}onPrint(t){console.log("on printWeighing"),this.vswsDialog.openDialog(t,"printWeighing").pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}getNetWeight(t){var e,i,n,s,o,a,r,u;return t.isOutbound?(null===(e=t.weighing)||void 0===e?void 0:e.inWeightKG)&&(null===(i=t.weighing)||void 0===i?void 0:i.outWeightKG)?(null===(n=t.weighing)||void 0===n?void 0:n.outWeightKG)-(null===(s=t.weighing)||void 0===s?void 0:s.inWeightKG):0:(null===(o=t.weighing)||void 0===o?void 0:o.inWeightKG)&&(null===(a=t.weighing)||void 0===a?void 0:a.outWeightKG)?(null===(r=t.weighing)||void 0===r?void 0:r.inWeightKG)-(null===(u=t.weighing)||void 0===u?void 0:u.outWeightKG):0}onPrintB(t){console.log("on printSurvey"),this.vswsDialog.openDialog(t,"printSurvey").pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(r.uw),u.Y36(be))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-recent"]],inputs:{vswsRecentList:"vswsRecentList",isOutbound:"isOutbound"},decls:18,vars:3,consts:[["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","_id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","truckPlateNo"],["matColumnDef","netWeight"],["matColumnDef","operations"],["matColumnDef","surveyDone"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(u.TgZ(0,"table",0),u.ynx(1,1),u.YNc(2,_e,2,0,"th",2),u.YNc(3,Te,3,4,"td",3),u.BQk(),u.ynx(4,4),u.YNc(5,ye,2,0,"th",2),u.YNc(6,qe,2,1,"td",3),u.BQk(),u.ynx(7,5),u.YNc(8,Ue,2,0,"th",2),u.YNc(9,Oe,3,3,"td",3),u.BQk(),u.ynx(10,6),u.YNc(11,Ce,2,0,"th",2),u.YNc(12,xe,14,2,"td",3),u.BQk(),u.ynx(13,7),u.YNc(14,Ne,2,0,"th",2),u.YNc(15,Ie,2,1,"td",3),u.BQk(),u.YNc(16,Pe,1,0,"tr",8),u.YNc(17,We,1,0,"tr",9),u.qZA()),2&t&&(u.Q6J("dataSource",e.vswsRecentList),u.xp6(16),u.Q6J("matHeaderRowDef",e.displayedColumns),u.xp6(1),u.Q6J("matRowDefColumns",e.displayedColumns))},directives:[Ae.BZ,Ae.w1,Ae.fO,Ae.Dz,Ae.as,Ae.nj,Ae.ge,Ae.ev,Tt.lW,yt.Hw,Ae.XQ,Ae.Gk],pipes:[qt.uU,qt.JJ],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}"]}),t})();var De=i(994);function Je(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",4),u.NdJ("click",function(){return u.CHM(t),u.oxw().onCreate()}),u._uU(1,"\u65b0\u5efa\u7269\u8d44\u8fdb\u573a"),u.qZA()}}function Re(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",5),u.NdJ("click",function(){return u.CHM(t),u.oxw().onCreate()}),u._uU(1,"\u65b0\u5efa\u7269\u8d44\u51fa\u573a"),u.qZA()}}function Se(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"mat-checkbox",6),u.NdJ("change",function(e){return u.CHM(t),u.oxw().filterSurveyDone$$.next(e.checked)}),u._uU(1,"\u4ec5\u663e\u793a\u3010\u672a\u9a8c\u8d28\u3011"),u.qZA()}}let je=(()=>{class t{constructor(t,e,i){this.backend=t,this.dialog=e,this.vswsDialog=i,this.isOutbound=!1,this.title="",this.filterSurveyDone$$=new ot.X(!1)}onCreate(){this.vswsDialog.openDialog(void 0,void 0,this.isOutbound).pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}ngOnInit(){this.title=this.isOutbound?"\u8fd1\u671f\u51fa\u573a\u7269\u8d44":"\u8fd1\u671f\u8fdb\u573a\u7269\u8d44",console.log({isOutbound:this.isOutbound});const t=this.dialog.open(l,{disableClose:!0,data:{message:"\u6b63\u5728\u8f7d\u5165\u8fd1\u671f\u5e9f\u94a2\u8fdb\u573a\u8bb0\u5f55..."}});this.vswsRecentList$=this.vswsDialog.changesSaved$$.pipe((0,at.O)(null),(0,Z.w)(()=>this.backend.dataVS.getRecent(this.isOutbound)),(0,Z.w)(e=>(e=e.sort((t,e)=>Date.parse(e.createdAt)-Date.parse(t.createdAt)),this.filterSurveyDone$$.pipe((0,d.U)(t=>t?e.filter(t=>0==!!t.survey.surveyedAt):e),(0,w.b)(()=>{t.close()})))))}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(nt),u.Y36(r.uw),u.Y36(be))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey"]],inputs:{isOutbound:"isOutbound"},decls:12,vars:7,consts:[["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[3,"change",4,"ngIf"],[3,"isOutbound","vswsRecentList"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[3,"change"]],template:function(t,e){1&t&&(u.TgZ(0,"mat-card"),u.TgZ(1,"mat-card-content"),u.YNc(2,Je,2,0,"button",0),u.YNc(3,Re,2,0,"button",1),u.TgZ(4,"span"),u._uU(5,"\xa0\xa0\xa0"),u.qZA(),u.YNc(6,Se,2,0,"mat-checkbox",2),u.TgZ(7,"div"),u.TgZ(8,"span"),u._uU(9,"\xa0"),u.qZA(),u.qZA(),u._UZ(10,"app-vehicle-steel-weighing-survey-recent",3),u.ALo(11,"async"),u.qZA(),u.qZA()),2&t&&(u.xp6(2),u.Q6J("ngIf",!e.isOutbound),u.xp6(1),u.Q6J("ngIf",e.isOutbound),u.xp6(3),u.Q6J("ngIf",!e.isOutbound),u.xp6(4),u.Q6J("isOutbound",e.isOutbound)("vswsRecentList",u.lcZ(11,5,e.vswsRecentList$)))},directives:[Et.a8,Et.dn,qt.O5,ke,Tt.lW,De.oG],pipes:[qt.Ov],styles:[""]}),t})();var Ee=i(3295);function Ye(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",7),u.NdJ("click",function(){return u.CHM(t),u.oxw().refresh()}),u.TgZ(1,"mat-icon"),u._uU(2,"refresh"),u.qZA(),u.qZA()}}const Me=[{path:"",component:(()=>{class t{constructor(t,e){this.dialog=t,this.backend=e}ngOnInit(){}refresh(){const t=this.dialog.open(l,{disableClose:!0,data:{message:"\u6b63\u5728\u66f4\u65b0\u7269\u6599\u540d\u79f0..."}});this.backend.dataPws.refreshPws().subscribe(()=>{t.close()})}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(r.uw),u.Y36(nt))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-vehicle-steel-home"]],decls:10,vars:2,consts:[["label","\u8f66\u8f86\u5e9f\u94a2"],["label","\u7269\u8d44\u8fdb\u573a"],[3,"isOutbound"],["label","\u7269\u8d44\u51fa\u573a"],["label","\u7269\u8d44\u8fdb\u51fa\u573a\u6c47\u603b"],["disabled","","label","refreshpws"],["mat-tab-label",""],["mat-button","","color","primary","matTooltip","\u66f4\u65b0\u7269\u6599\u540d\u79f0",3,"click"]],template:function(t,e){1&t&&(u.TgZ(0,"mat-tab-group"),u.TgZ(1,"mat-tab",0),u.TgZ(2,"mat-tab-group"),u.TgZ(3,"mat-tab",1),u._UZ(4,"app-vehicle-steel-weighing-survey",2),u.qZA(),u.TgZ(5,"mat-tab",3),u._UZ(6,"app-vehicle-steel-weighing-survey",2),u.qZA(),u._UZ(7,"mat-tab",4),u.qZA(),u.qZA(),u.TgZ(8,"mat-tab",5),u.YNc(9,Ye,3,0,"ng-template",6),u.qZA(),u.qZA()),2&t&&(u.xp6(4),u.Q6J("isOutbound",!1),u.xp6(2),u.Q6J("isOutbound",!0))},directives:[st.SP,st.uX,je,st.uD,Tt.lW,Ee.gM,yt.Hw],styles:[""]}),t})(),pathMatch:"full"}];let Be=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[a.Bz.forChild(Me)],a.Bz]}),t})();const Fe=[];let Le=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[a.Bz.forChild(Fe)],a.Bz]}),t})(),Qe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[Qt],imports:[[Le,o.m]]}),t})(),Ge=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[be,qt.JJ],imports:[[Be,o.m,Qe]]}),t})()}}]);