(self.webpackChunklyfront_vs=self.webpackChunklyfront_vs||[]).push([[481],{2481:(t,e,i)=>{"use strict";i.r(e),i.d(e,{VehicleSteelModule:()=>me});var s={};i.r(s),i.d(s,{JsonPatchError:()=>k,_areEquals:()=>Y,applyOperation:()=>R,applyPatch:()=>S,applyReducer:()=>B,deepClone:()=>E,getValueByPointer:()=>J,validate:()=>G,validator:()=>L});var o={};i.r(o),i.d(o,{compare:()=>z,generate:()=>V,observe:()=>H,unobserve:()=>$});var a=i(1827),n=i(3464),r=i(2935),l=i(5366);let u=(()=>{class t{constructor(t){this.data=t,this.message=this.data&&this.data.message?this.data.message:"\u6b63\u5728\u8f7d\u5165..."}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-loading"]],decls:2,vars:1,consts:[["mat-dialog-title",""]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA()),2&t&&(l.xp6(1),l.Oqu(e.message))},directives:[r.uh],styles:[""]}),t})();var c=i(3148),g=i(9996);class d{constructor(){this._id=null,this.createdAt=null,this.createdBy=null,this.modifiedAt=null,this.modifiedBy=null,this.isDeleted=!1,this.deletedAt=null,this.deletedBy=null,this.deletedNotes=null,this.weighing={truckPlateNo:"",customerId:"",notes:"",inWeightKG:0,inWeighedBy:"",inWeighedAt:new Date,outWeightKG:0,outWeighedBy:""},this.survey={surveyedBy:"",materials:[]},this.changeLogs=[]}}class h{constructor(t,e,i){this.http=t,this.setHeaders=e,this.appConfig=i,this.apiURL=this.appConfig.backendUrl+"/api/vehicle-steel"}getRecent(){const t=new Date;t.setDate(t.getDate()-6);const e=new Date(t.toISOString().substr(0,10));e.setHours(0);const i={createdAt:{$gte:new Date(e)}},s={createdAt:{$lt:new Date(e)},"survey.surveyedBy":""};return(0,c.D)({within7days:this.search(i),over7daysNotSurveyed:this.search(s)}).pipe((0,g.U)(t=>[...t.within7days,...t.over7daysNotSurveyed]))}insert(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}update(t){return console.log(t),this.http.patch(this.apiURL+"/one",t,{headers:this.setHeaders(!0)})}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}class m{constructor(t,e,i,s){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=s,this.apiURL=this.appConfig.backendUrl+"/api/customers"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}save(t){if(t.oldCustomer._id){const e=this.calculatePatches.calculatePatches({oldObject:t.oldCustomer,newObject:t.newCustomer,keysToIgnore:["_id","createdAt","createdBy","modifiedAt","modifiedBy"]});return console.log(e),this.patch(t.oldCustomer._id,e)}return this.create(t.newCustomer)}create(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}patch(t,e){return this.http.patch(this.apiURL,{_id:t,patches:e},{headers:this.setHeaders(!0)})}}class p{constructor(t,e,i,s){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=s,this.apiURL=this.appConfig.backendUrl+"/api/users"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}var f=i(8598),v=i(878),w=i(4689),Z=i(4019),b=i(3530);class A{constructor(t,e,i,s){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=s,this.apiURL=this.appConfig.backendUrl+"/api/pws-v2"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}getPws(){return(0,v.of)(localStorage.getItem("pws")).pipe((0,w.w)(t=>t?(0,v.of)(JSON.parse(t)):this.refreshPws()))}refreshPws(){return this.search({}).pipe((0,Z.b)(t=>{localStorage.setItem("pws",JSON.stringify(t))}),(0,b.P)())}}var y,T=i(2693),_=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),q=Object.prototype.hasOwnProperty;function U(t,e){return q.call(t,e)}function O(t){if(Array.isArray(t)){for(var e=new Array(t.length),i=0;i<e.length;i++)e[i]=""+i;return e}if(Object.keys)return Object.keys(t);for(var s in e=[],t)U(t,s)&&e.push(s);return e}function N(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function C(t){for(var e,i=0,s=t.length;i<s;){if(!((e=t.charCodeAt(i))>=48&&e<=57))return!1;i++}return!0}function x(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function I(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function W(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)if(W(t[e]))return!0}else if("object"==typeof t){var s=O(t),o=s.length;for(e=0;e<o;e++)if(W(t[s[e]]))return!0}return!1}function P(t,e){var i=[t];for(var s in e){var o="object"==typeof e[s]?JSON.stringify(e[s],null,2):e[s];void 0!==o&&i.push(s+": "+o)}return i.join("\n")}var D=function(t){function e(e,i,s,o,a){var n=this.constructor,r=t.call(this,P(e,{name:i,index:s,operation:o,tree:a}))||this;return r.name=i,r.index=s,r.operation=o,r.tree=a,Object.setPrototypeOf(r,n.prototype),r.message=P(e,{name:i,index:s,operation:o,tree:a}),r}return _(e,t),e}(Error),k=D,E=N,j={add:function(t,e,i){return t[e]=this.value,{newDocument:i}},remove:function(t,e,i){var s=t[e];return delete t[e],{newDocument:i,removed:s}},replace:function(t,e,i){var s=t[e];return t[e]=this.value,{newDocument:i,removed:s}},move:function(t,e,i){var s=J(i,this.path);s&&(s=N(s));var o=R(i,{op:"remove",path:this.from}).removed;return R(i,{op:"add",path:this.path,value:o}),{newDocument:i,removed:s}},copy:function(t,e,i){var s=J(i,this.from);return R(i,{op:"add",path:this.path,value:N(s)}),{newDocument:i}},test:function(t,e,i){return{newDocument:i,test:Y(t[e],this.value)}},_get:function(t,e,i){return this.value=t[e],{newDocument:i}}},F={add:function(t,e,i){return C(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:i,index:e}},remove:function(t,e,i){return{newDocument:i,removed:t.splice(e,1)[0]}},replace:function(t,e,i){var s=t[e];return t[e]=this.value,{newDocument:i,removed:s}},move:j.move,copy:j.copy,test:j.test,_get:j._get};function J(t,e){if(""==e)return t;var i={op:"_get",path:e};return R(t,i),i.value}function R(t,e,i,s,o,a){if(void 0===i&&(i=!1),void 0===s&&(s=!0),void 0===o&&(o=!0),void 0===a&&(a=0),i&&("function"==typeof i?i(e,0,t,e.path):L(e,0)),""===e.path){var n={newDocument:t};if("add"===e.op)return n.newDocument=e.value,n;if("replace"===e.op)return n.newDocument=e.value,n.removed=t,n;if("move"===e.op||"copy"===e.op)return n.newDocument=J(t,e.from),"move"===e.op&&(n.removed=t),n;if("test"===e.op){if(n.test=Y(t,e.value),!1===n.test)throw new k("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return n.newDocument=t,n}if("remove"===e.op)return n.removed=t,n.newDocument=null,n;if("_get"===e.op)return e.value=t,n;if(i)throw new k("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return n}s||(t=N(t));var r=(e.path||"").split("/"),l=t,u=1,c=r.length,g=void 0,d=void 0,h=void 0;for(h="function"==typeof i?i:L;;){if(d=r[u],o&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(i&&void 0===g&&(void 0===l[d]?g=r.slice(0,u).join("/"):u==c-1&&(g=e.path),void 0!==g&&h(e,0,t,g)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(i&&!C(d))throw new k("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);C(d)&&(d=~~d)}if(u>=c){if(i&&"add"===e.op&&d>l.length)throw new k("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);if(!1===(n=F[e.op].call(e,l,d,t)).test)throw new k("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return n}}else if(d&&-1!=d.indexOf("~")&&(d=I(d)),u>=c){if(!1===(n=j[e.op].call(e,l,d,t)).test)throw new k("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return n}l=l[d]}}function S(t,e,i,s,o){if(void 0===s&&(s=!0),void 0===o&&(o=!0),i&&!Array.isArray(e))throw new k("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(t=N(t));for(var a=new Array(e.length),n=0,r=e.length;n<r;n++)a[n]=R(t,e[n],i,!0,o,n),t=a[n].newDocument;return a.newDocument=t,a}function B(t,e,i){var s=R(t,e);if(!1===s.test)throw new k("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return s.newDocument}function L(t,e,i,s){if("object"!=typeof t||null===t||Array.isArray(t))throw new k("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,i);if(!j[t.op])throw new k("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,i);if("string"!=typeof t.path)throw new k("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,i);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new k('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,i);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new k("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new k("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&W(t.value))throw new k("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,i);if(i)if("add"==t.op){var o=t.path.split("/").length,a=s.split("/").length;if(o!==a+1&&o!==a)throw new k("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,i)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==s)throw new k("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,i)}else if("move"===t.op||"copy"===t.op){var n=G([{op:"_get",path:t.from,value:void 0}],i);if(n&&"OPERATION_PATH_UNRESOLVABLE"===n.name)throw new k("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,i)}}function G(t,e,i){try{if(!Array.isArray(t))throw new k("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)S(N(e),N(t),i||!0);else{i=i||L;for(var s=0;s<t.length;s++)i(t[s],s,e,void 0)}}catch(o){if(o instanceof k)return o;throw o}}function Y(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var i,s,o,a=Array.isArray(t),n=Array.isArray(e);if(a&&n){if((s=t.length)!=e.length)return!1;for(i=s;0!=i--;)if(!Y(t[i],e[i]))return!1;return!0}if(a!=n)return!1;var r=Object.keys(t);if((s=r.length)!==Object.keys(e).length)return!1;for(i=s;0!=i--;)if(!e.hasOwnProperty(r[i]))return!1;for(i=s;0!=i--;)if(!Y(t[o=r[i]],e[o]))return!1;return!0}return t!=t&&e!=e}var Q=new WeakMap,K=function(){return function(t){this.observers=new Map,this.obj=t}}(),M=function(){return function(t,e){this.callback=t,this.observer=e}}();function $(t,e){e.unobserve()}function H(t,e){var i,s=function(t){return Q.get(t)}(t);if(s){var o=function(t,e){return t.observers.get(e)}(s,e);i=o&&o.observer}else s=new K(t),Q.set(t,s);if(i)return i;if(i={},s.value=N(t),e){i.callback=e,i.next=null;var a=function(){V(i)},n=function(){clearTimeout(i.next),i.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",n),window.addEventListener("keyup",n),window.addEventListener("mousedown",n),window.addEventListener("keydown",n),window.addEventListener("change",n))}return i.patches=[],i.object=t,i.unobserve=function(){V(i),clearTimeout(i.next),function(t,e){t.observers.delete(e.callback)}(s,i),"undefined"!=typeof window&&(window.removeEventListener("mouseup",n),window.removeEventListener("keyup",n),window.removeEventListener("mousedown",n),window.removeEventListener("keydown",n),window.removeEventListener("change",n))},s.observers.set(e,new M(e,i)),i}function V(t,e){void 0===e&&(e=!1);var i=Q.get(t.object);X(i.value,t.object,t.patches,"",e),t.patches.length&&S(i.value,t.patches);var s=t.patches;return s.length>0&&(t.patches=[],t.callback&&t.callback(s)),s}function X(t,e,i,s,o){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var a=O(e),n=O(t),r=!1,l=n.length-1;l>=0;l--){var u=t[g=n[l]];if(!U(e,g)||void 0===e[g]&&void 0!==u&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(o&&i.push({op:"test",path:s+"/"+x(g),value:N(u)}),i.push({op:"remove",path:s+"/"+x(g)}),r=!0):(o&&i.push({op:"test",path:s,value:t}),i.push({op:"replace",path:s,value:e}));else{var c=e[g];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?X(u,c,i,s+"/"+x(g),o):u!==c&&(o&&i.push({op:"test",path:s+"/"+x(g),value:N(u)}),i.push({op:"replace",path:s+"/"+x(g),value:N(c)}))}}if(r||a.length!=n.length)for(l=0;l<a.length;l++){var g;U(t,g=a[l])||void 0===e[g]||i.push({op:"add",path:s+"/"+x(g),value:N(e[g])})}}}function z(t,e,i){void 0===i&&(i=!1);var s=[];return X(t,e,s,"",i),s}const tt=Object.assign({},s,o,{JsonPatchError:D,deepClone:N,escapePathComponent:x,unescapePathComponent:I});let et=(()=>{class t{constructor(){}trimObject(t,e){const i={},s=(t,e,i)=>(Object.keys(e).forEach(o=>{e[o]&&"object"!=typeof e[o]?i[o]=t[o]:e[o]&&"object"==typeof e[o]&&(i[o]={},i[o]=s(t[o],e[o],i[o]))}),i);return s(t,e,i),i}calculatePatches(t){let e;if(t.keysToIgnore){const i=(t,e)=>{const i={};return Object.keys(t).filter(t=>-1===e.indexOf(t)).forEach(e=>{i[e]=t[e]}),i};e=tt.compare(i(t.oldObject,t.keysToIgnore),i(t.newObject,t.keysToIgnore))}else{if(!t.objectTemplate)throw"bad option for calculate patches";e=tt.compare(this.trimObject(t.oldObject,t.objectTemplate),this.trimObject(t.newObject,t.objectTemplate))}return e.map(t=>("add"===t.op&&(t.op="replace"),t))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),it=(()=>{class t{constructor(t,e,i){this.http=t,this.appConfig=e,this.calculatePatches=i,this.cache={},this.dataVS=new h(this.http,this.setHeaders,this.appConfig),this.dataCustomers=new m(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataUsers=new p(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataPws=new A(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.cacheInit()}cacheInit(){(0,c.D)({pws:this.dataPws.getPws()}).pipe((0,b.P)()).subscribe(t=>{this.cache=t})}setHeaders(t=!1){let e;return e=t?{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(localStorage.getItem("currentUser")).token}`}:{"Content-Type":"application/json"},e}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(T.eN),l.LFG(f.q),l.LFG(et))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=i(7173),ot=i(8512),at=i(6238),nt=i(5959),rt=i(1041);let lt=(()=>{class t{constructor(){}compareObjects(t,e,i=[]){function s(t){return null!=t&&"object"==typeof t}let o={},a={};return i.length?i.forEach(i=>{o[i]=t[i],a[i]=e[i]}):(o=t,a=e),function t(e,i){const o=Object.keys(e),a=Object.keys(i);if(o.length!==a.length)return!1;for(const n of o){const o=e[n],a=i[n],r=s(o)&&s(a);if(r&&!t(o,a)||!r&&o!==a)return!1}return!0}(o,a)}toChineseNumber(t){if(!Number.isInteger(t)||t<0)throw Error("\u8bf7\u8f93\u5165\u81ea\u7136\u6570");const e=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"],i=["","\u5341","\u767e","\u5343","\u4e07","\u5341\u4e07","\u767e\u4e07","\u5343\u4e07","\u4ebf","\u5341\u4ebf","\u767e\u4ebf","\u5343\u4ebf"],s=String(t).split("");let o="",a=!1;for(let n=0;n<s.length;n++){const t=s[n];"0"===t||a?"0"===t?a=!0:"0"!==t&&a&&(o+="\u96f6"+e[parseInt(t)]+i[s.length-n-1],a=!1):(o+=e[parseInt(t)]+i[s.length-n-1],a=!1)}return t<100&&(o=o.replace("\u4e00\u5341","\u5341")),o}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ut=i(3070),ct=i(9550),gt=i(4369),dt=i(7307),ht=i(1116);const mt=function(t){return{padding:t}};let pt=(()=>{class t{constructor(t,e,i,s){this.fb=t,this.data=e,this.utils=i,this.dialogRef=s;const o=localStorage.getItem("paddingCache")?JSON.parse(localStorage.getItem("paddingCache")):{top:0,bottom:0,left:0,right:0};this.paddingForm=this.fb.group(o)}ngOnInit(){console.log(this.data)}ngOnDestroy(){this.paddingForm.dirty&&(console.log("changed"),localStorage.setItem("paddingCache",JSON.stringify(this.paddingForm.getRawValue())))}closeDialog(){this.dialogRef.close()}get padding(){const t=this.paddingForm.getRawValue();return`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(rt.qu),l.Y36(r.WI),l.Y36(lt),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-print"]],decls:78,vars:28,consts:[[1,"noprint",3,"formGroup"],[2,"width","5em"],["type","number","matInput","","formControlName","top"],["type","number","matInput","","formControlName","left"],["type","number","matInput","","formControlName","right"],["mat-button","",2,"float","right",3,"click"],[1,"t3",3,"ngStyle"],[1,"header"],[1,"meta","meta1"],[1,"meta","meta2"],[1,"meta","meta3"],[1,"item","title"],[1,"item","content"],[1,"item","lastcolumn","content"],[1,"item","lastrow","title","netweightat"],[1,"item","lastrow","content","netweightac"],[1,"item","lastrow","title","netweightbt"],[1,"item","lastrow","lastcolumn","content","netweightbc"]],template:function(t,e){1&t&&(l.TgZ(0,"form",0),l.TgZ(1,"mat-form-field",1),l.TgZ(2,"mat-label"),l._uU(3," \u4e0a\u90e8\u7f29\u8fdb "),l.qZA(),l._UZ(4,"input",2),l.qZA(),l.TgZ(5,"span"),l._uU(6,"\xa0"),l.qZA(),l.TgZ(7,"mat-form-field",1),l.TgZ(8,"mat-label"),l._uU(9," \u5de6\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(10,"input",3),l.qZA(),l.TgZ(11,"span"),l._uU(12,"\xa0"),l.qZA(),l.TgZ(13,"mat-form-field",1),l.TgZ(14,"mat-label"),l._uU(15," \u53f3\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(16,"input",4),l.qZA(),l.TgZ(17,"button",5),l.NdJ("click",function(){return e.closeDialog()}),l.TgZ(18,"mat-icon"),l._uU(19,"close"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(20,"div",6),l.TgZ(21,"div",7),l._uU(22,"\u8fbd\u5b81\u9686\u8fd0\u73af\u4fdd\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8 - \u8fc7\u78c5\u5355"),l.qZA(),l.TgZ(23,"div",8),l._uU(24),l.ALo(25,"date"),l.qZA(),l._UZ(26,"div",9),l.TgZ(27,"div",10),l._uU(28,"\u5355\u4f4d\uff1a\u516c\u65a4"),l.qZA(),l.TgZ(29,"div",11),l._uU(30,"\u8f66\u53f7"),l.qZA(),l.TgZ(31,"div",12),l._uU(32),l.qZA(),l.TgZ(33,"div",11),l._uU(34,"\u7269\u8d44"),l.qZA(),l.TgZ(35,"div",12),l._uU(36,"\u8f66\u8f86\u5e9f\u94a2"),l.qZA(),l.TgZ(37,"div",11),l._uU(38,"\u5ba2\u6237"),l.qZA(),l.TgZ(39,"div",13),l._uU(40),l.qZA(),l.TgZ(41,"div",11),l._uU(42,"\u6bdb\u91cd"),l.qZA(),l.TgZ(43,"div",12),l._uU(44),l.ALo(45,"number"),l.qZA(),l.TgZ(46,"div",11),l._uU(47,"\u53f8\u78c5\u5458"),l.qZA(),l.TgZ(48,"div",12),l._uU(49,"\u8d85\u7ea7\u6743\u9650"),l.qZA(),l.TgZ(50,"div",11),l._uU(51,"\u65e5\u671f"),l.qZA(),l.TgZ(52,"div",13),l._uU(53),l.ALo(54,"date"),l.qZA(),l.TgZ(55,"div",11),l._uU(56,"\u76ae\u91cd"),l.qZA(),l.TgZ(57,"div",12),l._uU(58),l.ALo(59,"number"),l.qZA(),l.TgZ(60,"div",11),l._uU(61,"\u53f8\u78c5\u5458"),l.qZA(),l.TgZ(62,"div",12),l._uU(63,"\u8d85\u7ea7\u6743\u9650"),l.qZA(),l.TgZ(64,"div",11),l._uU(65,"\u65e5\u671f"),l.qZA(),l.TgZ(66,"div",13),l._uU(67),l.ALo(68,"date"),l.qZA(),l.TgZ(69,"div",14),l._uU(70,"\u51c0\u91cd"),l.qZA(),l.TgZ(71,"div",15),l._uU(72),l.ALo(73,"number"),l.qZA(),l.TgZ(74,"div",16),l._uU(75,"\u51c0\u91cd\u5927\u5199"),l.qZA(),l.TgZ(76,"div",17),l._uU(77),l.qZA(),l.qZA()),2&t&&(l.Q6J("formGroup",e.paddingForm),l.xp6(20),l.Q6J("ngStyle",l.VKq(26,mt,e.padding)),l.xp6(4),l.hij("\u5e8f\u53f7\uff1a",l.xi3(25,11,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"yMMddHHmm"),""),l.xp6(8),l.Oqu(e.data.vsws.weighing.truckPlateNo),l.xp6(8),l.Oqu(e.data.vsws.weighing.customerName),l.xp6(4),l.Oqu(l.lcZ(45,14,e.data.vsws.weighing.inWeightKG)),l.xp6(9),l.Oqu(l.xi3(54,16,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"y-MM-dd HH:mm")),l.xp6(5),l.Oqu(l.lcZ(59,19,e.data.vsws.weighing.outWeightKG)),l.xp6(9),l.Oqu(l.xi3(68,21,null==e.data.vsws.weighing?null:e.data.vsws.weighing.outWeighedAt,"y-MM-dd HH:mm")),l.xp6(5),l.Oqu(l.lcZ(73,24,e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)),l.xp6(5),l.hij(" ",e.utils.toChineseNumber(e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)," "))},directives:[rt._Y,rt.JL,rt.sg,ut.KE,ut.hX,rt.wV,ct.Nt,rt.Fj,rt.JJ,rt.u,gt.lW,dt.Hw,ht.PC],pipes:[ht.uU,ht.JJ],styles:['.t3[_ngcontent-%COMP%]{display:grid;grid-template-areas:"h1 h1 h1 h1 h1 h1" "m1 m1 m2 m2 m2 m3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "nwat nwac nwbt nwbc nwbc nwbc";grid-template-columns:1.5fr 3.5fr 2fr 3.5fr 2fr 7.5fr}.header[_ngcontent-%COMP%]{grid-area:h1}.title[_ngcontent-%COMP%]{font-style:italic}.content[_ngcontent-%COMP%]{font-size:1.1em}.meta1[_ngcontent-%COMP%]{grid-area:m1}.meta2[_ngcontent-%COMP%]{grid-area:m2}.meta3[_ngcontent-%COMP%]{grid-area:m3}.netweightbc[_ngcontent-%COMP%]{grid-area:nwbc}.item[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;text-align:center}.lastrow[_ngcontent-%COMP%]{border-bottom:1px solid #000}.lastcolumn[_ngcontent-%COMP%]{border-right:1px solid #000}.header[_ngcontent-%COMP%]{font-size:1.5em;text-align:center}.header[_ngcontent-%COMP%], .meta[_ngcontent-%COMP%]{margin-bottom:.3em}.meta3[_ngcontent-%COMP%]{text-align:right}']}),t})();var ft=i(7727),vt=i(2797);function wt(t,e){1&t&&(l.ynx(0),l.TgZ(1,"button",3),l._uU(2,"\u662f"),l.qZA(),l.TgZ(3,"button",4),l._uU(4," \u5426 "),l.qZA(),l.BQk()),2&t&&(l.xp6(1),l.Q6J("mat-dialog-close",!0),l.xp6(2),l.Q6J("mat-dialog-close",!1))}function Zt(t,e){1&t&&(l.ynx(0),l.TgZ(1,"button",3),l._uU(2,"\u786e\u5b9a"),l.qZA(),l.BQk()),2&t&&(l.xp6(1),l.Q6J("mat-dialog-close",!0))}let bt=(()=>{class t{constructor(t,e){this.data=t,this.dialogRef=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-alert"]],decls:9,vars:4,consts:[["mat-dialog-title",""],["align","end"],[4,"ngIf"],["mat-button","","color","primary",3,"mat-dialog-close"],["mat-raised-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"mat-dialog-content"),l.TgZ(3,"mat-card"),l.TgZ(4,"mat-card-content"),l._uU(5),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"mat-dialog-actions",1),l.YNc(7,wt,5,2,"ng-container",2),l.YNc(8,Zt,3,1,"ng-container",2),l.qZA()),2&t&&(l.xp6(1),l.Oqu(e.data.alert.title),l.xp6(4),l.hij(" ",e.data.alert.message," "),l.xp6(2),l.Q6J("ngIf",!e.data.alert.okOnly),l.xp6(1),l.Q6J("ngIf",e.data.alert.okOnly))},directives:[r.uh,r.xY,vt.a8,vt.dn,r.H8,ht.O5,gt.lW,r.ZT],styles:[""]}),t})(),At=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return this.dialog.open(bt,{disableClose:!0,data:{alert:t}})}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),yt=(()=>{class t{constructor(t,e,i,s,o,a){this.fb=t,this.data=e,this.dialogRef=i,this.utils=s,this.backend=o,this.alert=a,this.status$=(0,v.of)(),this.status={changed:!1},this.dialogTitle=this.data.customer._id?"\u7f16\u8f91\u5ba2\u6237":"\u65b0\u5efa\u5ba2\u6237",this.formX=this.fb.group({_id:[this.data.customer._id],name:[{value:this.data.customer.name,disabled:!!this.data.customer._id},rt.kI.required],mobile:[this.data.customer.mobile,[rt.kI.required,rt.kI.pattern(/^[0-9]*$/)]],notes:[this.data.customer.notes]})}ngOnInit(){this.status$=this.formX.valueChanges.pipe((0,Z.b)(t=>{this.status.changed=!this.utils.compareObjects(this.formX.getRawValue(),this.data.customer,["name","mobile","notes"]),console.log("status",this.status)}))}onSubmit(){console.log("at onSubmit");const t=this.formX.getRawValue(),e=this.data.customer;this.backend.dataCustomers.save({newCustomer:t,oldCustomer:e}).pipe((0,b.P)(),(0,ft.K)(t=>(0,v.of)(t))).subscribe(i=>{console.log(i),i.collection_upsert||i._id?this.dialogRef.close(e._id?t:i):(console.log("got error"),console.log(i))})}onCancel(){console.log("at onCancel"),this.status.changed?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(rt.qu),l.Y36(r.WI),l.Y36(r.so),l.Y36(lt),l.Y36(it),l.Y36(At))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-customer-dialog"]],decls:31,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],["matInput","","formControlName","name"],["matInput","","formControlName","mobile"],["matInput","","formControlName","notes"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],["type","text",2,"display","none",3,"value"]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"form",1),l.TgZ(3,"mat-dialog-content"),l.TgZ(4,"mat-card"),l.TgZ(5,"mat-card-content"),l.TgZ(6,"mat-form-field"),l.TgZ(7,"mat-label"),l._uU(8," \u5ba2\u6237\u540d\u79f0 "),l.qZA(),l._UZ(9,"input",2),l.qZA(),l.TgZ(10,"span"),l._uU(11,"\xa0"),l.qZA(),l.TgZ(12,"mat-form-field"),l.TgZ(13,"mat-label"),l._uU(14," \u5ba2\u6237\u624b\u673a "),l.qZA(),l._UZ(15,"input",3),l.qZA(),l._UZ(16,"br"),l.TgZ(17,"mat-form-field"),l.TgZ(18,"mat-label"),l._uU(19," \u5907\u6ce8 "),l.qZA(),l._UZ(20,"textarea",4),l.qZA(),l.TgZ(21,"span"),l._uU(22,"\xa0"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(23,"mat-dialog-actions",5),l.TgZ(24,"button",6),l.NdJ("click",function(){return e.onCancel()}),l._uU(25,"\u53d6\u6d88"),l.qZA(),l.TgZ(26,"button",7),l.NdJ("click",function(){return e.onSubmit()}),l._uU(27," \u4fdd\u5b58 "),l.qZA(),l.qZA(),l.qZA(),l._UZ(28,"input",8),l.ALo(29,"json"),l.ALo(30,"async")),2&t&&(l.xp6(1),l.Oqu(e.dialogTitle),l.xp6(1),l.Q6J("formGroup",e.formX),l.xp6(24),l.Q6J("disabled",e.formX.invalid||!e.status.changed),l.xp6(2),l.Q6J("value",l.lcZ(29,4,l.lcZ(30,6,e.status$))))},directives:[r.uh,rt._Y,rt.JL,rt.sg,r.xY,vt.a8,vt.dn,ut.KE,ut.hX,ct.Nt,rt.Fj,rt.JJ,rt.u,r.H8,gt.lW],pipes:[ht.Ts,ht.Ov],styles:[""]}),t})(),Tt=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return console.log("opening cutomerDialog with data:"),console.log(t),this.dialog.open(yt,{disableClose:!0,data:{customer:t}})}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac}),t})();var _t=i(104),qt=i(9961),Ut=i(7064),Ot=i(3841);const Nt=["formRows"];function Ct(t,e){if(1&t&&(l.TgZ(0,"mat-option",36),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(1),l.hij(" ",t," ")}}function xt(t,e){if(1&t&&(l.TgZ(0,"mat-option",36),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t.name),l.xp6(1),l.hij(" ",t.name," ")}}function It(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",37),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.openCustomerDialog(e.customer)}),l._uU(1,"\u65b0\u5efa\u5ba2\u6237"),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",t.loadingPossibleCustomers)}}function Wt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",26),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.openCustomerDialog(e.customer)}),l._uU(1,"\u7f16\u8f91\u5ba2\u6237"),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",t.disableEditCustomerButton)}}function Pt(t,e){if(1&t&&(l.TgZ(0,"button",38),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij(" ",null!=t.vswsForm.errors&&t.vswsForm.errors.weightError?"\u76ae\u91cd\u4e0d\u80fd\u5927\u4e8e\u6bdb\u91cd":""," ")}}function Dt(t,e){if(1&t&&(l.TgZ(0,"button",38),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij(" ",null!=t.vswsForm.errors&&t.vswsForm.errors.weightError2?"\u7269\u8d44\u603b\u91cd\u4e0d\u80fd\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd":""," ")}}function kt(t,e){if(1&t&&(l.TgZ(0,"button",24),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij("\u3010",t.status.materialTotalWeight,"\u516c\u65a4\u3011")}}function Et(t,e){if(1&t&&(l.TgZ(0,"button",38),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij("\u3010",t.status.materialTotalWeight,"\u516c\u65a4\u3011")}}function jt(t,e){1&t&&(l.TgZ(0,"button",24),l._uU(1," \u6dfb\u52a0\u7269\u8d44\u524d\uff0c\u8bf7\u5f55\u5165\u6709\u6548\u8fc7\u78c5\u6570\u636e "),l.qZA())}function Ft(t,e){1&t&&(l.TgZ(0,"button",38),l._uU(1," \u7269\u8d44\u603b\u91cd\u4e0d\u80fd\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd "),l.qZA())}function Jt(t,e){if(1&t&&(l.TgZ(0,"mat-option",36),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t._id),l.xp6(1),l.hij(" ",t.name," ")}}function Rt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",45),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().index;return l.oxw().removeMaterial(e)}),l._uU(1,"\u5220\u9664"),l.qZA()}}function St(t,e){if(1&t&&(l.TgZ(0,"div",null,39),l.TgZ(2,"mat-card"),l.TgZ(3,"mat-card-content"),l.TgZ(4,"mat-form-field"),l.TgZ(5,"mat-label"),l._uU(6,"\u7269\u8d44\u540d\u79f0"),l.qZA(),l.TgZ(7,"mat-select",40),l.YNc(8,Jt,2,2,"mat-option",6),l.qZA(),l.TgZ(9,"span",4),l._uU(10),l.qZA(),l.qZA(),l.TgZ(11,"span"),l._uU(12,"\xa0"),l.qZA(),l.TgZ(13,"mat-form-field",41),l.TgZ(14,"mat-label"),l._uU(15,"\u91cd\u91cf\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(16,"input",42),l.qZA(),l.TgZ(17,"span"),l._uU(18,"\xa0"),l.qZA(),l.TgZ(19,"mat-form-field",41),l.TgZ(20,"mat-label"),l._uU(21,"\u6570\u91cf"),l.qZA(),l._UZ(22,"input",42),l.qZA(),l.TgZ(23,"span"),l._uU(24,"\xa0"),l.qZA(),l.TgZ(25,"mat-form-field",41),l.TgZ(26,"mat-label"),l._uU(27,"\u91d1\u989d\uff08\u5143\uff09"),l.qZA(),l._UZ(28,"input",42),l.qZA(),l._UZ(29,"br"),l.TgZ(30,"mat-form-field",22),l.TgZ(31,"mat-label"),l._uU(32," \u5907\u6ce8 "),l.qZA(),l._UZ(33,"textarea",43),l.qZA(),l.TgZ(34,"span"),l._uU(35,"\xa0"),l.qZA(),l.YNc(36,Rt,2,0,"button",44),l.qZA(),l.qZA(),l._UZ(37,"br"),l.qZA()),2&t){const t=e.$implicit,i=e.index,s=l.oxw();let o;l.xp6(7),l.Q6J("formControl",t.get("pwId")),l.xp6(1),l.Q6J("ngForOf",s.selectedPws),l.xp6(2),l.hij("",i+1,"\xa0\xa0"),l.xp6(6),l.Q6J("formControl",t.get("weightKG")),l.xp6(6),l.Q6J("formControl",t.get("count")),l.xp6(6),l.Q6J("formControl",t.get("cost")),l.xp6(5),l.Q6J("formControl",t.get("notes")),l.xp6(3),l.Q6J("ngIf",!(null!=(o=t.get("inventoryId"))&&o.value))}}let Bt=(()=>{class t{constructor(t,e,i,s,o,a,n,r,l){var u;this.data=t,this.fb=e,this.backend=i,this.customerDialog=s,this.auth=o,this.alert=a,this.calculatePatches=n,this.dialog=r,this.dialogRef=l,this.truckPlateNoOptions=["\u8fbdN"],this.subscriptions_=[],this.possibleCustomers$=(0,v.of)([]),this.loadingPossibleCustomers=!1,this.disableEditCustomerButton=!0,this.customer={name:""},this.selectedPws=[],this.status={showNewCustomerButton:!1,observables:{valueChanges:(0,v.of)(null)},netWeightKG:0,materialTotalWeight:0,materialTotalCost:0,lastValue:{outWeightKG:0}},this.objectTemplate={_id:!0,isDeleted:!0,deletedAt:!0,weighing:{truckPlateNo:!0,customerId:!0,inWeightKG:!0,inWeighedAt:!0,inWeighedBy:!0,outWeightKG:!0,outWeighedAt:!0,outWeighedBy:!0,notes:!0},survey:{surveyedBy:!0,surveyedAt:!0,materials:!0}};const c=this.auth.getCurrentUser();this.selectedPws=this.data.pws.filter(t=>t.name.indexOf("\u5e9f\u94a2")>-1&&t.name.indexOf("\u516c\u65a4")>-1),console.log(this.selectedPws),console.log(this.data.vsws),this.status.lastValue.outWeightKG=this.data.vsws.weighing.outWeightKG,this.status.netWeightKG=this.data.vsws.weighing.outWeightKG&&this.data.vsws.weighing.inWeightKG?this.data.vsws.weighing.outWeightKG-this.data.vsws.weighing.inWeightKG:0,this.data.vsws.survey.materials&&this.data.vsws.survey.materials.length?(console.log(this.data.vsws.survey.materials),this.materialsFormArray=this.fb.array(null===(u=this.data.vsws.survey.materials)||void 0===u?void 0:u.map(t=>this.fb.group({pwId:[{value:t.pwId,disabled:!0}],weightKG:t.weightKG,count:t.count,cost:t.cost,notes:t.notes,inventoryId:t.inventoryId})))):this.materialsFormArray=this.fb.array([]),this.vswsForm=this.fb.group({_id:this.data.vsws._id,isDeleted:this.data.vsws.isDeleted,deletedAt:this.data.vsws.deletedAt,deletedBy:this.data.vsws.deletedBy,deletedNotes:this.data.vsws.deletedNotes,weighing:this.fb.group({truckPlateNo:[{value:this.data.vsws.weighing.truckPlateNo,disabled:!!this.data.vsws.weighing.truckPlateNo},[rt.kI.required,rt.kI.minLength(7)]],customerId:this.data.vsws.weighing.customerId,customerName:[{value:this.data.vsws.weighing.customerName,disabled:!!this.data.vsws.weighing.customerName}],customerTel:[{value:this.data.vsws.weighing.customerTel,disabled:!0}],inWeightKG:[{value:this.data.vsws.weighing.inWeightKG,disabled:!1}],inWeighedDate:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toLocaleDateString().split("/").map(t=>t.padStart(2,"0")).join("-"):"",inWeighedTime:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toTimeString().substring(0,5):"",inWeighedBy:this.data.vsws.weighing.inWeighedBy?this.data.vsws.weighing.inWeighedBy:null==c?void 0:c._id,inWeighedByName:[{value:this.data.vsws.weighing.inWeighedByName?this.data.vsws.weighing.inWeighedByName:null==c?void 0:c.displayName,disabled:!0}],outWeightKG:[{value:this.data.vsws.weighing.outWeightKG,disabled:!1}],outWeighedDate:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toISOString().substring(0,10):"",outWeighedTime:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toTimeString().substring(0,5):"",outWeighedBy:this.data.vsws.weighing.outWeighedBy,outWeighedByName:[{value:this.data.vsws.weighing.outWeighedByName,disabled:!0}],notes:this.data.vsws.weighing.notes}),survey:this.fb.group({surveyedBy:this.data.vsws.survey.surveyedBy,surveyedByName:[{value:this.data.vsws.survey.surveyedByName,disabled:!0}],surveyedDate:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toISOString().substring(0,10):"",disabled:!!this.data.vsws.survey.surveyedAt}],surveyedTime:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toTimeString().substring(0,5):"",disabled:!!this.data.vsws.survey.surveyedAt}],materials:this.materialsFormArray})}),this.dialogTitle=this.data.vsws._id?"\u7f16\u8f91\u8fdb\u573a\u7269\u8d44":"\u65b0\u5efa\u8fdb\u573a\u7269\u8d44"}ngOnInit(){var t,e;this.status.observables.valueChanges=this.vswsForm.valueChanges.pipe((0,at.O)(this.vswsForm.getRawValue()),(0,Z.b)(t=>{setTimeout(()=>{var e,i;const s=t.weighing.inWeightKG,o=t.weighing.outWeightKG;if(!this.status.lastValue.outWeightKG&&o){const t=new Date;this.vswsForm.patchValue({weighing:{outWeighedDate:t.toISOString().substring(0,10),outWeighedTime:t.toTimeString().substring(0,5),outWeighedBy:null===(e=this.auth.getCurrentUser())||void 0===e?void 0:e._id,outWeighedByName:null===(i=this.auth.getCurrentUser())||void 0===i?void 0:i.displayName}},{emitEvent:!1}),this.status.lastValue.outWeightKG=o}this.status.netWeightKG=s&&o?s-o:0,this.status.netWeightKG<0&&this.vswsForm.setErrors({weightError:!0});const a=t.survey.materials;this.status.materialTotalCost=a.reduce((t,e)=>t+1*e.cost,0),this.status.materialTotalWeight=a.reduce((t,e)=>t+1*e.weightKG,0),a.forEach((t,e)=>{var i,s;const o=this.selectedPws.find(e=>e._id===t.pwId);o&&o.name.indexOf("\u53d1\u52a8\u673a")>-1?null===(i=this.materialsFormArray.controls[e].get("count"))||void 0===i||i.enable({emitEvent:!1}):null===(s=this.materialsFormArray.controls[e].get("count"))||void 0===s||s.disable({emitEvent:!1})}),this.status.materialTotalWeight>this.status.netWeightKG&&this.vswsForm.setErrors(Object.assign({},this.vswsForm.errors,{weightError2:"material total weight cannot be greater than netWeightKG"}))},0)})),this.possibleCustomers$=null===(t=this.vswsForm.get("weighing.customerName"))||void 0===t?void 0:t.valueChanges.pipe((0,at.O)(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.value),(0,w.w)(t=>(this.loadingPossibleCustomers=!0,t?this.backend.dataCustomers.search({name:{$regex:`.*${t}.*`}}).pipe((0,g.U)(e=>({customerNameX:t,possibleCustomers:e}))):(0,v.of)([]).pipe((0,g.U)(e=>({customerNameX:t,possibleCustomers:e}))))),(0,Z.b)(t=>{var e,i,s,o,a;console.log(t);const n=t.possibleCustomers.find(e=>e.name===t.customerNameX);this.status.showNewCustomerButton=!(!(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.dirty)||t.customerNameX&&(!t.customerNameX||n)),this.disableEditCustomerButton=!t.customerNameX,n?(this.customer=n,this.vswsForm.patchValue({weighing:{customerTel:null==n?void 0:n.mobile,customerId:null==n?void 0:n._id}})):(null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i?void 0:i.value)&&(null===(s=this.vswsForm.get("weighing.customerName"))||void 0===s||s.setErrors({notFound:!0}),this.customer={name:t.customerNameX,mobile:""},null===(o=this.vswsForm.get("weighing.customerTel"))||void 0===o||o.setValue(""),null===(a=this.vswsForm.get("weighing.customerId"))||void 0===a||a.setValue("")),this.loadingPossibleCustomers=!1}),(0,g.U)(t=>t.possibleCustomers))}getMaterialControl(t,e){return this.materialsFormArray.at(t).get(e)}addMaterial(){var t,e;if(!this.materialsFormArray.controls.length){const i=new Date;this.vswsForm.patchValue({survey:{surveyedBy:null===(t=this.auth.getCurrentUser())||void 0===t?void 0:t._id,surveyedByName:null===(e=this.auth.getCurrentUser())||void 0===e?void 0:e.displayName,surveyedDate:i.toISOString().substring(0,10),surveyedTime:i.toTimeString().substring(0,5)}})}if(this.materialsFormArray.controls.length<5){const t=this.fb.group({pwId:["",rt.kI.required],weightKG:[0,rt.kI.min(.1)],count:[{value:0,disabled:!0}],cost:0,notes:""});this.materialsFormArray.push(t),setTimeout(()=>{var t,e;null===(t=this.materialRows)||void 0===t||t.last.nativeElement.scrollIntoView(),null===(e=this.materialRows)||void 0===e||e.last.nativeElement.querySelector("mat-select").click()},0)}else this.alert.openDialog({title:"\u51fa\u9519\u4e86",message:"\u5355\u8f66\u6700\u591a5\u79cd\u7269\u8d44",okOnly:!0})}removeMaterial(t){this.materialsFormArray.removeAt(t),this.materialsFormArray.controls.length||this.vswsForm.patchValue({survey:{surveyedBy:"",surveyedByName:"",surveyedDate:"",surveyedTime:""}})}openCustomerDialog(t){this.customerDialog.openDialog(t).afterClosed().subscribe(t=>{var e,i,s;t&&t._id&&(null===(e=this.vswsForm.get("weighing.customerId"))||void 0===e||e.setValue(t._id),null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i||i.setValue(t.name),null===(s=this.vswsForm.get("weighing.customerTel"))||void 0===s||s.setValue(t.mobiel))})}preparePatches(){const t=this.vswsForm.getRawValue(),e=this.data.vsws;return t.weighing.inWeighedDate&&t.weighing.inWeighedTime&&(t.weighing.inWeighedAt=new Date(t.weighing.inWeighedDate+" "+t.weighing.inWeighedTime).toISOString()),t.weighing.outWeighedDate&&t.weighing.outWeighedTime&&(t.weighing.outWeighedAt=new Date(t.weighing.outWeighedDate+" "+t.weighing.outWeighedTime).toISOString()),t.survey.surveyedDate&&t.survey.surveyedTime&&(t.survey.surveyedAt=new Date(t.survey.surveyedDate+" "+t.survey.surveyedTime).toISOString()),{oldObject:e,newObject:t,vswsPatches:this.calculatePatches.calculatePatches({oldObject:e,newObject:t,objectTemplate:this.objectTemplate})}}onCancel(){const t=this.preparePatches().vswsPatches;console.log({patches:t}),t.length?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}onSubmit2(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();console.log({newObject:t,oldObject:e,vswsPatches:i})}onSubmit(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();if(console.log({newObject:t,oldObject:e,vswsPatches:i}),e._id)if(console.log(i),i.length){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.update({_id:e._id,vswsPatches:i}).pipe((0,b.P)()).subscribe(e=>{console.log({vswsPatchResult:e}),t.close(),this.dialogRef.close(),this.data.changesSaved$$.next()})}else this.alert.openDialog({title:"\u65e0\u53d8\u52a8",message:"\u5185\u5bb9\u6ca1\u6709\u4efb\u4f55\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58",okOnly:!0});else{const e=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.insert(this.calculatePatches.trimObject(t,this.objectTemplate)).pipe((0,b.P)()).subscribe(t=>{console.log({res:t}),e.close(),this.data.changesSaved$$.next(),this.dialogRef.close()})}}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI),l.Y36(rt.qu),l.Y36(it),l.Y36(Tt),l.Y36(_t.e),l.Y36(At),l.Y36(et),l.Y36(r.uw),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-dialog"]],viewQuery:function(t,e){if(1&t&&l.Gf(Nt,5),2&t){let t;l.iGM(t=l.CRH())&&(e.materialRows=t)}},decls:159,vars:27,consts:[["mat-dialog-title",""],[3,"formGroup"],["formGroupName","weighing"],["matInput","","formControlName","truckPlateNo",3,"matAutocompleteDisabled","matAutocomplete"],["matPrefix",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","customerName",3,"matAutocompleteDisabled","matAutocomplete"],["autoCustomerName","matAutocomplete"],["matInput","","formControlName","customerTel"],["mat-raised-button","","color","accent",3,"disabled","click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["matInput","","type","number","formControlName","inWeightKG"],["matInput","","type","date","formControlName","inWeighedDate"],["matInput","","type","time","formControlName","inWeighedTime"],["matInput","","formControlName","inWeighedByName"],["matInput","","type","number","formControlName","outWeightKG"],["matInput","","type","date","formControlName","outWeighedDate"],["matInput","","type","time","formControlName","outWeighedTime"],["matInput","","formControlName","outWeighedByName"],["matInput","","type","number","disabled","",3,"value"],["mat-button","","color","warn",4,"ngIf"],[1,"width-fifty"],["matInput","","formControlName","notes"],["mat-button",""],["mat-button","",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],["formGroupName","survey"],["matInput","","formControlName","surveyedByName"],["matInput","","type","date","formControlName","surveyedDate"],["matInput","","type","time","formControlName","surveyedTime"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[2,"display","none",3,"value"],[3,"value"],["mat-raised-button","","color","accent",3,"disabled","click"],["mat-button","","color","warn"],["formRows",""],[3,"formControl"],[1,"width-ten-vm"],["matInput","","type","number",3,"formControl"],["matInput","",3,"formControl"],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"]],template:function(t,e){if(1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"mat-dialog-content"),l.TgZ(3,"form",1),l.TgZ(4,"mat-card"),l.TgZ(5,"mat-card-header"),l.TgZ(6,"mat-card-title"),l.TgZ(7,"small"),l._uU(8,"\u8fc7\u78c5\u4fe1\u606f"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"mat-card-content",2),l.TgZ(10,"span"),l._uU(11,"\xa0"),l.qZA(),l.TgZ(12,"mat-form-field"),l.TgZ(13,"mat-label"),l._uU(14," \u8d27\u8f66\u8f66\u724c\u53f7 "),l.qZA(),l._UZ(15,"input",3),l.TgZ(16,"mat-icon",4),l._uU(17,"local_shipping"),l.qZA(),l.TgZ(18,"mat-autocomplete",null,5),l.YNc(20,Ct,2,2,"mat-option",6),l.qZA(),l.qZA(),l.TgZ(21,"span"),l._uU(22,"\xa0"),l.qZA(),l.TgZ(23,"mat-form-field"),l.TgZ(24,"mat-label"),l._uU(25," \u5ba2\u6237\u540d\u79f0 "),l.qZA(),l._UZ(26,"input",7),l.TgZ(27,"mat-autocomplete",null,8),l.YNc(29,xt,2,2,"mat-option",6),l.ALo(30,"async"),l.qZA(),l.qZA(),l.TgZ(31,"span"),l._uU(32,"\xa0"),l.qZA(),l.TgZ(33,"mat-form-field"),l.TgZ(34,"mat-label"),l._uU(35," \u5ba2\u6237\u7535\u8bdd "),l.qZA(),l._UZ(36,"input",9),l.qZA(),l.TgZ(37,"span"),l._uU(38,"\xa0"),l.qZA(),l.YNc(39,It,2,1,"button",10),l.YNc(40,Wt,2,1,"button",11),l._UZ(41,"br"),l.TgZ(42,"mat-form-field"),l.TgZ(43,"mat-label"),l._uU(44,"\u6bdb\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(45,"input",12),l.TgZ(46,"mat-icon",4),l._uU(47,"login"),l.qZA(),l.qZA(),l.TgZ(48,"span"),l._uU(49,"\xa0"),l.qZA(),l.TgZ(50,"mat-form-field"),l.TgZ(51,"mat-label"),l._uU(52,"\u8fdb\u573a\u65e5\u671f"),l.qZA(),l._UZ(53,"input",13),l.qZA(),l.TgZ(54,"span"),l._uU(55,"\xa0"),l.qZA(),l.TgZ(56,"mat-form-field"),l.TgZ(57,"mat-label"),l._uU(58,"\u8fdb\u573a\u65f6\u95f4"),l.qZA(),l._UZ(59,"input",14),l.qZA(),l.TgZ(60,"span"),l._uU(61,"\xa0"),l.qZA(),l.TgZ(62,"mat-form-field"),l.TgZ(63,"mat-label"),l._uU(64,"\u8fdb\u573a\u53f8\u78c5"),l.qZA(),l._UZ(65,"input",15),l.qZA(),l._UZ(66,"br"),l.TgZ(67,"mat-form-field"),l.TgZ(68,"mat-label"),l._uU(69,"\u76ae\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(70,"input",16),l.TgZ(71,"mat-icon",4),l._uU(72,"logout"),l.qZA(),l.qZA(),l.TgZ(73,"span"),l._uU(74,"\xa0"),l.qZA(),l.TgZ(75,"mat-form-field"),l.TgZ(76,"mat-label"),l._uU(77,"\u51fa\u573a\u65e5\u671f"),l.qZA(),l._UZ(78,"input",17),l.qZA(),l.TgZ(79,"span"),l._uU(80,"\xa0"),l.qZA(),l.TgZ(81,"mat-form-field"),l.TgZ(82,"mat-label"),l._uU(83,"\u51fa\u573a\u65f6\u95f4"),l.qZA(),l._UZ(84,"input",18),l.qZA(),l.TgZ(85,"span"),l._uU(86,"\xa0"),l.qZA(),l.TgZ(87,"mat-form-field"),l.TgZ(88,"mat-label"),l._uU(89,"\u51fa\u573a\u53f8\u78c5"),l.qZA(),l._UZ(90,"input",19),l.qZA(),l._UZ(91,"br"),l.TgZ(92,"mat-form-field"),l.TgZ(93,"mat-label"),l._uU(94,"\u51c0\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(95,"input",20),l.qZA(),l.TgZ(96,"span"),l._uU(97,"\xa0"),l.qZA(),l.YNc(98,Pt,2,1,"button",21),l.YNc(99,Dt,2,1,"button",21),l._UZ(100,"br"),l.TgZ(101,"mat-form-field",22),l.TgZ(102,"mat-label"),l._uU(103," \u5907\u6ce8 "),l.qZA(),l._UZ(104,"textarea",23),l.qZA(),l.qZA(),l.qZA(),l._UZ(105,"br"),l.TgZ(106,"mat-card"),l.TgZ(107,"mat-card-header"),l.TgZ(108,"mat-card-title"),l.TgZ(109,"small"),l._uU(110,"\u9a8c\u8d28\u4fe1\u606f"),l.qZA(),l.TgZ(111,"span"),l._uU(112,"\xa0\xa0\xa0"),l.qZA(),l.TgZ(113,"small"),l.TgZ(114,"small"),l.TgZ(115,"button",24),l._uU(116),l.qZA(),l.YNc(117,kt,2,1,"button",25),l.YNc(118,Et,2,1,"button",21),l.TgZ(119,"button",24),l._uU(120),l.qZA(),l.qZA(),l.qZA(),l.TgZ(121,"span"),l._uU(122,"\xa0\xa0\xa0"),l.qZA(),l.TgZ(123,"button",26),l.NdJ("click",function(){return e.addMaterial()}),l._uU(124,"\u6dfb\u52a0\u7269\u8d44"),l.qZA(),l.TgZ(125,"span"),l._uU(126,"\xa0\xa0\xa0"),l.qZA(),l.YNc(127,jt,2,0,"button",25),l.YNc(128,Ft,2,0,"button",21),l.qZA(),l.qZA(),l.TgZ(129,"mat-card-content"),l.YNc(130,St,38,8,"div",27),l.TgZ(131,"div",28),l._UZ(132,"br"),l.TgZ(133,"mat-form-field"),l.TgZ(134,"mat-label"),l._uU(135,"\u9a8c\u8d28\u5458"),l.qZA(),l._UZ(136,"input",29),l.TgZ(137,"mat-icon",4),l._uU(138,"assignment_ind"),l.qZA(),l.qZA(),l.TgZ(139,"span"),l._uU(140,"\xa0"),l.qZA(),l.TgZ(141,"mat-form-field"),l.TgZ(142,"mat-label"),l._uU(143,"\u9a8c\u8d28\u65e5\u671f"),l.qZA(),l._UZ(144,"input",30),l.qZA(),l.TgZ(145,"span"),l._uU(146,"\xa0"),l.qZA(),l.TgZ(147,"mat-form-field"),l.TgZ(148,"mat-label"),l._uU(149,"\u9a8c\u8d28\u65f6\u95f4"),l.qZA(),l._UZ(150,"input",31),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l._UZ(151,"br"),l.qZA(),l.qZA(),l.TgZ(152,"mat-dialog-actions",32),l.TgZ(153,"button",33),l.NdJ("click",function(){return e.onCancel()}),l._uU(154,"\u53d6\u6d88"),l.qZA(),l.TgZ(155,"button",34),l.NdJ("click",function(){return e.onSubmit()}),l._uU(156,"\u4fdd\u5b58"),l.qZA(),l.qZA(),l._UZ(157,"input",35),l.ALo(158,"async")),2&t){const t=l.MAs(19),i=l.MAs(28);let s;l.xp6(1),l.Oqu(e.dialogTitle),l.xp6(2),l.Q6J("formGroup",e.vswsForm),l.xp6(12),l.Q6J("matAutocompleteDisabled",!(null==(s=e.vswsForm.get("truckPlateNo"))||!s.value))("matAutocomplete",t),l.xp6(5),l.Q6J("ngForOf",e.truckPlateNoOptions),l.xp6(6),l.Q6J("matAutocompleteDisabled",!!e.data.vsws.weighing.customerId)("matAutocomplete",i),l.xp6(3),l.Q6J("ngForOf",l.lcZ(30,23,e.possibleCustomers$)),l.xp6(10),l.Q6J("ngIf",e.status.showNewCustomerButton),l.xp6(1),l.Q6J("ngIf",!e.status.showNewCustomerButton),l.xp6(55),l.Q6J("value",e.status.netWeightKG),l.xp6(3),l.Q6J("ngIf",e.vswsForm.errors),l.xp6(1),l.Q6J("ngIf",e.vswsForm.errors),l.xp6(17),l.hij("\u3010",e.materialsFormArray.controls.length,"\u9879\u3011"),l.xp6(1),l.Q6J("ngIf",e.status.materialTotalWeight<=e.status.netWeightKG),l.xp6(1),l.Q6J("ngIf",e.status.materialTotalWeight>e.status.netWeightKG),l.xp6(2),l.hij("\u3010",e.status.materialTotalCost,"\u5143\u3011"),l.xp6(3),l.Q6J("disabled",!e.vswsForm.get("weighing.inWeightKG").value||!e.vswsForm.get("weighing.outWeightKG").value||e.vswsForm.get("weighing.inWeightKG").value-e.vswsForm.get("weighing.outWeightKG").value<=0),l.xp6(4),l.Q6J("ngIf",!e.vswsForm.get("weighing.inWeightKG").value||!e.vswsForm.get("weighing.outWeightKG").value||e.vswsForm.get("weighing.inWeightKG").value-e.vswsForm.get("weighing.outWeightKG").value<=0),l.xp6(1),l.Q6J("ngIf",!1),l.xp6(2),l.Q6J("ngForOf",e.materialsFormArray.controls),l.xp6(25),l.Q6J("disabled",e.vswsForm.invalid||e.materialsFormArray.invalid),l.xp6(2),l.Q6J("value",l.lcZ(158,25,e.status.observables.valueChanges))}},directives:[r.uh,r.xY,rt._Y,rt.JL,rt.sg,vt.a8,vt.dk,vt.n5,vt.dn,rt.x0,ut.KE,ut.hX,ct.Nt,rt.Fj,qt.ZL,rt.JJ,rt.u,dt.Hw,ut.qo,qt.XC,ht.sg,ht.O5,rt.wV,gt.lW,r.H8,Ut.ey,Ot.gD,rt.oH],pipes:[ht.Ov],styles:[".width-fifty[_ngcontent-%COMP%]{width:50%;min-width:50vw}@media only screen and (min-width:768px){.width-ten-vm[_ngcontent-%COMP%]{max-width:10%}}"]}),t})(),Lt=(()=>{class t{constructor(t,e,i){this.dialog=t,this.backend=e,this.auth=i,this.changesSaved$$=new nt.xQ}openDialog(t,e){return console.log("opening vswsDialog with data:"),console.log(t),(0,c.D)({vsws:(t=>{if(t){const e=this.dialog.open(u,{disableClose:!0});return(0,c.D)({customer:t.weighing.customerId?this.backend.dataCustomers.search({_id:t.weighing.customerId}).pipe((0,g.U)(t=>t.length?t[0]:null)):(0,v.of)(null),inWeighedBy:t.weighing.inWeighedBy?this.backend.dataUsers.search({_id:t.weighing.inWeighedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),outWeighedBy:t.weighing.outWeighedBy?this.backend.dataUsers.search({_id:t.weighing.outWeighedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),surveyedBy:t.survey.surveyedBy?this.backend.dataUsers.search({_id:t.survey.surveyedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null)}).pipe((0,g.U)(i=>(i.customer&&(t.weighing.customerName=i.customer.name,t.weighing.customerTel=i.customer.mobile),i.inWeighedBy&&(t.weighing.inWeighedByName=i.inWeighedBy.displayName),i.outWeighedBy&&(t.weighing.outWeighedByName=i.outWeighedBy.displayName),i.surveyedBy&&(t.survey.surveyedByName=i.surveyedBy.displayName),e.close(),t)))}{const t=new d;return(0,v.of)(t)}})(t),pws:this.backend.dataPws.getPws()}).pipe((0,b.P)(),(0,g.U)(t=>{let i;switch(e){case"printWeighing":i=this.dialog.open(pt,{disableClose:!1,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",height:"100%",maxWidth:"100%"});break;default:i=this.dialog.open(Bt,{disableClose:!0,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",maxWidth:"100%"})}return i}))}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw),l.LFG(it),l.LFG(_t.e))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac}),t})();var Gt=i(6489),Yt=i(994),Qt=i(9199);function Kt(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u8fdb\u573a\u65e5\u671f "),l.qZA())}function Mt(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.ALo(2,"date"),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",l.xi3(2,1,null==t.weighing?null:t.weighing.inWeighedAt,"y-MM-dd HH:mm")," ")}}function $t(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u8fdb\u573a\u8f66\u724c\u53f7 "),l.qZA())}function Ht(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",t.weighing.truckPlateNo," ")}}function Vt(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u51c0\u91cd "),l.qZA())}function Xt(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.ALo(2,"number"),l.qZA()),2&t){const t=e.$implicit,i=l.oxw();l.xp6(1),l.hij(" ",l.lcZ(2,1,i.getNetWeight(t))," ")}}function zt(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1,"\u64cd\u4f5c"),l.qZA())}function te(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"td",11),l.TgZ(1,"button",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().onEdit(e)}),l.TgZ(2,"mat-icon"),l._uU(3,"edit"),l.qZA(),l.qZA(),l.TgZ(4,"span"),l._uU(5,"\xa0"),l.qZA(),l.TgZ(6,"button",13),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().onPrint(e)}),l.TgZ(7,"mat-icon"),l._uU(8,"print"),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=l.oxw();l.xp6(6),l.Q6J("disabled",i.getNetWeight(t)<=0)}}function ee(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u5df2\u9a8c\u8d28 "),l.qZA())}function ie(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",t.survey.surveyedAt?"\u662f":"\u5426"," ")}}function se(t,e){1&t&&l._UZ(0,"tr",14)}function oe(t,e){1&t&&l._UZ(0,"tr",15)}let ae=(()=>{class t{constructor(t,e){this.dialog=t,this.vswsDialog=e,this.vswsRecentList=[],this.displayedColumns=["_id","truckPlateNo","netWeight","surveyDone","operations"]}ngOnInit(){}onEdit(t){console.log("on edit"),this.vswsDialog.openDialog(t).pipe((0,w.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}onPrint(t){console.log("on printWeighing"),this.vswsDialog.openDialog(t,"printWeighing").pipe((0,w.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}getNetWeight(t){var e,i,s,o;return 1*(null===(e=t.weighing)||void 0===e?void 0:e.inWeightKG)&&1*(null===(i=t.weighing)||void 0===i?void 0:i.outWeightKG)?(null===(s=t.weighing)||void 0===s?void 0:s.inWeightKG)-(null===(o=t.weighing)||void 0===o?void 0:o.outWeightKG):0}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.uw),l.Y36(Lt))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-recent"]],inputs:{vswsRecentList:"vswsRecentList"},decls:18,vars:3,consts:[["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","_id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","truckPlateNo"],["matColumnDef","netWeight"],["matColumnDef","operations"],["matColumnDef","surveyDone"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(l.TgZ(0,"table",0),l.ynx(1,1),l.YNc(2,Kt,2,0,"th",2),l.YNc(3,Mt,3,4,"td",3),l.BQk(),l.ynx(4,4),l.YNc(5,$t,2,0,"th",2),l.YNc(6,Ht,2,1,"td",3),l.BQk(),l.ynx(7,5),l.YNc(8,Vt,2,0,"th",2),l.YNc(9,Xt,3,3,"td",3),l.BQk(),l.ynx(10,6),l.YNc(11,zt,2,0,"th",2),l.YNc(12,te,9,1,"td",3),l.BQk(),l.ynx(13,7),l.YNc(14,ee,2,0,"th",2),l.YNc(15,ie,2,1,"td",3),l.BQk(),l.YNc(16,se,1,0,"tr",8),l.YNc(17,oe,1,0,"tr",9),l.qZA()),2&t&&(l.Q6J("dataSource",e.vswsRecentList),l.xp6(16),l.Q6J("matHeaderRowDef",e.displayedColumns),l.xp6(1),l.Q6J("matRowDefColumns",e.displayedColumns))},directives:[Qt.BZ,Qt.w1,Qt.fO,Qt.Dz,Qt.as,Qt.nj,Qt.ge,Qt.ev,gt.lW,dt.Hw,Qt.XQ,Qt.Gk],pipes:[ht.uU,ht.JJ],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}"]}),t})(),ne=(()=>{class t{constructor(t,e,i){this.backend=t,this.dialog=e,this.vswsDialog=i,this.filterSurveyDone$$=new ot.X(!1)}onCreate(){this.vswsDialog.openDialog().pipe((0,w.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}ngOnInit(){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u8f7d\u5165\u8fd1\u671f\u5e9f\u94a2\u8fdb\u573a\u8bb0\u5f55..."}});this.vswsRecentList$=this.vswsDialog.changesSaved$$.pipe((0,at.O)(null),(0,w.w)(()=>this.backend.dataVS.getRecent()),(0,w.w)(e=>this.filterSurveyDone$$.pipe((0,g.U)(t=>t?e.filter(t=>0==!!t.survey.surveyedAt):e),(0,Z.b)(()=>{t.close()}))))}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(it),l.Y36(r.uw),l.Y36(Lt))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey"]],decls:27,vars:4,consts:[["mat-raised-button","","color","primary",3,"click"],[3,"expanded"],[3,"change"],[3,"vswsRecentList"]],template:function(t,e){1&t&&(l.TgZ(0,"mat-card"),l.TgZ(1,"button",0),l.NdJ("click",function(){return e.onCreate()}),l._uU(2,"\u65b0\u5efa\u8fdb\u573a\u7269\u8d44"),l.qZA(),l.TgZ(3,"div"),l._uU(4,"\xa0"),l.qZA(),l.TgZ(5,"mat-accordion"),l.TgZ(6,"mat-expansion-panel",1),l.TgZ(7,"mat-expansion-panel-header"),l.TgZ(8,"mat-panel-title"),l.TgZ(9,"span"),l._uU(10,"\u8fd1\u671f\u8fdb\u573a\u7269\u8d44"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"mat-checkbox",2),l.NdJ("change",function(t){return e.filterSurveyDone$$.next(t.checked)}),l._uU(12,"\u4ec5\u663e\u793a\u3010\u672a\u9a8c\u8d28\u3011"),l.qZA(),l.TgZ(13,"div"),l.TgZ(14,"span"),l._uU(15,"\xa0"),l.qZA(),l.qZA(),l._UZ(16,"app-vehicle-steel-weighing-survey-recent",3),l.ALo(17,"async"),l.qZA(),l.qZA(),l.TgZ(18,"div"),l._uU(19,"\xa0"),l.qZA(),l.TgZ(20,"mat-accordion"),l.TgZ(21,"mat-expansion-panel"),l.TgZ(22,"mat-expansion-panel-header"),l.TgZ(23,"mat-panel-title"),l._uU(24," \u8fdb\u573a\u7269\u8d44\u6c47\u603b "),l.qZA(),l.qZA(),l.TgZ(25,"p"),l._uU(26,"To Do"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(6),l.Q6J("expanded",!0),l.xp6(10),l.Q6J("vswsRecentList",l.lcZ(17,2,e.vswsRecentList$)))},directives:[vt.a8,gt.lW,Gt.pp,Gt.ib,Gt.yz,Gt.yK,Yt.oG,ae],pipes:[ht.Ov],styles:[""]}),t})();var re=i(3295);function le(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",3),l.NdJ("click",function(){return l.CHM(t),l.oxw().refresh()}),l.TgZ(1,"mat-icon"),l._uU(2,"refresh"),l.qZA(),l.qZA()}}const ue=[{path:"",component:(()=>{class t{constructor(t,e){this.dialog=t,this.backend=e}ngOnInit(){}refresh(){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u66f4\u65b0\u7269\u6599\u540d\u79f0..."}});this.backend.dataPws.refreshPws().subscribe(()=>{t.close()})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.uw),l.Y36(it))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-home"]],decls:5,vars:0,consts:[["label","\u7269\u8d44\u8fdb\u573a\u9a8c\u8d28"],["disabled","","label","\u7269\u8d44\u8fdb\u573a\u9a8c\u8d28"],["mat-tab-label",""],["mat-button","","color","primary","matTooltip","\u66f4\u65b0\u7269\u6599\u540d\u79f0",3,"click"]],template:function(t,e){1&t&&(l.TgZ(0,"mat-tab-group"),l.TgZ(1,"mat-tab",0),l._UZ(2,"app-vehicle-steel-weighing-survey"),l.qZA(),l.TgZ(3,"mat-tab",1),l.YNc(4,le,3,0,"ng-template",2),l.qZA(),l.qZA())},directives:[st.SP,st.uX,ne,st.uD,gt.lW,re.gM,dt.Hw],styles:[""]}),t})(),pathMatch:"full"}];let ce=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[n.Bz.forChild(ue)],n.Bz]}),t})();const ge=[];let de=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[n.Bz.forChild(ge)],n.Bz]}),t})(),he=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({providers:[Tt],imports:[[de,a.m]]}),t})(),me=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({providers:[Lt,ht.JJ],imports:[[ce,a.m,he]]}),t})()}}]);