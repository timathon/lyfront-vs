(self.webpackChunklyfront_vs=self.webpackChunklyfront_vs||[]).push([[918],{2918:(t,e,i)=>{"use strict";i.r(e),i.d(e,{VehicleSteelModule:()=>Pe});var n={};i.r(n),i.d(n,{JsonPatchError:()=>J,_areEquals:()=>Y,applyOperation:()=>E,applyPatch:()=>B,applyReducer:()=>L,deepClone:()=>S,getValueByPointer:()=>F,validate:()=>G,validator:()=>M});var s={};i.r(s),i.d(s,{compare:()=>tt,generate:()=>X,observe:()=>V,unobserve:()=>H});var a=i(1827),o=i(3464),r=i(2935),l=i(5366);let u=(()=>{class t{constructor(t){this.data=t,this.message=this.data&&this.data.message?this.data.message:"\u6b63\u5728\u8f7d\u5165..."}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-loading"]],decls:2,vars:1,consts:[["mat-dialog-title",""]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA()),2&t&&(l.xp6(1),l.Oqu(e.message))},directives:[r.uh],styles:[""]}),t})();var c=i(3148),g=i(9996);class h{constructor(){this._id=null,this.createdAt=null,this.createdBy=null,this.modifiedAt=null,this.modifiedBy=null,this.isDeleted=!1,this.deletedAt=null,this.deletedBy=null,this.deletedNotes=null,this.weighing={truckPlateNo:"",customerId:"",notes:"",inWeightKG:0,inWeighedBy:"",inWeighedAt:new Date,outWeightKG:0,outWeighedBy:""},this.survey={surveyedBy:"",materials:[]},this.changeLogs=[]}}class d{constructor(t,e,i){this.http=t,this.setHeaders=e,this.appConfig=i,this.apiURL=this.appConfig.backendUrl+"/api/vehicle-steel"}getRecent(){const t=new Date;t.setDate(t.getDate()-29);const e=new Date(t.toISOString().substr(0,10));e.setHours(0);const i={createdAt:{$gte:new Date(e)}},n={createdAt:{$lt:new Date(e)},"survey.surveyedBy":""};return(0,c.D)({within7days:this.search(i),over7daysNotSurveyed:this.search(n)}).pipe((0,g.U)(t=>[...t.within7days,...t.over7daysNotSurveyed]))}insert(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}update(t){return console.log(t),this.http.patch(this.apiURL+"/one",t,{headers:this.setHeaders(!0)})}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}class m{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/customers"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}save(t){if(t.oldCustomer._id){const e=this.calculatePatches.calculatePatches({oldObject:t.oldCustomer,newObject:t.newCustomer,keysToIgnore:["_id","createdAt","createdBy","modifiedAt","modifiedBy"]});return console.log(e),this.patch(t.oldCustomer._id,e)}return this.create(t.newCustomer)}create(t){return this.http.post(this.apiURL,t,{headers:this.setHeaders(!0)})}patch(t,e){return this.http.patch(this.apiURL,{_id:t,patches:e},{headers:this.setHeaders(!0)})}}class p{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/users"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}}var f=i(8598),v=i(878),Z=i(4689),w=i(4019),b=i(3530);class A{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/pws-v2"}search(t){return this.http.post(this.apiURL+"/search",t,{headers:this.setHeaders(!0)})}getPws(){return(0,v.of)(localStorage.getItem("pws")).pipe((0,Z.w)(t=>t?(0,v.of)(JSON.parse(t)):this.refreshPws()))}refreshPws(){return this.search({}).pipe((0,w.b)(t=>{localStorage.setItem("pws",JSON.stringify(t))}),(0,b.P)())}}class y{constructor(t,e,i,n){this.http=t,this.setHeaders=e,this.appConfig=i,this.calculatePatches=n,this.apiURL=this.appConfig.backendUrl+"/api/prices-v3"}getPrices3(t,e=!1){const i={};return Object.keys(t).forEach(e=>{t[e]&&(i[e]=t[e])}),this.http.post(this.apiURL+`/search?exact=${e}`,i,{headers:this.setHeaders(!0)})}}var T,_=i(2693),q=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),U=Object.prototype.hasOwnProperty;function C(t,e){return U.call(t,e)}function O(t){if(Array.isArray(t)){for(var e=new Array(t.length),i=0;i<e.length;i++)e[i]=""+i;return e}if(Object.keys)return Object.keys(t);for(var n in e=[],t)C(t,n)&&e.push(n);return e}function x(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function N(t){for(var e,i=0,n=t.length;i<n;){if(!((e=t.charCodeAt(i))>=48&&e<=57))return!1;i++}return!0}function P(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function I(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function W(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)if(W(t[e]))return!0}else if("object"==typeof t){var n=O(t),s=n.length;for(e=0;e<s;e++)if(W(t[n[e]]))return!0}return!1}function D(t,e){var i=[t];for(var n in e){var s="object"==typeof e[n]?JSON.stringify(e[n],null,2):e[n];void 0!==s&&i.push(n+": "+s)}return i.join("\n")}var k=function(t){function e(e,i,n,s,a){var o=this.constructor,r=t.call(this,D(e,{name:i,index:n,operation:s,tree:a}))||this;return r.name=i,r.index=n,r.operation=s,r.tree=a,Object.setPrototypeOf(r,o.prototype),r.message=D(e,{name:i,index:n,operation:s,tree:a}),r}return q(e,t),e}(Error),J=k,S=x,R={add:function(t,e,i){return t[e]=this.value,{newDocument:i}},remove:function(t,e,i){var n=t[e];return delete t[e],{newDocument:i,removed:n}},replace:function(t,e,i){var n=t[e];return t[e]=this.value,{newDocument:i,removed:n}},move:function(t,e,i){var n=F(i,this.path);n&&(n=x(n));var s=E(i,{op:"remove",path:this.from}).removed;return E(i,{op:"add",path:this.path,value:s}),{newDocument:i,removed:n}},copy:function(t,e,i){var n=F(i,this.from);return E(i,{op:"add",path:this.path,value:x(n)}),{newDocument:i}},test:function(t,e,i){return{newDocument:i,test:Y(t[e],this.value)}},_get:function(t,e,i){return this.value=t[e],{newDocument:i}}},j={add:function(t,e,i){return N(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:i,index:e}},remove:function(t,e,i){return{newDocument:i,removed:t.splice(e,1)[0]}},replace:function(t,e,i){var n=t[e];return t[e]=this.value,{newDocument:i,removed:n}},move:R.move,copy:R.copy,test:R.test,_get:R._get};function F(t,e){if(""==e)return t;var i={op:"_get",path:e};return E(t,i),i.value}function E(t,e,i,n,s,a){if(void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===s&&(s=!0),void 0===a&&(a=0),i&&("function"==typeof i?i(e,0,t,e.path):M(e,0)),""===e.path){var o={newDocument:t};if("add"===e.op)return o.newDocument=e.value,o;if("replace"===e.op)return o.newDocument=e.value,o.removed=t,o;if("move"===e.op||"copy"===e.op)return o.newDocument=F(t,e.from),"move"===e.op&&(o.removed=t),o;if("test"===e.op){if(o.test=Y(t,e.value),!1===o.test)throw new J("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o.newDocument=t,o}if("remove"===e.op)return o.removed=t,o.newDocument=null,o;if("_get"===e.op)return e.value=t,o;if(i)throw new J("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return o}n||(t=x(t));var r=(e.path||"").split("/"),l=t,u=1,c=r.length,g=void 0,h=void 0,d=void 0;for(d="function"==typeof i?i:M;;){if(h=r[u],s&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(i&&void 0===g&&(void 0===l[h]?g=r.slice(0,u).join("/"):u==c-1&&(g=e.path),void 0!==g&&d(e,0,t,g)),u++,Array.isArray(l)){if("-"===h)h=l.length;else{if(i&&!N(h))throw new J("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);N(h)&&(h=~~h)}if(u>=c){if(i&&"add"===e.op&&h>l.length)throw new J("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);if(!1===(o=j[e.op].call(e,l,h,t)).test)throw new J("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o}}else if(h&&-1!=h.indexOf("~")&&(h=I(h)),u>=c){if(!1===(o=R[e.op].call(e,l,h,t)).test)throw new J("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o}l=l[h]}}function B(t,e,i,n,s){if(void 0===n&&(n=!0),void 0===s&&(s=!0),i&&!Array.isArray(e))throw new J("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=x(t));for(var a=new Array(e.length),o=0,r=e.length;o<r;o++)a[o]=E(t,e[o],i,!0,s,o),t=a[o].newDocument;return a.newDocument=t,a}function L(t,e,i){var n=E(t,e);if(!1===n.test)throw new J("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return n.newDocument}function M(t,e,i,n){if("object"!=typeof t||null===t||Array.isArray(t))throw new J("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,i);if(!R[t.op])throw new J("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,i);if("string"!=typeof t.path)throw new J("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,i);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new J('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,i);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new J("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new J("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&W(t.value))throw new J("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,i);if(i)if("add"==t.op){var s=t.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new J("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,i)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==n)throw new J("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,i)}else if("move"===t.op||"copy"===t.op){var o=G([{op:"_get",path:t.from,value:void 0}],i);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new J("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,i)}}function G(t,e,i){try{if(!Array.isArray(t))throw new J("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)B(x(e),x(t),i||!0);else{i=i||M;for(var n=0;n<t.length;n++)i(t[n],n,e,void 0)}}catch(s){if(s instanceof J)return s;throw s}}function Y(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var i,n,s,a=Array.isArray(t),o=Array.isArray(e);if(a&&o){if((n=t.length)!=e.length)return!1;for(i=n;0!=i--;)if(!Y(t[i],e[i]))return!1;return!0}if(a!=o)return!1;var r=Object.keys(t);if((n=r.length)!==Object.keys(e).length)return!1;for(i=n;0!=i--;)if(!e.hasOwnProperty(r[i]))return!1;for(i=n;0!=i--;)if(!Y(t[s=r[i]],e[s]))return!1;return!0}return t!=t&&e!=e}var Q=new WeakMap,K=function(){return function(t){this.observers=new Map,this.obj=t}}(),$=function(){return function(t,e){this.callback=t,this.observer=e}}();function H(t,e){e.unobserve()}function V(t,e){var i,n=function(t){return Q.get(t)}(t);if(n){var s=function(t,e){return t.observers.get(e)}(n,e);i=s&&s.observer}else n=new K(t),Q.set(t,n);if(i)return i;if(i={},n.value=x(t),e){i.callback=e,i.next=null;var a=function(){X(i)},o=function(){clearTimeout(i.next),i.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return i.patches=[],i.object=t,i.unobserve=function(){X(i),clearTimeout(i.next),function(t,e){t.observers.delete(e.callback)}(n,i),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},n.observers.set(e,new $(e,i)),i}function X(t,e){void 0===e&&(e=!1);var i=Q.get(t.object);z(i.value,t.object,t.patches,"",e),t.patches.length&&B(i.value,t.patches);var n=t.patches;return n.length>0&&(t.patches=[],t.callback&&t.callback(n)),n}function z(t,e,i,n,s){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var a=O(e),o=O(t),r=!1,l=o.length-1;l>=0;l--){var u=t[g=o[l]];if(!C(e,g)||void 0===e[g]&&void 0!==u&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(s&&i.push({op:"test",path:n+"/"+P(g),value:x(u)}),i.push({op:"remove",path:n+"/"+P(g)}),r=!0):(s&&i.push({op:"test",path:n,value:t}),i.push({op:"replace",path:n,value:e}));else{var c=e[g];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?z(u,c,i,n+"/"+P(g),s):u!==c&&(s&&i.push({op:"test",path:n+"/"+P(g),value:x(u)}),i.push({op:"replace",path:n+"/"+P(g),value:x(c)}))}}if(r||a.length!=o.length)for(l=0;l<a.length;l++){var g;C(t,g=a[l])||void 0===e[g]||i.push({op:"add",path:n+"/"+P(g),value:x(e[g])})}}}function tt(t,e,i){void 0===i&&(i=!1);var n=[];return z(t,e,n,"",i),n}const et=Object.assign({},n,s,{JsonPatchError:k,deepClone:x,escapePathComponent:P,unescapePathComponent:I});let it=(()=>{class t{constructor(){}trimObject(t,e){const i={},n=(t,e,i)=>(Object.keys(e).forEach(s=>{e[s]&&"object"!=typeof e[s]?i[s]=t[s]:e[s]&&"object"==typeof e[s]&&(i[s]={},i[s]=n(t[s],e[s],i[s]))}),i);return n(t,e,i),i}calculatePatches(t){let e;if(t.keysToIgnore){const i=(t,e)=>{const i={};return Object.keys(t).filter(t=>-1===e.indexOf(t)).forEach(e=>{i[e]=t[e]}),i};e=et.compare(i(t.oldObject,t.keysToIgnore),i(t.newObject,t.keysToIgnore))}else{if(!t.objectTemplate)throw"bad option for calculate patches";e=et.compare(this.trimObject(t.oldObject,t.objectTemplate),this.trimObject(t.newObject,t.objectTemplate))}return e.map(t=>("add"===t.op&&(t.op="replace"),t))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),nt=(()=>{class t{constructor(t,e,i){this.http=t,this.appConfig=e,this.calculatePatches=i,this.cache={},this.dataVS=new d(this.http,this.setHeaders,this.appConfig),this.dataCustomers=new m(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataUsers=new p(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataPws=new A(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.dataPrices=new y(this.http,this.setHeaders,this.appConfig,this.calculatePatches),this.cacheInit()}cacheInit(){(0,c.D)({pws:this.dataPws.getPws()}).pipe((0,b.P)()).subscribe(t=>{this.cache=t})}setHeaders(t=!1){let e;return e=t?{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(localStorage.getItem("currentUser")).token}`}:{"Content-Type":"application/json"},e}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(_.eN),l.LFG(f.q),l.LFG(it))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=i(7173),at=i(8512),ot=i(6238),rt=i(5959),lt=i(9342),ut=i(8470),ct=i(6673),gt=i(5686),ht=i(6882);class dt{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new mt(t,this.resultSelector))}}class mt extends ct.L{constructor(t,e,i=Object.create(null)){super(t),this.resultSelector=e,this.iterators=[],this.active=0,this.resultSelector="function"==typeof e?e:void 0}_next(t){const e=this.iterators;(0,ut.k)(t)?e.push(new ft(t)):e.push("function"==typeof t[gt.hZ]?new pt(t[gt.hZ]()):new vt(this.destination,this,t))}_complete(){const t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(let i=0;i<e;i++){let e=t[i];e.stillUnsubscribed?this.destination.add(e.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const t=this.iterators,e=t.length,i=this.destination;for(let a=0;a<e;a++){let e=t[a];if("function"==typeof e.hasValue&&!e.hasValue())return}let n=!1;const s=[];for(let a=0;a<e;a++){let e=t[a],o=e.next();if(e.hasCompleted()&&(n=!0),o.done)return void i.complete();s.push(o.value)}this.resultSelector?this._tryresultSelector(s):i.next(s),n&&i.complete()}_tryresultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class pt{constructor(t){this.iterator=t,this.nextResult=t.next()}hasValue(){return!0}next(){const t=this.nextResult;return this.nextResult=this.iterator.next(),t}hasCompleted(){const t=this.nextResult;return Boolean(t&&t.done)}}class ft{constructor(t){this.array=t,this.index=0,this.length=0,this.length=t.length}[gt.hZ](){return this}next(t){const e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class vt extends ht.Ds{constructor(t,e,i){super(t),this.parent=e,this.observable=i,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[gt.hZ](){return this}next(){const t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(t){this.buffer.push(t),this.parent.checkIterators()}subscribe(){return(0,ht.ft)(this.observable,new ht.IY(this))}}var Zt=i(104),wt=i(1041);let bt=(()=>{class t{constructor(){}compareObjects(t,e,i=[]){function n(t){return null!=t&&"object"==typeof t}let s={},a={};return i.length?i.forEach(i=>{s[i]=t[i],a[i]=e[i]}):(s=t,a=e),function t(e,i){const s=Object.keys(e),a=Object.keys(i);if(s.length!==a.length)return!1;for(const o of s){const s=e[o],a=i[o],r=n(s)&&n(a);if(r&&!t(s,a)||!r&&s!==a)return!1}return!0}(s,a)}toChineseNumber(t){if(!Number.isInteger(t)||t<0)throw Error("\u8bf7\u8f93\u5165\u81ea\u7136\u6570");const e=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"],i=["","\u5341","\u767e","\u5343","\u4e07","\u5341\u4e07","\u767e\u4e07","\u5343\u4e07","\u4ebf","\u5341\u4ebf","\u767e\u4ebf","\u5343\u4ebf"],n=String(t).split("");let s="",a=!1;for(let o=0;o<n.length;o++){const t=n[o];"0"===t||a?"0"===t?a=!0:"0"!==t&&a&&(s+="\u96f6"+e[parseInt(t)]+i[n.length-o-1],a=!1):(s+=e[parseInt(t)]+i[n.length-o-1],a=!1)}return t<100&&(s=s.replace("\u4e00\u5341","\u5341")),s}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var At=i(3070),yt=i(9550),Tt=i(4369),_t=i(7307),qt=i(1116);function Ut(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",15),l._uU(2),l.TgZ(3,"span"),l._uU(4,"\xa0"),l.qZA(),l.qZA(),l.TgZ(5,"div",16),l._uU(6),l.qZA(),l.TgZ(7,"div",32),l._uU(8),l.ALo(9,"number"),l.qZA(),l.TgZ(10,"div",33),l._uU(11),l.ALo(12,"number"),l.qZA(),l.TgZ(13,"div",34),l._uU(14),l.ALo(15,"number"),l.qZA(),l.BQk()),2&t){const t=e.$implicit,i=l.oxw();l.xp6(2),l.Oqu(t?i.getPwCode(t):""),l.xp6(4),l.Oqu(t?i.getPwName(t):""),l.xp6(2),l.Oqu(t?l.xi3(9,5,i.getWeightTon(t),"1.2-2"):""),l.xp6(3),l.Oqu(t?l.xi3(12,8,1e3*t.price,"1.2-2"):""),l.xp6(3),l.Oqu(t?l.xi3(15,11,i.getAmount(t),"1.2-2"):"")}}const Ct=function(t){return{padding:t}};let Ot=(()=>{class t{constructor(t,e,i,n,s){var a;this.auth=t,this.fb=e,this.data=i,this.utils=n,this.dialogRef=s,this.todayDate=new Date,this.valueLessPwId="60b046d142632c04fb202b57",this.userName=null===(a=this.auth.getCurrentUser())||void 0===a?void 0:a.displayName;const o=localStorage.getItem("surveyPrintPaddingCache")?JSON.parse(localStorage.getItem("surveyPrintPaddingCache")):{top:0,bottom:0,left:0,right:0};this.paddingForm=this.fb.group(o),this.materialsArr=this.prepareMaterialsArr(this.data.vsws.survey.materials),this.selectedPws=this.data.pws.filter(t=>t.name.indexOf("\u5e9f\u94a2")>-1&&t.name.indexOf("\u516c\u65a4")>-1)}prepareMaterialsArr(t){if(t.length>4)return t;{const e=Array(5).fill(null).map((e,i)=>t[i]?t[i]:null);return console.log(e),e}}getPwCode(t){const e=this.getPwName(t);switch(!0){case e.indexOf("\u8f7b\u8584\u6599")>-1:return 23;case e.indexOf("\u4e2d\u578b")>-1:case e.indexOf("\u6c7d\u6cb9")>-1:case e.indexOf("\u67f4\u6cb9")>-1:return"\u5f85\u67e5";case e.indexOf("\u6742\u8d28")>-1:return 27;default:return"\u5f85\u67e5"}}getWeightTon(t){return t.weightKG/1e3}getTotalWeightTon(t){return t.reduce((t,e)=>e.pwId!==this.valueLessPwId&&e.weightKG?e.weightKG/1e3+t:t,0)}getTotalAmount(t){return 1.13*t.reduce((t,e)=>e.pwId!==this.valueLessPwId&&e.price?e.price*e.weightKG+t:t,0)}getAveragePrice(t){return Math.round(this.getTotalAmount(t)/this.getTotalWeightTon(t)*100)/100}getAmount(t){return(t.price||0)*(t.weightKG||0)}getDefaultPrice(t,e){const i=t.pwId,[n]=e.filter(t=>t.pwId===i);return n?1e3*n.numbers.default:""}ngOnInit(){console.log(this.data)}getPwName(t){if(t){const[e]=this.selectedPws.filter(e=>e._id===t.pwId);return e.name.replace("\uff08\u516c\u65a4\uff09","")}return""}ngOnDestroy(){this.paddingForm.dirty&&(console.log("changed"),localStorage.setItem("surveyPrintPaddingCache",JSON.stringify(this.paddingForm.getRawValue())))}closeDialog(){this.dialogRef.close()}get padding(){const t=this.paddingForm.getRawValue();return`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`}onBtnPrintClick(){window.print()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Zt.e),l.Y36(wt.qu),l.Y36(r.WI),l.Y36(bt),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-survey-print"]],decls:94,vars:29,consts:[[1,"noprint",3,"formGroup"],[2,"width","5em"],["type","number","matInput","","formControlName","top"],["type","number","matInput","","formControlName","left"],["type","number","matInput","","formControlName","right"],["mat-button","",3,"click"],["mat-button","",2,"float","right",3,"click"],["id","dataToPrint",1,"t3",3,"ngStyle"],[1,"header"],[1,"header2"],[1,"meta11"],[1,"meta12"],[1,"meta13"],[1,"meta14"],[1,"meta15"],[1,"item","content1"],[1,"item","content2"],[1,"item","content3"],[1,"item","content4"],[1,"item","lastcolumn","content5"],[4,"ngFor","ngForOf"],[1,"item","lastrow","content1"],[1,"item","lastrow","content2","text-right"],[1,"item","lastrow","content3","number"],[1,"item","lastrow","content4","number"],[1,"item","lastrow","lastcolumn","content5","number"],[1,"footer1"],[1,"footer2"],[1,"footer22"],[1,"footer3"],[1,"footer4"],[1,"footer5"],[1,"item","content3","number"],[1,"item","content4","number"],[1,"item","lastcolumn","content5","number"]],template:function(t,e){1&t&&(l.TgZ(0,"form",0),l.TgZ(1,"mat-form-field",1),l.TgZ(2,"mat-label"),l._uU(3," \u4e0a\u90e8\u7f29\u8fdb "),l.qZA(),l._UZ(4,"input",2),l.qZA(),l.TgZ(5,"span"),l._uU(6,"\xa0"),l.qZA(),l.TgZ(7,"mat-form-field",1),l.TgZ(8,"mat-label"),l._uU(9," \u5de6\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(10,"input",3),l.qZA(),l.TgZ(11,"span"),l._uU(12,"\xa0"),l.qZA(),l.TgZ(13,"mat-form-field",1),l.TgZ(14,"mat-label"),l._uU(15," \u53f3\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(16,"input",4),l.qZA(),l.TgZ(17,"span"),l._uU(18,"\xa0"),l.qZA(),l.TgZ(19,"button",5),l.NdJ("click",function(){return e.onBtnPrintClick()}),l.TgZ(20,"mat-icon"),l._uU(21,"print"),l.qZA(),l.qZA(),l.TgZ(22,"button",6),l.NdJ("click",function(){return e.closeDialog()}),l.TgZ(23,"mat-icon"),l._uU(24,"close"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(25,"div",7),l.TgZ(26,"div",8),l._uU(27,"\u8fbd\u5b81\u9686\u8fd0\u73af\u4fdd\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8"),l.qZA(),l.TgZ(28,"div",9),l._uU(29,"\u5165\u5e93\u7ed3\u7b97\u5355"),l.qZA(),l.TgZ(30,"div",10),l._uU(31,"\u7ed3\u7b97\u5355\u4f4d\uff1a"),l.qZA(),l.TgZ(32,"div",11),l._uU(33),l.qZA(),l._UZ(34,"div",12),l.TgZ(35,"div",13),l._uU(36,"\u7ed3\u7b97\u5355\u53f7\uff1a"),l.qZA(),l.TgZ(37,"div",14),l._uU(38),l.ALo(39,"date"),l.qZA(),l.TgZ(40,"div",10),l._uU(41,"\u53d1\u7968\u5355\u4f4d\uff1a"),l.qZA(),l.TgZ(42,"div",11),l._uU(43),l.qZA(),l._UZ(44,"div",12),l.TgZ(45,"div",13),l._uU(46,"\u8f66\u53f7\uff1a"),l.qZA(),l.TgZ(47,"div",14),l._uU(48),l.qZA(),l.TgZ(49,"div",10),l._uU(50,"\u4ef7\u683c\u8868\uff1a"),l.qZA(),l.TgZ(51,"div",11),l._uU(52,"\u91c7\u8d2d"),l.qZA(),l._UZ(53,"div",12),l.TgZ(54,"div",13),l._uU(55,"\u4ee3\u57ab\u8fd0\u8d39\uff1a"),l.qZA(),l.TgZ(56,"div",14),l._uU(57,"0"),l.qZA(),l.TgZ(58,"div",15),l._uU(59,"\u4ea7\u54c1\u4ee3\u7801"),l.qZA(),l.TgZ(60,"div",16),l._uU(61,"\u4ea7\u54c1\u540d\u79f0"),l.qZA(),l.TgZ(62,"div",17),l._uU(63,"\u7ed3\u7b97\u6570\u91cf(\u5428)"),l.qZA(),l.TgZ(64,"div",18),l._uU(65,"\u7ed3\u7b97\u4ef7\u683c(\u5143/\u5428)"),l.qZA(),l.TgZ(66,"div",19),l._uU(67,"\u7ed3\u7b97\u91d1\u989d(\u5143)"),l.qZA(),l.YNc(68,Ut,16,14,"ng-container",20),l._UZ(69,"div",21),l.TgZ(70,"div",22),l._uU(71,"\u5408\u8ba1\uff08\u542b\u7a0e\uff0c\u7a0e\u70b913\uff09\uff1a"),l.qZA(),l.TgZ(72,"div",23),l._uU(73),l.ALo(74,"number"),l.qZA(),l.TgZ(75,"div",24),l._uU(76),l.ALo(77,"number"),l.qZA(),l.TgZ(78,"div",25),l._uU(79),l.ALo(80,"number"),l.qZA(),l.TgZ(81,"div",26),l._uU(82,"\u6253\u5370\u65e5\u671f\uff1a"),l.qZA(),l.TgZ(83,"div",27),l.TgZ(84,"span"),l._uU(85),l.ALo(86,"date"),l.qZA(),l.TgZ(87,"span",28),l._uU(88,"\u7ed3\u7b97\u4eba\u5458\uff1a"),l.qZA(),l.qZA(),l.TgZ(89,"div",29),l._uU(90),l.qZA(),l.TgZ(91,"div",30),l._uU(92,"\u8d1f\u8d23\u4eba\uff1a"),l.qZA(),l._UZ(93,"div",31),l.qZA()),2&t&&(l.Q6J("formGroup",e.paddingForm),l.xp6(25),l.Q6J("ngStyle",l.VKq(27,Ct,e.padding)),l.xp6(8),l.Oqu(e.data.vsws.weighing.customerName),l.xp6(5),l.Oqu(l.xi3(39,12,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"yMMddHHmm")),l.xp6(5),l.Oqu(e.data.vsws.weighing.customerName),l.xp6(5),l.Oqu(e.data.vsws.weighing.truckPlateNo),l.xp6(20),l.Q6J("ngForOf",e.materialsArr),l.xp6(5),l.Oqu(l.xi3(74,15,e.getTotalWeightTon(e.data.vsws.survey.materials),"1.2-2")),l.xp6(3),l.Oqu(l.xi3(77,18,e.getAveragePrice(e.data.vsws.survey.materials),"1.2-2")),l.xp6(3),l.Oqu(l.xi3(80,21,e.getTotalAmount(e.data.vsws.survey.materials),"1.2-2")),l.xp6(6),l.Oqu(l.xi3(86,24,e.todayDate,"y-MM-dd HH:mm")),l.xp6(5),l.Oqu(e.userName))},directives:[wt._Y,wt.JL,wt.sg,At.KE,At.hX,wt.wV,yt.Nt,wt.Fj,wt.JJ,wt.u,Tt.lW,_t.Hw,qt.PC,qt.sg],pipes:[qt.uU,qt.JJ],styles:['.t3[_ngcontent-%COMP%]{display:grid;grid-template-areas:"h1 h1 h1 h1 h1" "h2 h2 h2 h2 h2" "m11 m12 m13 m14 m15" "m11 m12 m13 m14 m15" "m11 m12 m13 m14 m15" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "C1 C2 C3 C4 C5" "F1 F2 F3 F4 F5";grid-template-columns:2fr 7fr 3fr 3fr 3fr}.item.number[_ngcontent-%COMP%]{padding-right:1em}.footer1[_ngcontent-%COMP%], .item.number[_ngcontent-%COMP%], .meta11[_ngcontent-%COMP%], .meta14[_ngcontent-%COMP%]{text-align:right}.footer22[_ngcontent-%COMP%]{float:right}.footer4[_ngcontent-%COMP%]{text-align:right}.title[_ngcontent-%COMP%]{font-style:italic}.content[_ngcontent-%COMP%]{font-size:1.1em}.meta1[_ngcontent-%COMP%]{grid-area:m1}.meta2[_ngcontent-%COMP%]{grid-area:m2}.meta3[_ngcontent-%COMP%]{grid-area:m3}.netweightbc[_ngcontent-%COMP%]{grid-area:nwbc}.item[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;text-align:center}.lastrow[_ngcontent-%COMP%]{border-bottom:1px solid #000}.lastcolumn[_ngcontent-%COMP%]{border-right:1px solid #000}.header[_ngcontent-%COMP%]{grid-area:h1;font-size:1.3em}.header[_ngcontent-%COMP%], .header2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.3em}.header2[_ngcontent-%COMP%]{grid-area:h2;font-size:1.5em}.meta[_ngcontent-%COMP%]{margin-bottom:.3em}.meta3[_ngcontent-%COMP%], .text-right[_ngcontent-%COMP%]{text-align:right}']}),t})();const xt=function(t){return{padding:t}};let Nt=(()=>{class t{constructor(t,e,i,n){this.fb=t,this.data=e,this.utils=i,this.dialogRef=n;const s=localStorage.getItem("paddingCache")?JSON.parse(localStorage.getItem("paddingCache")):{top:0,bottom:0,left:0,right:0};this.paddingForm=this.fb.group(s)}ngOnInit(){console.log(this.data)}ngOnDestroy(){this.paddingForm.dirty&&(console.log("changed"),localStorage.setItem("paddingCache",JSON.stringify(this.paddingForm.getRawValue())))}closeDialog(){this.dialogRef.close()}onBtnPrintClick(){window.print()}get padding(){const t=this.paddingForm.getRawValue();return`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(wt.qu),l.Y36(r.WI),l.Y36(bt),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-print"]],decls:83,vars:28,consts:[[1,"noprint",3,"formGroup"],[2,"width","5em"],["type","number","matInput","","formControlName","top"],["type","number","matInput","","formControlName","left"],["type","number","matInput","","formControlName","right"],["mat-button","",3,"click"],["mat-button","",2,"float","right",3,"click"],["id","dataToPrint",1,"t3",3,"ngStyle"],[1,"header"],[1,"meta","meta1"],[1,"meta","meta2"],[1,"meta","meta3"],[1,"item","title"],[1,"item","content"],[1,"item","lastcolumn","content"],[1,"item","lastrow","title","netweightat"],[1,"item","lastrow","content","netweightac"],[1,"item","lastrow","title","netweightbt"],[1,"item","lastrow","lastcolumn","content","netweightbc"]],template:function(t,e){1&t&&(l.TgZ(0,"form",0),l.TgZ(1,"mat-form-field",1),l.TgZ(2,"mat-label"),l._uU(3," \u4e0a\u90e8\u7f29\u8fdb "),l.qZA(),l._UZ(4,"input",2),l.qZA(),l.TgZ(5,"span"),l._uU(6,"\xa0"),l.qZA(),l.TgZ(7,"mat-form-field",1),l.TgZ(8,"mat-label"),l._uU(9," \u5de6\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(10,"input",3),l.qZA(),l.TgZ(11,"span"),l._uU(12,"\xa0"),l.qZA(),l.TgZ(13,"mat-form-field",1),l.TgZ(14,"mat-label"),l._uU(15," \u53f3\u4fa7\u7f29\u8fdb "),l.qZA(),l._UZ(16,"input",4),l.qZA(),l.TgZ(17,"span"),l._uU(18,"\xa0"),l.qZA(),l.TgZ(19,"button",5),l.NdJ("click",function(){return e.onBtnPrintClick()}),l.TgZ(20,"mat-icon"),l._uU(21,"print"),l.qZA(),l.qZA(),l.TgZ(22,"button",6),l.NdJ("click",function(){return e.closeDialog()}),l.TgZ(23,"mat-icon"),l._uU(24,"close"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(25,"div",7),l.TgZ(26,"div",8),l._uU(27,"\u8fbd\u5b81\u9686\u8fd0\u73af\u4fdd\u79d1\u6280\u80a1\u4efd\u6709\u9650\u516c\u53f8 - \u8fc7\u78c5\u5355"),l.qZA(),l.TgZ(28,"div",9),l._uU(29),l.ALo(30,"date"),l.qZA(),l._UZ(31,"div",10),l.TgZ(32,"div",11),l._uU(33,"\u5355\u4f4d\uff1a\u516c\u65a4"),l.qZA(),l.TgZ(34,"div",12),l._uU(35,"\u8f66\u53f7"),l.qZA(),l.TgZ(36,"div",13),l._uU(37),l.qZA(),l.TgZ(38,"div",12),l._uU(39,"\u7269\u8d44"),l.qZA(),l.TgZ(40,"div",13),l._uU(41,"\u8f66\u8f86\u5e9f\u94a2"),l.qZA(),l.TgZ(42,"div",12),l._uU(43,"\u5ba2\u6237"),l.qZA(),l.TgZ(44,"div",14),l._uU(45),l.qZA(),l.TgZ(46,"div",12),l._uU(47,"\u6bdb\u91cd"),l.qZA(),l.TgZ(48,"div",13),l._uU(49),l.ALo(50,"number"),l.qZA(),l.TgZ(51,"div",12),l._uU(52,"\u53f8\u78c5\u5458"),l.qZA(),l.TgZ(53,"div",13),l._uU(54,"\u8d85\u7ea7\u6743\u9650"),l.qZA(),l.TgZ(55,"div",12),l._uU(56,"\u65e5\u671f"),l.qZA(),l.TgZ(57,"div",14),l._uU(58),l.ALo(59,"date"),l.qZA(),l.TgZ(60,"div",12),l._uU(61,"\u76ae\u91cd"),l.qZA(),l.TgZ(62,"div",13),l._uU(63),l.ALo(64,"number"),l.qZA(),l.TgZ(65,"div",12),l._uU(66,"\u53f8\u78c5\u5458"),l.qZA(),l.TgZ(67,"div",13),l._uU(68,"\u8d85\u7ea7\u6743\u9650"),l.qZA(),l.TgZ(69,"div",12),l._uU(70,"\u65e5\u671f"),l.qZA(),l.TgZ(71,"div",14),l._uU(72),l.ALo(73,"date"),l.qZA(),l.TgZ(74,"div",15),l._uU(75,"\u51c0\u91cd"),l.qZA(),l.TgZ(76,"div",16),l._uU(77),l.ALo(78,"number"),l.qZA(),l.TgZ(79,"div",17),l._uU(80,"\u51c0\u91cd\u5927\u5199"),l.qZA(),l.TgZ(81,"div",18),l._uU(82),l.qZA(),l.qZA()),2&t&&(l.Q6J("formGroup",e.paddingForm),l.xp6(25),l.Q6J("ngStyle",l.VKq(26,xt,e.padding)),l.xp6(4),l.hij("\u5e8f\u53f7\uff1a",l.xi3(30,11,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"yMMddHHmm"),""),l.xp6(8),l.Oqu(e.data.vsws.weighing.truckPlateNo),l.xp6(8),l.Oqu(e.data.vsws.weighing.customerName),l.xp6(4),l.Oqu(l.lcZ(50,14,e.data.vsws.weighing.inWeightKG)),l.xp6(9),l.Oqu(l.xi3(59,16,null==e.data.vsws.weighing?null:e.data.vsws.weighing.inWeighedAt,"y-MM-dd HH:mm")),l.xp6(5),l.Oqu(l.lcZ(64,19,e.data.vsws.weighing.outWeightKG)),l.xp6(9),l.Oqu(l.xi3(73,21,null==e.data.vsws.weighing?null:e.data.vsws.weighing.outWeighedAt,"y-MM-dd HH:mm")),l.xp6(5),l.Oqu(l.lcZ(78,24,e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)),l.xp6(5),l.hij(" ",e.utils.toChineseNumber(e.data.vsws.weighing.inWeightKG-e.data.vsws.weighing.outWeightKG)," "))},directives:[wt._Y,wt.JL,wt.sg,At.KE,At.hX,wt.wV,yt.Nt,wt.Fj,wt.JJ,wt.u,Tt.lW,_t.Hw,qt.PC],pipes:[qt.uU,qt.JJ],styles:['.t3[_ngcontent-%COMP%]{display:grid;grid-template-areas:"h1 h1 h1 h1 h1 h1" "m1 m1 m2 m2 m2 m3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "T1 C1 T2 C2 T3 C3" "nwat nwac nwbt nwbc nwbc nwbc";grid-template-columns:1.5fr 3.5fr 2fr 3.5fr 2fr 7.5fr}.header[_ngcontent-%COMP%]{grid-area:h1}.title[_ngcontent-%COMP%]{font-style:italic}.content[_ngcontent-%COMP%]{font-size:1.1em}.meta1[_ngcontent-%COMP%]{grid-area:m1}.meta2[_ngcontent-%COMP%]{grid-area:m2}.meta3[_ngcontent-%COMP%]{grid-area:m3}.netweightbc[_ngcontent-%COMP%]{grid-area:nwbc}.item[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;text-align:center}.lastrow[_ngcontent-%COMP%]{border-bottom:1px solid #000}.lastcolumn[_ngcontent-%COMP%]{border-right:1px solid #000}.header[_ngcontent-%COMP%]{font-size:1.5em;text-align:center}.header[_ngcontent-%COMP%], .meta[_ngcontent-%COMP%]{margin-bottom:.3em}.meta3[_ngcontent-%COMP%]{text-align:right}']}),t})();var Pt=i(7727),It=i(2797);function Wt(t,e){1&t&&(l.ynx(0),l.TgZ(1,"button",3),l._uU(2,"\u662f"),l.qZA(),l.TgZ(3,"button",4),l._uU(4," \u5426 "),l.qZA(),l.BQk()),2&t&&(l.xp6(1),l.Q6J("mat-dialog-close",!0),l.xp6(2),l.Q6J("mat-dialog-close",!1))}function Dt(t,e){1&t&&(l.ynx(0),l.TgZ(1,"button",3),l._uU(2,"\u786e\u5b9a"),l.qZA(),l.BQk()),2&t&&(l.xp6(1),l.Q6J("mat-dialog-close",!0))}let kt=(()=>{class t{constructor(t,e){this.data=t,this.dialogRef=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-alert"]],decls:9,vars:4,consts:[["mat-dialog-title",""],["align","end"],[4,"ngIf"],["mat-button","","color","primary",3,"mat-dialog-close"],["mat-raised-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"mat-dialog-content"),l.TgZ(3,"mat-card"),l.TgZ(4,"mat-card-content"),l._uU(5),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"mat-dialog-actions",1),l.YNc(7,Wt,5,2,"ng-container",2),l.YNc(8,Dt,3,1,"ng-container",2),l.qZA()),2&t&&(l.xp6(1),l.Oqu(e.data.alert.title),l.xp6(4),l.hij(" ",e.data.alert.message," "),l.xp6(2),l.Q6J("ngIf",!e.data.alert.okOnly),l.xp6(1),l.Q6J("ngIf",e.data.alert.okOnly))},directives:[r.uh,r.xY,It.a8,It.dn,r.H8,qt.O5,Tt.lW,r.ZT],styles:[""]}),t})(),Jt=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return this.dialog.open(kt,{disableClose:!0,data:{alert:t}})}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),St=(()=>{class t{constructor(t,e,i,n,s,a){this.fb=t,this.data=e,this.dialogRef=i,this.utils=n,this.backend=s,this.alert=a,this.status$=(0,v.of)(),this.status={changed:!1},this.dialogTitle=this.data.customer._id?"\u7f16\u8f91\u5ba2\u6237":"\u65b0\u5efa\u5ba2\u6237",this.formX=this.fb.group({_id:[this.data.customer._id],name:[{value:this.data.customer.name,disabled:!!this.data.customer._id},wt.kI.required],mobile:[this.data.customer.mobile,[wt.kI.required,wt.kI.pattern(/^[0-9]*$/)]],notes:[this.data.customer.notes]})}ngOnInit(){this.status$=this.formX.valueChanges.pipe((0,w.b)(t=>{this.status.changed=!this.utils.compareObjects(this.formX.getRawValue(),this.data.customer,["name","mobile","notes"]),console.log("status",this.status)}))}onSubmit(){console.log("at onSubmit");const t=this.formX.getRawValue(),e=this.data.customer;this.backend.dataCustomers.save({newCustomer:t,oldCustomer:e}).pipe((0,b.P)(),(0,Pt.K)(t=>(0,v.of)(t))).subscribe(i=>{console.log(i),i.collection_upsert||i._id?this.dialogRef.close(e._id?t:i):(console.log("got error"),console.log(i))})}onCancel(){console.log("at onCancel"),this.status.changed?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(wt.qu),l.Y36(r.WI),l.Y36(r.so),l.Y36(bt),l.Y36(nt),l.Y36(Jt))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-customer-dialog"]],decls:31,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],["matInput","","formControlName","name"],["matInput","","formControlName","mobile"],["matInput","","formControlName","notes"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],["type","text",2,"display","none",3,"value"]],template:function(t,e){1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"form",1),l.TgZ(3,"mat-dialog-content"),l.TgZ(4,"mat-card"),l.TgZ(5,"mat-card-content"),l.TgZ(6,"mat-form-field"),l.TgZ(7,"mat-label"),l._uU(8," \u5ba2\u6237\u540d\u79f0 "),l.qZA(),l._UZ(9,"input",2),l.qZA(),l.TgZ(10,"span"),l._uU(11,"\xa0"),l.qZA(),l.TgZ(12,"mat-form-field"),l.TgZ(13,"mat-label"),l._uU(14," \u5ba2\u6237\u624b\u673a "),l.qZA(),l._UZ(15,"input",3),l.qZA(),l._UZ(16,"br"),l.TgZ(17,"mat-form-field"),l.TgZ(18,"mat-label"),l._uU(19," \u5907\u6ce8 "),l.qZA(),l._UZ(20,"textarea",4),l.qZA(),l.TgZ(21,"span"),l._uU(22,"\xa0"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(23,"mat-dialog-actions",5),l.TgZ(24,"button",6),l.NdJ("click",function(){return e.onCancel()}),l._uU(25,"\u53d6\u6d88"),l.qZA(),l.TgZ(26,"button",7),l.NdJ("click",function(){return e.onSubmit()}),l._uU(27," \u4fdd\u5b58 "),l.qZA(),l.qZA(),l.qZA(),l._UZ(28,"input",8),l.ALo(29,"json"),l.ALo(30,"async")),2&t&&(l.xp6(1),l.Oqu(e.dialogTitle),l.xp6(1),l.Q6J("formGroup",e.formX),l.xp6(24),l.Q6J("disabled",e.formX.invalid||!e.status.changed),l.xp6(2),l.Q6J("value",l.lcZ(29,4,l.lcZ(30,6,e.status$))))},directives:[r.uh,wt._Y,wt.JL,wt.sg,r.xY,It.a8,It.dn,At.KE,At.hX,yt.Nt,wt.Fj,wt.JJ,wt.u,r.H8,Tt.lW],pipes:[qt.Ts,qt.Ov],styles:[""]}),t})(),Rt=(()=>{class t{constructor(t){this.dialog=t}openDialog(t){return console.log("opening cutomerDialog with data:"),console.log(t),this.dialog.open(St,{disableClose:!0,data:{customer:t}})}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac}),t})();var jt=i(9961),Ft=i(7064),Et=i(3841);const Bt=["formRows"];function Lt(t,e){if(1&t&&(l.TgZ(0,"mat-option",34),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(1),l.hij(" ",t," ")}}function Mt(t,e){if(1&t&&(l.TgZ(0,"mat-option",34),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t.name),l.xp6(1),l.hij(" ",t.name," ")}}function Gt(t,e){if(1&t&&(l.ynx(0),l._UZ(1,"input",35),l.TgZ(2,"mat-autocomplete",null,36),l.YNc(4,Mt,2,2,"mat-option",6),l.ALo(5,"async"),l.qZA(),l.BQk()),2&t){const t=l.MAs(3),e=l.oxw();l.xp6(1),l.Q6J("matAutocompleteDisabled",!!e.data.vsws.weighing.customerId)("matAutocomplete",t),l.xp6(3),l.Q6J("ngForOf",l.lcZ(5,3,e.possibleCustomers$))}}function Yt(t,e){1&t&&(l.ynx(0),l._UZ(1,"input",37),l.BQk())}function Qt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",38),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.openCustomerDialog(e.customer)}),l._uU(1,"\u65b0\u5efa\u5ba2\u6237"),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",t.loadingPossibleCustomers)}}function Kt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",25),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.openCustomerDialog(e.customer)}),l._uU(1,"\u7f16\u8f91\u5ba2\u6237"),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",t.disableEditCustomerButton)}}function $t(t,e){if(1&t&&(l.TgZ(0,"button",39),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij(" ",null!=t.vswsForm.errors&&t.vswsForm.errors.weightError?"\u76ae\u91cd\u4e0d\u80fd\u5927\u4e8e\u6bdb\u91cd":""," ")}}function Ht(t,e){1&t&&(l.TgZ(0,"button",39),l._uU(1," \u6ce8\u610f\uff1a\u7269\u8d44\u603b\u91cd\u5df2\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd "),l.qZA())}function Vt(t,e){if(1&t&&(l.TgZ(0,"button",23),l._uU(1),l.ALo(2,"number"),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij("\u3010",l.xi3(2,1,t.status.materialTotalWeight,"1.0-0"),"\u516c\u65a4\u3011")}}function Xt(t,e){if(1&t&&(l.TgZ(0,"button",39),l._uU(1),l.ALo(2,"number"),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.hij("\u3010",l.xi3(2,1,t.status.materialTotalWeight,"1.0-0"),"\u516c\u65a4\u3011")}}function zt(t,e){1&t&&(l.TgZ(0,"button",23),l._uU(1," \u6dfb\u52a0\u7269\u8d44\u524d\uff0c\u8bf7\u5f55\u5165\u6709\u6548\u8fc7\u78c5\u6570\u636e "),l.qZA())}function te(t,e){1&t&&(l.TgZ(0,"button",39),l._uU(1," \u7269\u8d44\u603b\u91cd\u4e0d\u80fd\u5927\u4e8e\u8fc7\u78c5\u51c0\u91cd "),l.qZA())}function ee(t,e){if(1&t&&(l.TgZ(0,"mat-option",34),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t._id),l.xp6(1),l.hij(" ",t.name," ")}}function ie(t,e){if(1&t&&(l.TgZ(0,"mat-form-field",49),l.TgZ(1,"mat-label"),l._uU(2,"\u6570\u91cf"),l.qZA(),l._UZ(3,"input",44),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Q6J("formControl",t.get("count"))}}function ne(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",50),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().index;return l.oxw().removeMaterial(e)}),l._uU(1,"\u5220\u9664"),l.qZA()}}function se(t,e){if(1&t&&(l.TgZ(0,"div",null,40),l.TgZ(2,"mat-card"),l.TgZ(3,"mat-card-content"),l.TgZ(4,"mat-form-field"),l.TgZ(5,"mat-label"),l._uU(6,"\u7269\u8d44\u540d\u79f0"),l.qZA(),l.TgZ(7,"mat-select",41,42),l.YNc(9,ee,2,2,"mat-option",6),l.qZA(),l.TgZ(10,"span",4),l._uU(11),l.qZA(),l.qZA(),l.TgZ(12,"span"),l._uU(13,"\xa0"),l.qZA(),l.TgZ(14,"mat-form-field",43),l.TgZ(15,"mat-label"),l._uU(16,"\u91cd\u91cf"),l.qZA(),l._UZ(17,"input",44),l.TgZ(18,"span",45),l._uU(19,"\u516c\u65a4"),l.qZA(),l.qZA(),l.TgZ(20,"span"),l._uU(21,"\xa0"),l.qZA(),l.TgZ(22,"mat-form-field",43),l.TgZ(23,"mat-label"),l._uU(24,"\u4ef7\u683c"),l.qZA(),l._UZ(25,"input",44),l.TgZ(26,"span",45),l._uU(27,"\u5143/\u516c\u65a4"),l.qZA(),l.qZA(),l.TgZ(28,"span"),l._uU(29,"\xa0"),l.qZA(),l.TgZ(30,"mat-form-field",43),l.TgZ(31,"mat-label"),l._uU(32,"\u91d1\u989d"),l.qZA(),l._UZ(33,"input",19),l.TgZ(34,"span",45),l._uU(35,"\u5143"),l.qZA(),l.qZA(),l.TgZ(36,"span"),l._uU(37,"\xa0"),l.qZA(),l.YNc(38,ie,4,1,"mat-form-field",46),l._UZ(39,"br"),l.TgZ(40,"mat-form-field",21),l.TgZ(41,"mat-label"),l._uU(42," \u5907\u6ce8 "),l.qZA(),l._UZ(43,"textarea",47),l.qZA(),l.TgZ(44,"span"),l._uU(45,"\xa0"),l.qZA(),l.YNc(46,ne,2,0,"button",48),l.qZA(),l.qZA(),l._UZ(47,"br"),l.qZA()),2&t){const t=e.$implicit,i=e.index,n=l.MAs(8),s=l.oxw();let a,o;l.xp6(7),l.Q6J("formControl",t.get("pwId")),l.xp6(2),l.Q6J("ngForOf",s.selectedPws),l.xp6(2),l.hij("",i+1,"\xa0\xa0"),l.xp6(6),l.Q6J("formControl",t.get("weightKG")),l.xp6(8),l.Q6J("formControl",t.get("price")),l.xp6(8),l.Q6J("value",t.get("weightKG").value*t.get("price").value),l.xp6(5),l.Q6J("ngIf",n.selected&&(null==(a=n.selected)?null:a.viewValue.indexOf("\u53d1\u52a8\u673a"))>-1),l.xp6(5),l.Q6J("formControl",t.get("notes")),l.xp6(3),l.Q6J("ngIf",!(null!=(o=t.get("inventoryId"))&&o.value))}}let ae=(()=>{class t{constructor(t,e,i,n,s,a,o,r,l){var u;this.data=t,this.fb=e,this.backend=i,this.customerDialog=n,this.auth=s,this.alert=a,this.calculatePatches=o,this.dialog=r,this.dialogRef=l,this.truckPlateNoOptions=["\u8fbdN"],this.subscriptions_=[],this.possibleCustomers$=(0,v.of)([]),this.loadingPossibleCustomers=!1,this.disableEditCustomerButton=!0,this.customer={name:""},this.selectedPws=[],this.status={showNewCustomerButton:!1,observables:{valueChanges:(0,v.of)(null)},netWeightKG:0,materialTotalWeight:0,materialTotalCost:0,lastValue:{outWeightKG:0}},this.objectTemplate={_id:!0,isDeleted:!0,deletedAt:!0,weighing:{truckPlateNo:!0,customerId:!0,inWeightKG:!0,inWeighedAt:!0,inWeighedBy:!0,outWeightKG:!0,outWeighedAt:!0,outWeighedBy:!0,notes:!0},survey:{surveyedBy:!0,surveyedAt:!0,materials:!0}},this.totalMaterialWeightGreaterThanWeighingNetweight=!1;const c=this.auth.getCurrentUser();this.selectedPws=this.data.pws.filter(t=>t.name.indexOf("\u5e9f\u94a2")>-1&&t.name.indexOf("\u516c\u65a4")>-1),console.log(this.selectedPws),console.log(this.data.vsws),this.status.lastValue.outWeightKG=this.data.vsws.weighing.outWeightKG,this.status.netWeightKG=this.data.vsws.weighing.outWeightKG&&this.data.vsws.weighing.inWeightKG?this.data.vsws.weighing.outWeightKG-this.data.vsws.weighing.inWeightKG:0,this.data.vsws.survey.materials&&this.data.vsws.survey.materials.length?(console.log(this.data.vsws.survey.materials),this.materialsFormArray=this.fb.array(null===(u=this.data.vsws.survey.materials)||void 0===u?void 0:u.map(t=>this.fb.group({pwId:[{value:t.pwId,disabled:!0}],weightKG:t.weightKG,count:t.count,price:t.price,notes:t.notes,inventoryId:t.inventoryId})))):this.materialsFormArray=this.fb.array([]),this.vswsForm=this.fb.group({_id:this.data.vsws._id,isDeleted:this.data.vsws.isDeleted,deletedAt:this.data.vsws.deletedAt,deletedBy:this.data.vsws.deletedBy,deletedNotes:this.data.vsws.deletedNotes,weighing:this.fb.group({truckPlateNo:[{value:this.data.vsws.weighing.truckPlateNo,disabled:!!this.data.vsws.weighing.truckPlateNo},[wt.kI.required,wt.kI.minLength(7)]],customerId:this.data.vsws.weighing.customerId,customerName:[{value:this.data.vsws.weighing.customerName,disabled:!!this.data.vsws.weighing.customerName}],customerTel:[{value:this.data.vsws.weighing.customerTel,disabled:!0}],inWeightKG:[{value:this.data.vsws.weighing.inWeightKG,disabled:!1}],inWeighedDate:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toLocaleDateString().split("/").map(t=>t.padStart(2,"0")).join("-"):"",inWeighedTime:this.data.vsws.weighing.inWeighedAt?new Date(this.data.vsws.weighing.inWeighedAt).toTimeString().substring(0,5):"",inWeighedBy:this.data.vsws.weighing.inWeighedBy?this.data.vsws.weighing.inWeighedBy:null==c?void 0:c._id,inWeighedByName:[{value:this.data.vsws.weighing.inWeighedByName?this.data.vsws.weighing.inWeighedByName:null==c?void 0:c.displayName,disabled:!0}],outWeightKG:[{value:this.data.vsws.weighing.outWeightKG,disabled:!1}],outWeighedDate:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toISOString().substring(0,10):"",outWeighedTime:this.data.vsws.weighing.outWeighedAt?new Date(this.data.vsws.weighing.outWeighedAt).toTimeString().substring(0,5):"",outWeighedBy:this.data.vsws.weighing.outWeighedBy,outWeighedByName:[{value:this.data.vsws.weighing.outWeighedByName,disabled:!0}],notes:this.data.vsws.weighing.notes}),survey:this.fb.group({surveyedBy:this.data.vsws.survey.surveyedBy,surveyedByName:[{value:this.data.vsws.survey.surveyedByName,disabled:!0}],surveyedDate:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toISOString().substring(0,10):"",disabled:!!this.data.vsws.survey.surveyedAt}],surveyedTime:[{value:this.data.vsws.survey.surveyedAt?new Date(this.data.vsws.survey.surveyedAt).toTimeString().substring(0,5):"",disabled:!!this.data.vsws.survey.surveyedAt}],materials:this.materialsFormArray})}),this.dialogTitle=this.data.vsws._id?"\u7f16\u8f91\u8fdb\u573a\u7269\u8d44":"\u65b0\u5efa\u8fdb\u573a\u7269\u8d44"}ngOnDestroy(){var t;null===(t=this.sub0_)||void 0===t||t.unsubscribe()}ngOnInit(){var t,e;this.status.observables.valueChanges=this.vswsForm.valueChanges.pipe((0,ot.O)(this.vswsForm.getRawValue()),(0,w.b)(t=>{const e=t.survey.materials;console.log({value:t}),e.forEach((t,e)=>{}),setTimeout(()=>{var i,n;this.status.materialTotalCost=e.reduce((t,e)=>t+e.price*e.weightKG,0),this.status.materialTotalWeight=e.reduce((t,e)=>t+1*e.weightKG,0);const s=t.weighing.inWeightKG,a=t.weighing.outWeightKG;if(!this.status.lastValue.outWeightKG&&a){const t=new Date;this.vswsForm.patchValue({weighing:{outWeighedDate:t.toISOString().substring(0,10),outWeighedTime:t.toTimeString().substring(0,5),outWeighedBy:null===(i=this.auth.getCurrentUser())||void 0===i?void 0:i._id,outWeighedByName:null===(n=this.auth.getCurrentUser())||void 0===n?void 0:n.displayName}},{emitEvent:!1}),this.status.lastValue.outWeightKG=a}this.status.netWeightKG=s&&a?s-a:0,this.status.netWeightKG<0&&this.vswsForm.setErrors({weightError:!0}),this.totalMaterialWeightGreaterThanWeighingNetweight=this.status.materialTotalWeight>this.status.netWeightKG},0)})),this.sub0_=this.status.observables.valueChanges.subscribe(),this.possibleCustomers$=null===(t=this.vswsForm.get("weighing.customerName"))||void 0===t?void 0:t.valueChanges.pipe((0,ot.O)(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.value),(0,Z.w)(t=>(this.loadingPossibleCustomers=!0,t?this.backend.dataCustomers.search({name:{$regex:`.*${t}.*`}}).pipe((0,g.U)(e=>({customerNameX:t,possibleCustomers:e}))):(0,v.of)([]).pipe((0,g.U)(e=>({customerNameX:t,possibleCustomers:e}))))),(0,w.b)(t=>{var e,i,n,s,a;console.log(t);const o=t.possibleCustomers.find(e=>e.name===t.customerNameX);this.status.showNewCustomerButton=!(!(null===(e=this.vswsForm.get("weighing.customerName"))||void 0===e?void 0:e.dirty)||t.customerNameX&&(!t.customerNameX||o)),this.disableEditCustomerButton=!t.customerNameX,o?(this.customer=o,this.vswsForm.patchValue({weighing:{customerTel:null==o?void 0:o.mobile,customerId:null==o?void 0:o._id}},{emitEvent:!1})):(null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i?void 0:i.value)&&(null===(n=this.vswsForm.get("weighing.customerName"))||void 0===n||n.setErrors({notFound:!0}),this.customer={name:t.customerNameX,mobile:""},null===(s=this.vswsForm.get("weighing.customerTel"))||void 0===s||s.setValue(""),null===(a=this.vswsForm.get("weighing.customerId"))||void 0===a||a.setValue("")),this.loadingPossibleCustomers=!1}),(0,g.U)(t=>t.possibleCustomers))}getMaterialControl(t,e){return this.materialsFormArray.at(t).get(e)}addMaterial(){var t,e;if(!this.materialsFormArray.controls.length){const i=new Date;this.vswsForm.patchValue({survey:{surveyedBy:null===(t=this.auth.getCurrentUser())||void 0===t?void 0:t._id,surveyedByName:null===(e=this.auth.getCurrentUser())||void 0===e?void 0:e.displayName,surveyedDate:i.toISOString().substring(0,10),surveyedTime:i.toTimeString().substring(0,5)}})}if(this.materialsFormArray.controls.length<5){const t=this.fb.group({pwId:["",wt.kI.required],weightKG:[0,wt.kI.min(.1)],count:[{value:0,disabled:!0}],price:0,notes:""});this.materialsFormArray.push(t),setTimeout(()=>{var t,e;null===(t=this.materialRows)||void 0===t||t.last.nativeElement.scrollIntoView(),null===(e=this.materialRows)||void 0===e||e.last.nativeElement.querySelector("mat-select").click()},0)}else this.alert.openDialog({title:"\u51fa\u9519\u4e86",message:"\u5355\u8f66\u6700\u591a5\u79cd\u7269\u8d44",okOnly:!0})}removeMaterial(t){this.materialsFormArray.removeAt(t),this.materialsFormArray.controls.length||this.vswsForm.patchValue({survey:{surveyedBy:"",surveyedByName:"",surveyedDate:"",surveyedTime:""}})}openCustomerDialog(t){this.customerDialog.openDialog(t).afterClosed().subscribe(t=>{var e,i,n;t&&t._id&&(null===(e=this.vswsForm.get("weighing.customerId"))||void 0===e||e.setValue(t._id),null===(i=this.vswsForm.get("weighing.customerName"))||void 0===i||i.setValue(t.name),null===(n=this.vswsForm.get("weighing.customerTel"))||void 0===n||n.setValue(t.mobiel))})}preparePatches(){const t=this.vswsForm.getRawValue(),e=this.data.vsws;return t.weighing.inWeighedDate&&t.weighing.inWeighedTime&&(t.weighing.inWeighedAt=new Date(t.weighing.inWeighedDate+" "+t.weighing.inWeighedTime).toISOString()),t.weighing.outWeighedDate&&t.weighing.outWeighedTime&&(t.weighing.outWeighedAt=new Date(t.weighing.outWeighedDate+" "+t.weighing.outWeighedTime).toISOString()),t.survey.surveyedDate&&t.survey.surveyedTime&&(t.survey.surveyedAt=new Date(t.survey.surveyedDate+" "+t.survey.surveyedTime).toISOString()),{oldObject:e,newObject:t,vswsPatches:this.calculatePatches.calculatePatches({oldObject:e,newObject:t,objectTemplate:this.objectTemplate})}}onCancel(){const t=this.preparePatches().vswsPatches;console.log({patches:t}),t.length?this.alert.openDialog({title:"\u5185\u5bb9\u5df2\u53d8\u66f4",message:"\u662f\u5426\u653e\u5f03\u66f4\u6539\uff1f"}).afterClosed().pipe((0,b.P)()).subscribe(t=>{t&&this.dialogRef.close()}):(console.log("no change"),this.dialogRef.close())}onSubmit2(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();console.log({newObject:t,oldObject:e,vswsPatches:i})}onSubmit(){const{newObject:t,oldObject:e,vswsPatches:i}=this.preparePatches();if(console.log({newObject:t,oldObject:e,vswsPatches:i}),e._id)if(console.log(i),i.length){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.update({_id:e._id,vswsPatches:i}).pipe((0,b.P)()).subscribe(e=>{console.log({vswsPatchResult:e}),t.close(),this.dialogRef.close(),this.data.changesSaved$$.next()})}else this.alert.openDialog({title:"\u65e0\u53d8\u52a8",message:"\u5185\u5bb9\u6ca1\u6709\u4efb\u4f55\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58",okOnly:!0});else{const e=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u4fdd\u5b58..."}});this.backend.dataVS.insert(this.calculatePatches.trimObject(t,this.objectTemplate)).pipe((0,b.P)()).subscribe(t=>{console.log({res:t}),e.close(),this.data.changesSaved$$.next(),this.dialogRef.close()})}}objectKeys(t){console.log({obj:t})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.WI),l.Y36(wt.qu),l.Y36(nt),l.Y36(Rt),l.Y36(Zt.e),l.Y36(Jt),l.Y36(it),l.Y36(r.uw),l.Y36(r.so))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-dialog"]],viewQuery:function(t,e){if(1&t&&l.Gf(Bt,5),2&t){let t;l.iGM(t=l.CRH())&&(e.materialRows=t)}},decls:155,vars:24,consts:[["mat-dialog-title",""],[3,"formGroup"],["formGroupName","weighing"],["matInput","","formControlName","truckPlateNo",3,"matAutocompleteDisabled","matAutocomplete"],["matPrefix",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","customerTel"],["mat-raised-button","","color","accent",3,"disabled","click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["matInput","","type","number","formControlName","inWeightKG"],["matInput","","type","date","formControlName","inWeighedDate"],["matInput","","type","time","formControlName","inWeighedTime"],["matInput","","formControlName","inWeighedByName"],["matInput","","type","number","formControlName","outWeightKG"],["matInput","","type","date","formControlName","outWeighedDate"],["matInput","","type","time","formControlName","outWeighedTime"],["matInput","","formControlName","outWeighedByName"],["matInput","","type","number","disabled","",3,"value"],["mat-button","","color","warn",4,"ngIf"],[1,"width-fifty"],["matInput","","formControlName","notes"],["mat-button",""],["mat-button","",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],["formGroupName","survey"],["matInput","","formControlName","surveyedByName"],["matInput","","type","date","formControlName","surveyedDate"],["matInput","","type","time","formControlName","surveyedTime"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[3,"value"],["matInput","","formControlName","customerName",3,"matAutocompleteDisabled","matAutocomplete"],["autoCustomerName","matAutocomplete"],["matInput","","formControlName","customerName"],["mat-raised-button","","color","accent",3,"disabled","click"],["mat-button","","color","warn"],["formRows",""],[3,"formControl"],["select","matSelect"],[1,"width-fifteen-vm"],["matInput","","type","number",3,"formControl"],["matSuffix",""],["class","width-ten-vm",4,"ngIf"],["matInput","",3,"formControl"],["mat-button","","color","accent",3,"click",4,"ngIf"],[1,"width-ten-vm"],["mat-button","","color","accent",3,"click"]],template:function(t,e){if(1&t&&(l.TgZ(0,"h2",0),l._uU(1),l.qZA(),l.TgZ(2,"mat-dialog-content"),l.TgZ(3,"form",1),l.TgZ(4,"mat-card"),l.TgZ(5,"mat-card-header"),l.TgZ(6,"mat-card-title"),l.TgZ(7,"small"),l._uU(8,"\u8fc7\u78c5\u4fe1\u606f"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"mat-card-content",2),l.TgZ(10,"span"),l._uU(11,"\xa0"),l.qZA(),l.TgZ(12,"mat-form-field"),l.TgZ(13,"mat-label"),l._uU(14," \u8d27\u8f66\u8f66\u724c\u53f7 "),l.qZA(),l._UZ(15,"input",3),l.TgZ(16,"mat-icon",4),l._uU(17,"local_shipping"),l.qZA(),l.TgZ(18,"mat-autocomplete",null,5),l.YNc(20,Lt,2,2,"mat-option",6),l.qZA(),l.qZA(),l.TgZ(21,"span"),l._uU(22,"\xa0"),l.qZA(),l.TgZ(23,"mat-form-field"),l.TgZ(24,"mat-label"),l._uU(25," \u5ba2\u6237\u540d\u79f0 "),l.qZA(),l.YNc(26,Gt,6,5,"ng-container",7),l.YNc(27,Yt,2,0,"ng-container",7),l.qZA(),l.TgZ(28,"span"),l._uU(29,"\xa0"),l.qZA(),l.TgZ(30,"mat-form-field"),l.TgZ(31,"mat-label"),l._uU(32," \u5ba2\u6237\u7535\u8bdd "),l.qZA(),l._UZ(33,"input",8),l.qZA(),l.TgZ(34,"span"),l._uU(35,"\xa0"),l.qZA(),l.YNc(36,Qt,2,1,"button",9),l.YNc(37,Kt,2,1,"button",10),l._UZ(38,"br"),l.TgZ(39,"mat-form-field"),l.TgZ(40,"mat-label"),l._uU(41,"\u6bdb\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(42,"input",11),l.TgZ(43,"mat-icon",4),l._uU(44,"login"),l.qZA(),l.qZA(),l.TgZ(45,"span"),l._uU(46,"\xa0"),l.qZA(),l.TgZ(47,"mat-form-field"),l.TgZ(48,"mat-label"),l._uU(49,"\u8fdb\u573a\u65e5\u671f"),l.qZA(),l._UZ(50,"input",12),l.qZA(),l.TgZ(51,"span"),l._uU(52,"\xa0"),l.qZA(),l.TgZ(53,"mat-form-field"),l.TgZ(54,"mat-label"),l._uU(55,"\u8fdb\u573a\u65f6\u95f4"),l.qZA(),l._UZ(56,"input",13),l.qZA(),l.TgZ(57,"span"),l._uU(58,"\xa0"),l.qZA(),l.TgZ(59,"mat-form-field"),l.TgZ(60,"mat-label"),l._uU(61,"\u8fdb\u573a\u53f8\u78c5"),l.qZA(),l._UZ(62,"input",14),l.qZA(),l._UZ(63,"br"),l.TgZ(64,"mat-form-field"),l.TgZ(65,"mat-label"),l._uU(66,"\u76ae\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(67,"input",15),l.TgZ(68,"mat-icon",4),l._uU(69,"logout"),l.qZA(),l.qZA(),l.TgZ(70,"span"),l._uU(71,"\xa0"),l.qZA(),l.TgZ(72,"mat-form-field"),l.TgZ(73,"mat-label"),l._uU(74,"\u51fa\u573a\u65e5\u671f"),l.qZA(),l._UZ(75,"input",16),l.qZA(),l.TgZ(76,"span"),l._uU(77,"\xa0"),l.qZA(),l.TgZ(78,"mat-form-field"),l.TgZ(79,"mat-label"),l._uU(80,"\u51fa\u573a\u65f6\u95f4"),l.qZA(),l._UZ(81,"input",17),l.qZA(),l.TgZ(82,"span"),l._uU(83,"\xa0"),l.qZA(),l.TgZ(84,"mat-form-field"),l.TgZ(85,"mat-label"),l._uU(86,"\u51fa\u573a\u53f8\u78c5"),l.qZA(),l._UZ(87,"input",18),l.qZA(),l._UZ(88,"br"),l.TgZ(89,"mat-form-field"),l.TgZ(90,"mat-label"),l._uU(91,"\u51c0\u91cd\uff08\u516c\u65a4\uff09"),l.qZA(),l._UZ(92,"input",19),l.qZA(),l.TgZ(93,"span"),l._uU(94,"\xa0"),l.qZA(),l.YNc(95,$t,2,1,"button",20),l.YNc(96,Ht,2,0,"button",20),l._UZ(97,"br"),l.TgZ(98,"mat-form-field",21),l.TgZ(99,"mat-label"),l._uU(100," \u5907\u6ce8 "),l.qZA(),l._UZ(101,"textarea",22),l.qZA(),l.qZA(),l.qZA(),l._UZ(102,"br"),l.TgZ(103,"mat-card"),l.TgZ(104,"mat-card-header"),l.TgZ(105,"mat-card-title"),l.TgZ(106,"small"),l._uU(107,"\u9a8c\u8d28\u4fe1\u606f"),l.qZA(),l.TgZ(108,"span"),l._uU(109,"\xa0\xa0\xa0"),l.qZA(),l.TgZ(110,"small"),l.TgZ(111,"small"),l.TgZ(112,"button",23),l._uU(113),l.qZA(),l.YNc(114,Vt,3,4,"button",24),l.YNc(115,Xt,3,4,"button",20),l.TgZ(116,"button",23),l._uU(117),l.ALo(118,"number"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(119,"span"),l._uU(120,"\xa0\xa0\xa0"),l.qZA(),l.TgZ(121,"button",25),l.NdJ("click",function(){return e.addMaterial()}),l._uU(122,"\u6dfb\u52a0\u7269\u8d44"),l.qZA(),l.TgZ(123,"span"),l._uU(124,"\xa0\xa0\xa0"),l.qZA(),l.YNc(125,zt,2,0,"button",24),l.YNc(126,te,2,0,"button",20),l.qZA(),l.qZA(),l.TgZ(127,"mat-card-content"),l.YNc(128,se,48,9,"div",26),l.TgZ(129,"div",27),l._UZ(130,"br"),l.TgZ(131,"mat-form-field"),l.TgZ(132,"mat-label"),l._uU(133,"\u9a8c\u8d28\u5458"),l.qZA(),l._UZ(134,"input",28),l.TgZ(135,"mat-icon",4),l._uU(136,"assignment_ind"),l.qZA(),l.qZA(),l.TgZ(137,"span"),l._uU(138,"\xa0"),l.qZA(),l.TgZ(139,"mat-form-field"),l.TgZ(140,"mat-label"),l._uU(141,"\u9a8c\u8d28\u65e5\u671f"),l.qZA(),l._UZ(142,"input",29),l.qZA(),l.TgZ(143,"span"),l._uU(144,"\xa0"),l.qZA(),l.TgZ(145,"mat-form-field"),l.TgZ(146,"mat-label"),l._uU(147,"\u9a8c\u8d28\u65f6\u95f4"),l.qZA(),l._UZ(148,"input",30),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l._UZ(149,"br"),l.qZA(),l.qZA(),l.TgZ(150,"mat-dialog-actions",31),l.TgZ(151,"button",32),l.NdJ("click",function(){return e.onCancel()}),l._uU(152,"\u53d6\u6d88"),l.qZA(),l.TgZ(153,"button",33),l.NdJ("click",function(){return e.onSubmit()}),l._uU(154,"\u4fdd\u5b58"),l.qZA(),l.qZA()),2&t){const t=l.MAs(19);let i;l.xp6(1),l.Oqu(e.dialogTitle),l.xp6(2),l.Q6J("formGroup",e.vswsForm),l.xp6(12),l.Q6J("matAutocompleteDisabled",!(null==(i=e.vswsForm.get("truckPlateNo"))||!i.value))("matAutocomplete",t),l.xp6(5),l.Q6J("ngForOf",e.truckPlateNoOptions),l.xp6(6),l.Q6J("ngIf",!e.data.vsws.weighing.customerId),l.xp6(1),l.Q6J("ngIf",!!e.data.vsws.weighing.customerId),l.xp6(9),l.Q6J("ngIf",e.status.showNewCustomerButton),l.xp6(1),l.Q6J("ngIf",!e.status.showNewCustomerButton),l.xp6(55),l.Q6J("value",e.status.netWeightKG),l.xp6(3),l.Q6J("ngIf",e.vswsForm.errors),l.xp6(1),l.Q6J("ngIf",e.totalMaterialWeightGreaterThanWeighingNetweight),l.xp6(17),l.hij("\u3010",e.materialsFormArray.controls.length,"\u9879\u3011"),l.xp6(1),l.Q6J("ngIf",e.status.materialTotalWeight<=e.status.netWeightKG),l.xp6(1),l.Q6J("ngIf",e.status.materialTotalWeight>e.status.netWeightKG),l.xp6(2),l.hij("\u3010",l.xi3(118,21,e.status.materialTotalCost,"1.2-2"),"\u5143\u3011"),l.xp6(4),l.Q6J("disabled",!e.vswsForm.get("weighing.inWeightKG").value||!e.vswsForm.get("weighing.outWeightKG").value||e.vswsForm.get("weighing.inWeightKG").value-e.vswsForm.get("weighing.outWeightKG").value<=0),l.xp6(4),l.Q6J("ngIf",!e.vswsForm.get("weighing.inWeightKG").value||!e.vswsForm.get("weighing.outWeightKG").value||e.vswsForm.get("weighing.inWeightKG").value-e.vswsForm.get("weighing.outWeightKG").value<=0),l.xp6(1),l.Q6J("ngIf",!1),l.xp6(2),l.Q6J("ngForOf",e.materialsFormArray.controls),l.xp6(25),l.Q6J("disabled",e.vswsForm.invalid)}},directives:[r.uh,r.xY,wt._Y,wt.JL,wt.sg,It.a8,It.dk,It.n5,It.dn,wt.x0,At.KE,At.hX,yt.Nt,wt.Fj,jt.ZL,wt.JJ,wt.u,_t.Hw,At.qo,jt.XC,qt.sg,qt.O5,wt.wV,Tt.lW,r.H8,Ft.ey,Et.gD,wt.oH,At.R9],pipes:[qt.JJ,qt.Ov],styles:[".width-fifty[_ngcontent-%COMP%]{width:50%;min-width:50vw}@media only screen and (min-width:768px){.width-ten-vm[_ngcontent-%COMP%]{max-width:10%}.width-fifteen-vm[_ngcontent-%COMP%]{max-width:15%}}"]}),t})(),oe=(()=>{class t{constructor(t,e,i){this.dialog=t,this.backend=e,this.auth=i,this.changesSaved$$=new rt.xQ}openDialog(t,e){console.log("opening vswsDialog with data:"),console.log(t);const i=t&&"printSurvey"===e?(()=>function(...t){const e=t[t.length-1];return"function"==typeof e&&t.pop(),(0,lt.n)(t,void 0).lift(new dt(e))}(...t.survey.materials.map(t=>t.pwId).map(t=>this.backend.dataPrices.getPrices3({pwId:t,spec:"."}).pipe((0,g.U)(t=>t[0])))))():(0,v.of)(null);return(0,c.D)({vsws:(t=>{if(t){const e=this.dialog.open(u,{disableClose:!0});return(0,c.D)({customer:t.weighing.customerId?this.backend.dataCustomers.search({_id:t.weighing.customerId}).pipe((0,g.U)(t=>t.length?t[0]:null)):(0,v.of)(null),inWeighedBy:t.weighing.inWeighedBy?this.backend.dataUsers.search({_id:t.weighing.inWeighedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),outWeighedBy:t.weighing.outWeighedBy?this.backend.dataUsers.search({_id:t.weighing.outWeighedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null),surveyedBy:t.survey.surveyedBy?this.backend.dataUsers.search({_id:t.survey.surveyedBy}).pipe((0,g.U)(t=>(console.log(t),t.length?t[0]:null))):(0,v.of)(null)}).pipe((0,g.U)(i=>(i.customer&&(t.weighing.customerName=i.customer.name,t.weighing.customerTel=i.customer.mobile),i.inWeighedBy&&(t.weighing.inWeighedByName=i.inWeighedBy.displayName),i.outWeighedBy&&(t.weighing.outWeighedByName=i.outWeighedBy.displayName),i.surveyedBy&&(t.survey.surveyedByName=i.surveyedBy.displayName),e.close(),t)))}{const t=new h;return(0,v.of)(t)}})(t),pws:this.backend.dataPws.getPws(),prices:i}).pipe((0,b.P)(),(0,g.U)(t=>{let i;switch(e){case"printWeighing":i=this.dialog.open(Nt,{disableClose:!1,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",height:"100%",maxWidth:"100%"});break;case"printSurvey":i=this.dialog.open(Ot,{disableClose:!1,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",height:"100%",maxWidth:"100%"});break;default:i=this.dialog.open(ae,{disableClose:!0,data:Object.assign(Object.assign({},t),{changesSaved$$:this.changesSaved$$}),width:"100%",maxWidth:"100%"})}return i}))}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(r.uw),l.LFG(nt),l.LFG(Zt.e))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac}),t})();var re=i(6489),le=i(994),ue=i(9199);function ce(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u8fdb\u573a\u65e5\u671f "),l.qZA())}function ge(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.ALo(2,"date"),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",l.xi3(2,1,null==t.weighing?null:t.weighing.inWeighedAt,"y-MM-dd HH:mm")," ")}}function he(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u8fdb\u573a\u8f66\u724c\u53f7 "),l.qZA())}function de(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",t.weighing.truckPlateNo," ")}}function me(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u51c0\u91cd "),l.qZA())}function pe(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.ALo(2,"number"),l.qZA()),2&t){const t=e.$implicit,i=l.oxw();l.xp6(1),l.hij(" ",l.lcZ(2,1,i.getNetWeight(t))," ")}}function fe(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1,"\u64cd\u4f5c"),l.qZA())}function ve(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"td",11),l.TgZ(1,"button",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().onEdit(e)}),l.TgZ(2,"mat-icon"),l._uU(3,"edit"),l.qZA(),l.qZA(),l.TgZ(4,"span"),l._uU(5,"\xa0"),l.qZA(),l.TgZ(6,"button",13),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().onPrint(e)}),l.TgZ(7,"mat-icon"),l._uU(8,"print"),l.qZA(),l.qZA(),l.TgZ(9,"span"),l._uU(10,"\xa0"),l.qZA(),l.TgZ(11,"button",13),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().onPrintB(e)}),l.TgZ(12,"mat-icon"),l._uU(13,"room_preferences"),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=l.oxw();l.xp6(6),l.Q6J("disabled",i.getNetWeight(t)<=0),l.xp6(5),l.Q6J("disabled",!t.survey.surveyedAt)}}function Ze(t,e){1&t&&(l.TgZ(0,"th",10),l._uU(1," \u5df2\u9a8c\u8d28 "),l.qZA())}function we(t,e){if(1&t&&(l.TgZ(0,"td",11),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.hij(" ",t.survey.surveyedAt?"\u662f":"\u5426"," ")}}function be(t,e){1&t&&l._UZ(0,"tr",14)}function Ae(t,e){1&t&&l._UZ(0,"tr",15)}let ye=(()=>{class t{constructor(t,e){this.dialog=t,this.vswsDialog=e,this.vswsRecentList=[],this.displayedColumns=["_id","truckPlateNo","netWeight","surveyDone","operations"]}ngOnInit(){}onEdit(t){console.log("on edit"),this.vswsDialog.openDialog(t).pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}onPrint(t){console.log("on printWeighing"),this.vswsDialog.openDialog(t,"printWeighing").pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}getNetWeight(t){var e,i,n,s;return 1*(null===(e=t.weighing)||void 0===e?void 0:e.inWeightKG)&&1*(null===(i=t.weighing)||void 0===i?void 0:i.outWeightKG)?(null===(n=t.weighing)||void 0===n?void 0:n.inWeightKG)-(null===(s=t.weighing)||void 0===s?void 0:s.outWeightKG):0}onPrintB(t){console.log("on printSurvey"),this.vswsDialog.openDialog(t,"printSurvey").pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.uw),l.Y36(oe))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey-recent"]],inputs:{vswsRecentList:"vswsRecentList"},decls:18,vars:3,consts:[["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","_id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","truckPlateNo"],["matColumnDef","netWeight"],["matColumnDef","operations"],["matColumnDef","surveyDone"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(l.TgZ(0,"table",0),l.ynx(1,1),l.YNc(2,ce,2,0,"th",2),l.YNc(3,ge,3,4,"td",3),l.BQk(),l.ynx(4,4),l.YNc(5,he,2,0,"th",2),l.YNc(6,de,2,1,"td",3),l.BQk(),l.ynx(7,5),l.YNc(8,me,2,0,"th",2),l.YNc(9,pe,3,3,"td",3),l.BQk(),l.ynx(10,6),l.YNc(11,fe,2,0,"th",2),l.YNc(12,ve,14,2,"td",3),l.BQk(),l.ynx(13,7),l.YNc(14,Ze,2,0,"th",2),l.YNc(15,we,2,1,"td",3),l.BQk(),l.YNc(16,be,1,0,"tr",8),l.YNc(17,Ae,1,0,"tr",9),l.qZA()),2&t&&(l.Q6J("dataSource",e.vswsRecentList),l.xp6(16),l.Q6J("matHeaderRowDef",e.displayedColumns),l.xp6(1),l.Q6J("matRowDefColumns",e.displayedColumns))},directives:[ue.BZ,ue.w1,ue.fO,ue.Dz,ue.as,ue.nj,ue.ge,ue.ev,Tt.lW,_t.Hw,ue.XQ,ue.Gk],pipes:[qt.uU,qt.JJ],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}"]}),t})(),Te=(()=>{class t{constructor(t,e,i){this.backend=t,this.dialog=e,this.vswsDialog=i,this.filterSurveyDone$$=new at.X(!1)}onCreate(){this.vswsDialog.openDialog().pipe((0,Z.w)(t=>t.afterClosed())).subscribe(t=>{console.log({editResult:t})})}ngOnInit(){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u8f7d\u5165\u8fd1\u671f\u5e9f\u94a2\u8fdb\u573a\u8bb0\u5f55..."}});this.vswsRecentList$=this.vswsDialog.changesSaved$$.pipe((0,ot.O)(null),(0,Z.w)(()=>this.backend.dataVS.getRecent()),(0,Z.w)(e=>(e=e.sort((t,e)=>Date.parse(e.createdAt)-Date.parse(t.createdAt)),this.filterSurveyDone$$.pipe((0,g.U)(t=>t?e.filter(t=>0==!!t.survey.surveyedAt):e),(0,w.b)(()=>{t.close()})))))}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(nt),l.Y36(r.uw),l.Y36(oe))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-weighing-survey"]],decls:27,vars:4,consts:[["mat-raised-button","","color","primary",3,"click"],[3,"expanded"],[3,"change"],[3,"vswsRecentList"]],template:function(t,e){1&t&&(l.TgZ(0,"mat-card"),l.TgZ(1,"button",0),l.NdJ("click",function(){return e.onCreate()}),l._uU(2,"\u65b0\u5efa\u8fdb\u573a\u7269\u8d44"),l.qZA(),l.TgZ(3,"div"),l._uU(4,"\xa0"),l.qZA(),l.TgZ(5,"mat-accordion"),l.TgZ(6,"mat-expansion-panel",1),l.TgZ(7,"mat-expansion-panel-header"),l.TgZ(8,"mat-panel-title"),l.TgZ(9,"span"),l._uU(10,"\u8fd1\u671f\u8fdb\u573a\u7269\u8d44"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"mat-checkbox",2),l.NdJ("change",function(t){return e.filterSurveyDone$$.next(t.checked)}),l._uU(12,"\u4ec5\u663e\u793a\u3010\u672a\u9a8c\u8d28\u3011"),l.qZA(),l.TgZ(13,"div"),l.TgZ(14,"span"),l._uU(15,"\xa0"),l.qZA(),l.qZA(),l._UZ(16,"app-vehicle-steel-weighing-survey-recent",3),l.ALo(17,"async"),l.qZA(),l.qZA(),l.TgZ(18,"div"),l._uU(19,"\xa0"),l.qZA(),l.TgZ(20,"mat-accordion"),l.TgZ(21,"mat-expansion-panel"),l.TgZ(22,"mat-expansion-panel-header"),l.TgZ(23,"mat-panel-title"),l._uU(24," \u8fdb\u573a\u7269\u8d44\u6c47\u603b "),l.qZA(),l.qZA(),l.TgZ(25,"p"),l._uU(26,"To Do"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(6),l.Q6J("expanded",!0),l.xp6(10),l.Q6J("vswsRecentList",l.lcZ(17,2,e.vswsRecentList$)))},directives:[It.a8,Tt.lW,re.pp,re.ib,re.yz,re.yK,le.oG,ye],pipes:[qt.Ov],styles:[""]}),t})();var _e=i(3295);function qe(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",3),l.NdJ("click",function(){return l.CHM(t),l.oxw().refresh()}),l.TgZ(1,"mat-icon"),l._uU(2,"refresh"),l.qZA(),l.qZA()}}const Ue=[{path:"",component:(()=>{class t{constructor(t,e){this.dialog=t,this.backend=e}ngOnInit(){}refresh(){const t=this.dialog.open(u,{disableClose:!0,data:{message:"\u6b63\u5728\u66f4\u65b0\u7269\u6599\u540d\u79f0..."}});this.backend.dataPws.refreshPws().subscribe(()=>{t.close()})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(r.uw),l.Y36(nt))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-vehicle-steel-home"]],decls:5,vars:0,consts:[["label","\u7269\u8d44\u8fdb\u573a\u9a8c\u8d28"],["disabled","","label","\u7269\u8d44\u8fdb\u573a\u9a8c\u8d28"],["mat-tab-label",""],["mat-button","","color","primary","matTooltip","\u66f4\u65b0\u7269\u6599\u540d\u79f0",3,"click"]],template:function(t,e){1&t&&(l.TgZ(0,"mat-tab-group"),l.TgZ(1,"mat-tab",0),l._UZ(2,"app-vehicle-steel-weighing-survey"),l.qZA(),l.TgZ(3,"mat-tab",1),l.YNc(4,qe,3,0,"ng-template",2),l.qZA(),l.qZA())},directives:[st.SP,st.uX,Te,st.uD,Tt.lW,_e.gM,_t.Hw],styles:[""]}),t})(),pathMatch:"full"}];let Ce=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[o.Bz.forChild(Ue)],o.Bz]}),t})();const Oe=[];let xe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[o.Bz.forChild(Oe)],o.Bz]}),t})(),Ne=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({providers:[Rt],imports:[[xe,a.m]]}),t})(),Pe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({providers:[oe,qt.JJ],imports:[[Ce,a.m,Ne]]}),t})()}}]);